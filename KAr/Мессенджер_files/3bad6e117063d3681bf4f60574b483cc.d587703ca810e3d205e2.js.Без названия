(self.webpackChunkvk=self.webpackChunkvk||[]).push([[23299],{47066:(e,t,r)=>{"use strict";r.d(t,{default:()=>n});const n=(0,r(93708).makeIcon)("Icon12Dropdown","dropdown_12","0 0 12 8",'<symbol fill="none" viewBox="0 0 12 8" xmlns="http://www.w3.org/2000/svg" id="dropdown_12"><path clip-rule="evenodd" d="M2.156 2.295a.75.75 0 0 1 1.051-.137L6 4.306l2.793-2.148a.75.75 0 1 1 .914 1.189l-3.25 2.5a.75.75 0 0 1-.914 0l-3.25-2.5a.75.75 0 0 1-.137-1.052z" fill="currentColor" fill-rule="evenodd" /></symbol>',12,8,!1,void 0)},46830:(e,t,r)=>{"use strict";r.d(t,{default:()=>n});const n=(0,r(93708).makeIcon)("Icon16SearchOutline","search_outline_16","0 0 16 16",'<symbol fill="none" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" id="search_outline_16"><path d="M6.5 1a5.5 5.5 0 0 1 4.383 8.823l3.896 3.9a.75.75 0 0 1-1.061 1.06l-3.895-3.9A5.5 5.5 0 1 1 6.5 1zm0 1.5a4 4 0 1 0 0 8 4 4 0 0 0 0-8z" fill="currentColor" /></symbol>',16,16,!1,void 0)},40691:(e,t,r)=>{"use strict";var n=r(29120),a=r(91521),s=r(70317),o=r(99739),i=r(4840),u=r(69058);e.exports=function(e){var t,r=u(this),c=i(s(r,"length"));if(!o(e))throw new TypeError("mapperFunction must be a function");arguments.length>1&&(t=arguments[1]);var d=n(r,0);return a(d,r,c,0,1,e,t),d}},90330:(e,t,r)=>{"use strict";var n=r(4289),a=r(55559),s=r(40691),o=r(3721),i=o(),u=r(4090),c=a(i);n(c,{getPolyfill:o,implementation:s,shim:u}),e.exports=c},3721:(e,t,r)=>{"use strict";var n=r(40691);e.exports=function(){return Array.prototype.flatMap||n}},4090:(e,t,r)=>{"use strict";var n=r(4289),a=r(97272),s=r(3721);e.exports=function(){var e=s();return n(Array.prototype,{flatMap:e},{flatMap:function(){return Array.prototype.flatMap!==e}}),a("flatMap"),e}},9669:(e,t,r)=>{e.exports=r(51609)},55448:(e,t,r)=>{"use strict";var n=r(64867),a=r(36026),s=r(4372),o=r(15327),i=r(94097),u=r(84109),c=r(67985),d=r(77874),l=r(82648),p=r(60644),f=r(90205);e.exports=function(e){return new Promise((function(t,r){var h,v=e.data,m=e.headers,y=e.responseType;function g(){e.cancelToken&&e.cancelToken.unsubscribe(h),e.signal&&e.signal.removeEventListener("abort",h)}n.isFormData(v)&&n.isStandardBrowserEnv()&&delete m["Content-Type"];var b=new XMLHttpRequest;if(e.auth){var C=e.auth.username||"",_=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";m.Authorization="Basic "+btoa(C+":"+_)}var k=i(e.baseURL,e.url);function w(){if(b){var n="getAllResponseHeaders"in b?u(b.getAllResponseHeaders()):null,s={data:y&&"text"!==y&&"json"!==y?b.response:b.responseText,status:b.status,statusText:b.statusText,headers:n,config:e,request:b};a((function(e){t(e),g()}),(function(e){r(e),g()}),s),b=null}}if(b.open(e.method.toUpperCase(),o(k,e.params,e.paramsSerializer),!0),b.timeout=e.timeout,"onloadend"in b?b.onloadend=w:b.onreadystatechange=function(){b&&4===b.readyState&&(0!==b.status||b.responseURL&&0===b.responseURL.indexOf("file:"))&&setTimeout(w)},b.onabort=function(){b&&(r(new l("Request aborted",l.ECONNABORTED,e,b)),b=null)},b.onerror=function(){r(new l("Network Error",l.ERR_NETWORK,e,b,b)),b=null},b.ontimeout=function(){var t=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded",n=e.transitional||d;e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),r(new l(t,n.clarifyTimeoutError?l.ETIMEDOUT:l.ECONNABORTED,e,b)),b=null},n.isStandardBrowserEnv()){var I=(e.withCredentials||c(k))&&e.xsrfCookieName?s.read(e.xsrfCookieName):void 0;I&&(m[e.xsrfHeaderName]=I)}"setRequestHeader"in b&&n.forEach(m,(function(e,t){void 0===v&&"content-type"===t.toLowerCase()?delete m[t]:b.setRequestHeader(t,e)})),n.isUndefined(e.withCredentials)||(b.withCredentials=!!e.withCredentials),y&&"json"!==y&&(b.responseType=e.responseType),"function"==typeof e.onDownloadProgress&&b.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&b.upload&&b.upload.addEventListener("progress",e.onUploadProgress),(e.cancelToken||e.signal)&&(h=function(e){b&&(r(!e||e&&e.type?new p:e),b.abort(),b=null)},e.cancelToken&&e.cancelToken.subscribe(h),e.signal&&(e.signal.aborted?h():e.signal.addEventListener("abort",h))),v||(v=null);var S=f(k);S&&-1===["http","https","file"].indexOf(S)?r(new l("Unsupported protocol "+S+":",l.ERR_BAD_REQUEST,e)):b.send(v)}))}},51609:(e,t,r)=>{"use strict";var n=r(64867),a=r(91849),s=r(30321),o=r(47185);var i=function e(t){var r=new s(t),i=a(s.prototype.request,r);return n.extend(i,s.prototype,r),n.extend(i,r),i.create=function(r){return e(o(t,r))},i}(r(45546));i.Axios=s,i.CanceledError=r(60644),i.CancelToken=r(14972),i.isCancel=r(26502),i.VERSION=r(97288).version,i.toFormData=r(47675),i.AxiosError=r(82648),i.Cancel=i.CanceledError,i.all=function(e){return Promise.all(e)},i.spread=r(8713),i.isAxiosError=r(16268),e.exports=i,e.exports.default=i},14972:(e,t,r)=>{"use strict";var n=r(60644);function a(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var r=this;this.promise.then((function(e){if(r._listeners){var t,n=r._listeners.length;for(t=0;t<n;t++)r._listeners[t](e);r._listeners=null}})),this.promise.then=function(e){var t,n=new Promise((function(e){r.subscribe(e),t=e})).then(e);return n.cancel=function(){r.unsubscribe(t)},n},e((function(e){r.reason||(r.reason=new n(e),t(r.reason))}))}a.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},a.prototype.subscribe=function(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]},a.prototype.unsubscribe=function(e){if(this._listeners){var t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}},a.source=function(){var e;return{token:new a((function(t){e=t})),cancel:e}},e.exports=a},60644:(e,t,r)=>{"use strict";var n=r(82648);function a(e){n.call(this,null==e?"canceled":e,n.ERR_CANCELED),this.name="CanceledError"}r(64867).inherits(a,n,{__CANCEL__:!0}),e.exports=a},26502:e=>{"use strict";e.exports=function(e){return!(!e||!e.__CANCEL__)}},30321:(e,t,r)=>{"use strict";var n=r(64867),a=r(15327),s=r(80782),o=r(13572),i=r(47185),u=r(94097),c=r(54875),d=c.validators;function l(e){this.defaults=e,this.interceptors={request:new s,response:new s}}l.prototype.request=function(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},(t=i(this.defaults,t)).method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var r=t.transitional;void 0!==r&&c.assertOptions(r,{silentJSONParsing:d.transitional(d.boolean),forcedJSONParsing:d.transitional(d.boolean),clarifyTimeoutError:d.transitional(d.boolean)},!1);var n=[],a=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(a=a&&e.synchronous,n.unshift(e.fulfilled,e.rejected))}));var s,u=[];if(this.interceptors.response.forEach((function(e){u.push(e.fulfilled,e.rejected)})),!a){var l=[o,void 0];for(Array.prototype.unshift.apply(l,n),l=l.concat(u),s=Promise.resolve(t);l.length;)s=s.then(l.shift(),l.shift());return s}for(var p=t;n.length;){var f=n.shift(),h=n.shift();try{p=f(p)}catch(e){h(e);break}}try{s=o(p)}catch(e){return Promise.reject(e)}for(;u.length;)s=s.then(u.shift(),u.shift());return s},l.prototype.getUri=function(e){e=i(this.defaults,e);var t=u(e.baseURL,e.url);return a(t,e.params,e.paramsSerializer)},n.forEach(["delete","get","head","options"],(function(e){l.prototype[e]=function(t,r){return this.request(i(r||{},{method:e,url:t,data:(r||{}).data}))}})),n.forEach(["post","put","patch"],(function(e){function t(t){return function(r,n,a){return this.request(i(a||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:r,data:n}))}}l.prototype[e]=t(),l.prototype[e+"Form"]=t(!0)})),e.exports=l},82648:(e,t,r)=>{"use strict";var n=r(64867);function a(e,t,r,n,a){Error.call(this),this.message=e,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),n&&(this.request=n),a&&(this.response=a)}n.inherits(a,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var s=a.prototype,o={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach((function(e){o[e]={value:e}})),Object.defineProperties(a,o),Object.defineProperty(s,"isAxiosError",{value:!0}),a.from=function(e,t,r,o,i,u){var c=Object.create(s);return n.toFlatObject(e,c,(function(e){return e!==Error.prototype})),a.call(c,e.message,t,r,o,i),c.name=e.name,u&&Object.assign(c,u),c},e.exports=a},80782:(e,t,r)=>{"use strict";var n=r(64867);function a(){this.handlers=[]}a.prototype.use=function(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1},a.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},a.prototype.forEach=function(e){n.forEach(this.handlers,(function(t){null!==t&&e(t)}))},e.exports=a},94097:(e,t,r)=>{"use strict";var n=r(91793),a=r(7303);e.exports=function(e,t){return e&&!n(t)?a(e,t):t}},13572:(e,t,r)=>{"use strict";var n=r(64867),a=r(18527),s=r(26502),o=r(45546),i=r(60644);function u(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new i}e.exports=function(e){return u(e),e.headers=e.headers||{},e.data=a.call(e,e.data,e.headers,e.transformRequest),e.headers=n.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),n.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||o.adapter)(e).then((function(t){return u(e),t.data=a.call(e,t.data,t.headers,e.transformResponse),t}),(function(t){return s(t)||(u(e),t&&t.response&&(t.response.data=a.call(e,t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))}},47185:(e,t,r)=>{"use strict";var n=r(64867);e.exports=function(e,t){t=t||{};var r={};function a(e,t){return n.isPlainObject(e)&&n.isPlainObject(t)?n.merge(e,t):n.isPlainObject(t)?n.merge({},t):n.isArray(t)?t.slice():t}function s(r){return n.isUndefined(t[r])?n.isUndefined(e[r])?void 0:a(void 0,e[r]):a(e[r],t[r])}function o(e){if(!n.isUndefined(t[e]))return a(void 0,t[e])}function i(r){return n.isUndefined(t[r])?n.isUndefined(e[r])?void 0:a(void 0,e[r]):a(void 0,t[r])}function u(r){return r in t?a(e[r],t[r]):r in e?a(void 0,e[r]):void 0}var c={url:o,method:o,data:o,baseURL:i,transformRequest:i,transformResponse:i,paramsSerializer:i,timeout:i,timeoutMessage:i,withCredentials:i,adapter:i,responseType:i,xsrfCookieName:i,xsrfHeaderName:i,onUploadProgress:i,onDownloadProgress:i,decompress:i,maxContentLength:i,maxBodyLength:i,beforeRedirect:i,transport:i,httpAgent:i,httpsAgent:i,cancelToken:i,socketPath:i,responseEncoding:i,validateStatus:u};return n.forEach(Object.keys(e).concat(Object.keys(t)),(function(e){var t=c[e]||s,a=t(e);n.isUndefined(a)&&t!==u||(r[e]=a)})),r}},36026:(e,t,r)=>{"use strict";var n=r(82648);e.exports=function(e,t,r){var a=r.config.validateStatus;r.status&&a&&!a(r.status)?t(new n("Request failed with status code "+r.status,[n.ERR_BAD_REQUEST,n.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r)):e(r)}},18527:(e,t,r)=>{"use strict";var n=r(64867),a=r(45546);e.exports=function(e,t,r){var s=this||a;return n.forEach(r,(function(r){e=r.call(s,e,t)})),e}},45546:(e,t,r)=>{"use strict";var n=r(64867),a=r(16016),s=r(82648),o=r(77874),i=r(47675),u={"Content-Type":"application/x-www-form-urlencoded"};function c(e,t){!n.isUndefined(e)&&n.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var d,l={transitional:o,adapter:(("undefined"!=typeof XMLHttpRequest||"undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process))&&(d=r(55448)),d),transformRequest:[function(e,t){if(a(t,"Accept"),a(t,"Content-Type"),n.isFormData(e)||n.isArrayBuffer(e)||n.isBuffer(e)||n.isStream(e)||n.isFile(e)||n.isBlob(e))return e;if(n.isArrayBufferView(e))return e.buffer;if(n.isURLSearchParams(e))return c(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString();var r,s=n.isObject(e),o=t&&t["Content-Type"];if((r=n.isFileList(e))||s&&"multipart/form-data"===o){var u=this.env&&this.env.FormData;return i(r?{"files[]":e}:e,u&&new u)}return s||"application/json"===o?(c(t,"application/json"),function(e,t,r){if(n.isString(e))try{return(t||JSON.parse)(e),n.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(r||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){var t=this.transitional||l.transitional,r=t&&t.silentJSONParsing,a=t&&t.forcedJSONParsing,o=!r&&"json"===this.responseType;if(o||a&&n.isString(e)&&e.length)try{return JSON.parse(e)}catch(e){if(o){if("SyntaxError"===e.name)throw s.from(e,s.ERR_BAD_RESPONSE,this,null,this.response);throw e}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:r(91623)},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};n.forEach(["delete","get","head"],(function(e){l.headers[e]={}})),n.forEach(["post","put","patch"],(function(e){l.headers[e]=n.merge(u)})),e.exports=l},77874:e=>{"use strict";e.exports={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1}},97288:e=>{e.exports={version:"0.27.2"}},91849:e=>{"use strict";e.exports=function(e,t){return function(){for(var r=new Array(arguments.length),n=0;n<r.length;n++)r[n]=arguments[n];return e.apply(t,r)}}},15327:(e,t,r)=>{"use strict";var n=r(64867);function a(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}e.exports=function(e,t,r){if(!t)return e;var s;if(r)s=r(t);else if(n.isURLSearchParams(t))s=t.toString();else{var o=[];n.forEach(t,(function(e,t){null!=e&&(n.isArray(e)?t+="[]":e=[e],n.forEach(e,(function(e){n.isDate(e)?e=e.toISOString():n.isObject(e)&&(e=JSON.stringify(e)),o.push(a(t)+"="+a(e))})))})),s=o.join("&")}if(s){var i=e.indexOf("#");-1!==i&&(e=e.slice(0,i)),e+=(-1===e.indexOf("?")?"?":"&")+s}return e}},7303:e=>{"use strict";e.exports=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}},4372:(e,t,r)=>{"use strict";var n=r(64867);e.exports=n.isStandardBrowserEnv()?{write:function(e,t,r,a,s,o){var i=[];i.push(e+"="+encodeURIComponent(t)),n.isNumber(r)&&i.push("expires="+new Date(r).toGMTString()),n.isString(a)&&i.push("path="+a),n.isString(s)&&i.push("domain="+s),!0===o&&i.push("secure"),document.cookie=i.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},91793:e=>{"use strict";e.exports=function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}},16268:(e,t,r)=>{"use strict";var n=r(64867);e.exports=function(e){return n.isObject(e)&&!0===e.isAxiosError}},67985:(e,t,r)=>{"use strict";var n=r(64867);e.exports=n.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a");function a(e){var n=e;return t&&(r.setAttribute("href",n),n=r.href),r.setAttribute("href",n),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:"/"===r.pathname.charAt(0)?r.pathname:"/"+r.pathname}}return e=a(window.location.href),function(t){var r=n.isString(t)?a(t):t;return r.protocol===e.protocol&&r.host===e.host}}():function(){return!0}},16016:(e,t,r)=>{"use strict";var n=r(64867);e.exports=function(e,t){n.forEach(e,(function(r,n){n!==t&&n.toUpperCase()===t.toUpperCase()&&(e[t]=r,delete e[n])}))}},91623:e=>{e.exports=null},84109:(e,t,r)=>{"use strict";var n=r(64867),a=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];e.exports=function(e){var t,r,s,o={};return e?(n.forEach(e.split("\n"),(function(e){if(s=e.indexOf(":"),t=n.trim(e.substr(0,s)).toLowerCase(),r=n.trim(e.substr(s+1)),t){if(o[t]&&a.indexOf(t)>=0)return;o[t]="set-cookie"===t?(o[t]?o[t]:[]).concat([r]):o[t]?o[t]+", "+r:r}})),o):o}},90205:e=>{"use strict";e.exports=function(e){var t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}},8713:e=>{"use strict";e.exports=function(e){return function(t){return e.apply(null,t)}}},47675:(e,t,r)=>{"use strict";var n=r(64867);e.exports=function(e,t){t=t||new FormData;var r=[];function a(e){return null===e?"":n.isDate(e)?e.toISOString():n.isArrayBuffer(e)||n.isTypedArray(e)?"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}return function e(s,o){if(n.isPlainObject(s)||n.isArray(s)){if(-1!==r.indexOf(s))throw Error("Circular reference detected in "+o);r.push(s),n.forEach(s,(function(r,s){if(!n.isUndefined(r)){var i,u=o?o+"."+s:s;if(r&&!o&&"object"==typeof r)if(n.endsWith(s,"{}"))r=JSON.stringify(r);else if(n.endsWith(s,"[]")&&(i=n.toArray(r)))return void i.forEach((function(e){!n.isUndefined(e)&&t.append(u,a(e))}));e(r,u)}})),r.pop()}else t.append(o,a(s))}(e),t}},54875:(e,t,r)=>{"use strict";var n=r(97288).version,a=r(82648),s={};["object","boolean","number","function","string","symbol"].forEach((function(e,t){s[e]=function(r){return typeof r===e||"a"+(t<1?"n ":" ")+e}}));var o={};s.transitional=function(e,t,r){function s(e,t){return"[Axios v"+n+"] Transitional option '"+e+"'"+t+(r?". "+r:"")}return function(r,n,i){if(!1===e)throw new a(s(n," has been removed"+(t?" in "+t:"")),a.ERR_DEPRECATED);return t&&!o[n]&&(o[n]=!0,console.warn(s(n," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(r,n,i)}},e.exports={assertOptions:function(e,t,r){if("object"!=typeof e)throw new a("options must be an object",a.ERR_BAD_OPTION_VALUE);for(var n=Object.keys(e),s=n.length;s-- >0;){var o=n[s],i=t[o];if(i){var u=e[o],c=void 0===u||i(u,o,e);if(!0!==c)throw new a("option "+o+" must be "+c,a.ERR_BAD_OPTION_VALUE)}else if(!0!==r)throw new a("Unknown option "+o,a.ERR_BAD_OPTION)}},validators:s}},64867:(e,t,r)=>{"use strict";var n,a=r(91849),s=Object.prototype.toString,o=(n=Object.create(null),function(e){var t=s.call(e);return n[t]||(n[t]=t.slice(8,-1).toLowerCase())});function i(e){return e=e.toLowerCase(),function(t){return o(t)===e}}function u(e){return Array.isArray(e)}function c(e){return void 0===e}var d=i("ArrayBuffer");function l(e){return null!==e&&"object"==typeof e}function p(e){if("object"!==o(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}var f=i("Date"),h=i("File"),v=i("Blob"),m=i("FileList");function y(e){return"[object Function]"===s.call(e)}var g=i("URLSearchParams");function b(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),u(e))for(var r=0,n=e.length;r<n;r++)t.call(null,e[r],r,e);else for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.call(null,e[a],a,e)}var C,_=(C="undefined"!=typeof Uint8Array&&Object.getPrototypeOf(Uint8Array),function(e){return C&&e instanceof C});e.exports={isArray:u,isArrayBuffer:d,isBuffer:function(e){return null!==e&&!c(e)&&null!==e.constructor&&!c(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){var t="[object FormData]";return e&&("function"==typeof FormData&&e instanceof FormData||s.call(e)===t||y(e.toString)&&e.toString()===t)},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&d(e.buffer)},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:l,isPlainObject:p,isUndefined:c,isDate:f,isFile:h,isBlob:v,isFunction:y,isStream:function(e){return l(e)&&y(e.pipe)},isURLSearchParams:g,isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)},forEach:b,merge:function e(){var t={};function r(r,n){p(t[n])&&p(r)?t[n]=e(t[n],r):p(r)?t[n]=e({},r):u(r)?t[n]=r.slice():t[n]=r}for(var n=0,a=arguments.length;n<a;n++)b(arguments[n],r);return t},extend:function(e,t,r){return b(t,(function(t,n){e[n]=r&&"function"==typeof t?a(t,r):t})),e},trim:function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},stripBOM:function(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e},inherits:function(e,t,r,n){e.prototype=Object.create(t.prototype,n),e.prototype.constructor=e,r&&Object.assign(e.prototype,r)},toFlatObject:function(e,t,r){var n,a,s,o={};t=t||{};do{for(a=(n=Object.getOwnPropertyNames(e)).length;a-- >0;)o[s=n[a]]||(t[s]=e[s],o[s]=!0);e=Object.getPrototypeOf(e)}while(e&&(!r||r(e,t))&&e!==Object.prototype);return t},kindOf:o,kindOfTest:i,endsWith:function(e,t,r){e=String(e),(void 0===r||r>e.length)&&(r=e.length),r-=t.length;var n=e.indexOf(t,r);return-1!==n&&n===r},toArray:function(e){if(!e)return null;var t=e.length;if(c(t))return null;for(var r=new Array(t);t-- >0;)r[t]=e[t];return r},isTypedArray:_,isFileList:m}},21924:(e,t,r)=>{"use strict";var n=r(40210),a=r(55559),s=a(n("String.prototype.indexOf"));e.exports=function(e,t){var r=n(e,!!t);return"function"==typeof r&&s(e,".prototype.")>-1?a(r):r}},55559:(e,t,r)=>{"use strict";var n=r(58612),a=r(40210),s=a("%Function.prototype.apply%"),o=a("%Function.prototype.call%"),i=a("%Reflect.apply%",!0)||n.call(o,s),u=a("%Object.getOwnPropertyDescriptor%",!0),c=a("%Object.defineProperty%",!0),d=a("%Math.max%");if(c)try{c({},"a",{value:1})}catch(e){c=null}e.exports=function(e){var t=i(n,o,arguments);if(u&&c){var r=u(t,"length");r.configurable&&c(t,"length",{value:1+d(0,e.length-(arguments.length-1))})}return t};var l=function(){return i(n,s,arguments)};c?c(e.exports,"apply",{value:l}):e.exports.apply=l},4289:(e,t,r)=>{"use strict";var n=r(82215),a="function"==typeof Symbol&&"symbol"==typeof Symbol("foo"),s=Object.prototype.toString,o=Array.prototype.concat,i=Object.defineProperty,u=i&&function(){var e={};try{for(var t in i(e,"x",{enumerable:!1,value:e}),e)return!1;return e.x===e}catch(e){return!1}}(),c=function(e,t,r,n){var a;(!(t in e)||"function"==typeof(a=n)&&"[object Function]"===s.call(a)&&n())&&(u?i(e,t,{configurable:!0,enumerable:!1,value:r,writable:!0}):e[t]=r)},d=function(e,t){var r=arguments.length>2?arguments[2]:{},s=n(t);a&&(s=o.call(s,Object.getOwnPropertySymbols(t)));for(var i=0;i<s.length;i+=1)c(e,s[i],t[s[i]],r[s[i]])};d.supportsDescriptors=!!u,e.exports=d},94130:(e,t,r)=>{"use strict";var n=r(40210),a=n("%Array.prototype%"),s=n("%RangeError%"),o=n("%SyntaxError%"),i=n("%TypeError%"),u=r(27840),c=Math.pow(2,32)-1,d=n("%Object.setPrototypeOf%",!0)||([].__proto__!==a?null:function(e,t){return e.__proto__=t,e});e.exports=function(e){if(!u(e)||e<0)throw new i("Assertion failed: `length` must be an integer Number >= 0");if(e>c)throw new s("length is greater than (2**32 - 1)");var t=arguments.length>1?arguments[1]:a,r=[];if(t!==a){if(!d)throw new o("ArrayCreate: a `proto` argument that is not `Array.prototype` is not supported in an environment that does not support setting the [[Prototype]]");d(r,t)}return 0!==e&&(r.length=e),r}},29120:(e,t,r)=>{"use strict";var n=r(40210),a=n("%Symbol.species%",!0),s=n("%TypeError%"),o=r(94130),i=r(70317),u=r(59340),c=r(2370),d=r(27840),l=r(54300);e.exports=function(e,t){if(!d(t)||t<0)throw new s("Assertion failed: length must be an integer >= 0");if(!u(e))return o(t);var r=i(e,"constructor");if(a&&"Object"===l(r)&&null===(r=i(r,a))&&(r=void 0),void 0===r)return o(t);if(!c(r))throw new s("C must be a constructor");return new r(t)}},99582:(e,t,r)=>{"use strict";var n=r(40210),a=r(21924),s=n("%TypeError%"),o=r(59340),i=n("%Reflect.apply%",!0)||a("%Function.prototype.apply%");e.exports=function(e,t){var r=arguments.length>2?arguments[2]:[];if(!o(r))throw new s("Assertion failed: optional `argumentsList`, if provided, must be a List");return i(e,t,r)}},42067:(e,t,r)=>{"use strict";var n=r(40210)("%TypeError%"),a=r(40509),s=r(68712),o=r(24825),i=r(70098),u=r(75239),c=r(74220),d=r(49845),l=r(54300);e.exports=function(e,t,r){if("Object"!==l(e))throw new n("Assertion failed: Type(O) is not Object");if(!c(t))throw new n("Assertion failed: IsPropertyKey(P) is not true");var p=o(e,t),f=!p||u(e);return!(p&&!p["[[Configurable]]"]||!f)&&a(i,d,s,e,t,{"[[Configurable]]":!0,"[[Enumerable]]":!0,"[[Value]]":r,"[[Writable]]":!0})}},5453:(e,t,r)=>{"use strict";var n=r(40210)("%TypeError%"),a=r(42067),s=r(74220),o=r(54300);e.exports=function(e,t,r){if("Object"!==o(e))throw new n("Assertion failed: Type(O) is not Object");if(!s(t))throw new n("Assertion failed: IsPropertyKey(P) is not true");var i=a(e,t,r);if(!i)throw new n("unable to create data property");return i}},26402:(e,t,r)=>{"use strict";var n=r(40210)("%TypeError%"),a=r(39146),s=r(40509),o=r(68712),i=r(52092),u=r(70098),c=r(74220),d=r(49845),l=r(57852),p=r(54300);e.exports=function(e,t,r){if("Object"!==p(e))throw new n("Assertion failed: Type(O) is not Object");if(!c(t))throw new n("Assertion failed: IsPropertyKey(P) is not true");var f=a({Type:p,IsDataDescriptor:u,IsAccessorDescriptor:i},r)?r:l(r);if(!a({Type:p,IsDataDescriptor:u,IsAccessorDescriptor:i},f))throw new n("Assertion failed: Desc is not a valid Property Descriptor");return s(u,d,o,e,t,f)}},91521:(e,t,r)=>{"use strict";var n=r(40210)("%TypeError%"),a=r(65376),s=r(99582),o=r(5453),i=r(70317),u=r(64741),c=r(59340),d=r(64653),l=r(60561);e.exports=function e(t,r,p,f,h){var v;arguments.length>5&&(v=arguments[5]);for(var m=f,y=0;y<p;){var g=l(y),b=u(r,g);if(!0===b){var C=i(r,g);if(void 0!==v){if(arguments.length<=6)throw new n("Assertion failed: thisArg is required when mapperFunction is provided");C=s(v,arguments[6],[C,y,r])}var _=!1;if(h>0&&(_=c(C)),_){var k=d(C);m=e(t,C,k,m,h-1)}else{if(m>=a)throw new n("index too large");o(t,l(m),C),m+=1}}y+=1}return m}},68712:(e,t,r)=>{"use strict";var n=r(14179),a=r(23005),s=r(54300);e.exports=function(e){return void 0!==e&&n(s,"Property Descriptor","Desc",e),a(e)}},70317:(e,t,r)=>{"use strict";var n=r(40210)("%TypeError%"),a=r(68896),s=r(74220),o=r(54300);e.exports=function(e,t){if("Object"!==o(e))throw new n("Assertion failed: Type(O) is not Object");if(!s(t))throw new n("Assertion failed: IsPropertyKey(P) is not true, got "+a(t));return e[t]}},64741:(e,t,r)=>{"use strict";var n=r(40210)("%TypeError%"),a=r(74220),s=r(54300);e.exports=function(e,t){if("Object"!==s(e))throw new n("Assertion failed: `O` must be an Object");if(!a(t))throw new n("Assertion failed: `P` must be a Property Key");return t in e}},52092:(e,t,r)=>{"use strict";var n=r(17642),a=r(14179),s=r(54300);e.exports=function(e){return void 0!==e&&(a(s,"Property Descriptor","Desc",e),!(!n(e,"[[Get]]")&&!n(e,"[[Set]]")))}},59340:(e,t,r)=>{"use strict";e.exports=r(87097)},99739:(e,t,r)=>{"use strict";e.exports=r(55923)},2370:(e,t,r)=>{"use strict";var n=r(8769)("%Reflect.construct%",!0),a=r(26402);try{a({},"",{"[[Get]]":function(){}})}catch(e){a=null}if(a&&n){var s={},o={};a(o,"length",{"[[Get]]":function(){throw s},"[[Enumerable]]":!0}),e.exports=function(e){try{n(e,o)}catch(e){return e===s}}}else e.exports=function(e){return"function"==typeof e&&!!e.prototype}},70098:(e,t,r)=>{"use strict";var n=r(17642),a=r(14179),s=r(54300);e.exports=function(e){return void 0!==e&&(a(s,"Property Descriptor","Desc",e),!(!n(e,"[[Value]]")&&!n(e,"[[Writable]]")))}},75239:(e,t,r)=>{"use strict";var n=r(40210),a=n("%Object.preventExtensions%",!0),s=n("%Object.isExtensible%",!0),o=r(73126);e.exports=a?function(e){return!o(e)&&s(e)}:function(e){return!o(e)}},27840:(e,t,r)=>{"use strict";var n=r(13015),a=r(46261),s=r(54300),o=r(31214),i=r(53060);e.exports=function(e){if("Number"!==s(e)||o(e)||!i(e))return!1;var t=n(e);return a(t)===t}},74220:e=>{"use strict";e.exports=function(e){return"string"==typeof e||"symbol"==typeof e}},38155:(e,t,r)=>{"use strict";var n=r(40210)("%Symbol.match%",!0),a=r(98420),s=r(63895);e.exports=function(e){if(!e||"object"!=typeof e)return!1;if(n){var t=e[n];if(void 0!==t)return s(t)}return a(e)}},64653:(e,t,r)=>{"use strict";var n=r(40210)("%TypeError%"),a=r(70317),s=r(4840),o=r(54300);e.exports=function(e){if("Object"!==o(e))throw new n("Assertion failed: `obj` must be an Object");return s(a(e,"length"))}},24825:(e,t,r)=>{"use strict";var n=r(40210),a=r(94079),s=n("%TypeError%"),o=r(21924)("Object.prototype.propertyIsEnumerable"),i=r(17642),u=r(59340),c=r(74220),d=r(38155),l=r(57852),p=r(54300);e.exports=function(e,t){if("Object"!==p(e))throw new s("Assertion failed: O must be an Object");if(!c(t))throw new s("Assertion failed: P must be a Property Key");if(i(e,t)){if(!a){var r=u(e)&&"length"===t,n=d(e)&&"lastIndex"===t;return{"[[Configurable]]":!(r||n),"[[Enumerable]]":o(e,t),"[[Value]]":e[t],"[[Writable]]":!0}}return l(a(e,t))}}},86378:(e,t,r)=>{"use strict";e.exports=r(28631)},49845:(e,t,r)=>{"use strict";var n=r(31214);e.exports=function(e,t){return e===t?0!==e||1/e==1/t:n(e)&&n(t)}},63895:e=>{"use strict";e.exports=function(e){return!!e}},78974:(e,t,r)=>{"use strict";var n=r(13015),a=r(46261),s=r(19157),o=r(31214),i=r(53060),u=r(94099);e.exports=function(e){var t=s(e);return o(t)||0===t?0:i(t)?u(t)*a(n(t)):t}},4840:(e,t,r)=>{"use strict";var n=r(65376),a=r(78974);e.exports=function(e){var t=a(e);return t<=0?0:t>n?n:t}},19157:(e,t,r)=>{"use strict";var n=r(40210),a=n("%TypeError%"),s=n("%Number%"),o=n("%RegExp%"),i=n("%parseInt%"),u=r(21924),c=r(11652),d=r(73126),l=u("String.prototype.slice"),p=c(/^0b[01]+$/i),f=c(/^0o[0-7]+$/i),h=c(/^[-+]0x[0-9a-f]+$/i),v=c(new o("["+["","​","￾"].join("")+"]","g")),m=["\t\n\v\f\r   ᠎    ","         　\u2028","\u2029\ufeff"].join(""),y=new RegExp("(^["+m+"]+)|(["+m+"]+$)","g"),g=u("String.prototype.replace"),b=r(52159);e.exports=function e(t){var r=d(t)?t:b(t,s);if("symbol"==typeof r)throw new a("Cannot convert a Symbol value to a number");if("bigint"==typeof r)throw new a("Conversion from 'BigInt' to 'number' is not allowed.");if("string"==typeof r){if(p(r))return e(i(l(r,2),2));if(f(r))return e(i(l(r,2),8));if(v(r)||h(r))return NaN;var n=function(e){return g(e,y,"")}(r);if(n!==r)return e(n)}return s(r)}},69058:(e,t,r)=>{"use strict";var n=r(40210)("%Object%"),a=r(86378);e.exports=function(e){return a(e),n(e)}},52159:(e,t,r)=>{"use strict";var n=r(41503);e.exports=function(e){return arguments.length>1?n(e,arguments[1]):n(e)}},57852:(e,t,r)=>{"use strict";var n=r(17642),a=r(40210)("%TypeError%"),s=r(54300),o=r(63895),i=r(99739);e.exports=function(e){if("Object"!==s(e))throw new a("ToPropertyDescriptor requires an object");var t={};if(n(e,"enumerable")&&(t["[[Enumerable]]"]=o(e.enumerable)),n(e,"configurable")&&(t["[[Configurable]]"]=o(e.configurable)),n(e,"value")&&(t["[[Value]]"]=e.value),n(e,"writable")&&(t["[[Writable]]"]=o(e.writable)),n(e,"get")){var r=e.get;if(void 0!==r&&!i(r))throw new a("getter must be a function");t["[[Get]]"]=r}if(n(e,"set")){var u=e.set;if(void 0!==u&&!i(u))throw new a("setter must be a function");t["[[Set]]"]=u}if((n(t,"[[Get]]")||n(t,"[[Set]]"))&&(n(t,"[[Value]]")||n(t,"[[Writable]]")))throw new a("Invalid property descriptor. Cannot both specify accessors and a value or writable attribute");return t}},60561:(e,t,r)=>{"use strict";var n=r(40210),a=n("%String%"),s=n("%TypeError%");e.exports=function(e){if("symbol"==typeof e)throw new s("Cannot convert a Symbol value to a string");return a(e)}},54300:(e,t,r)=>{"use strict";var n=r(61276);e.exports=function(e){return"symbol"==typeof e?"Symbol":"bigint"==typeof e?"BigInt":n(e)}},13015:(e,t,r)=>{"use strict";var n=r(40210)("%Math.abs%");e.exports=function(e){return n(e)}},46261:e=>{"use strict";var t=Math.floor;e.exports=function(e){return t(e)}},28631:(e,t,r)=>{"use strict";var n=r(40210)("%TypeError%");e.exports=function(e,t){if(null==e)throw new n(t||"Cannot call method on "+e);return e}},61276:e=>{"use strict";e.exports=function(e){return null===e?"Null":void 0===e?"Undefined":"function"==typeof e||"object"==typeof e?"Object":"number"==typeof e?"Number":"boolean"==typeof e?"Boolean":"string"==typeof e?"String":void 0}},8769:(e,t,r)=>{"use strict";e.exports=r(40210)},40509:(e,t,r)=>{"use strict";var n=r(31044),a=r(40210),s=n()&&a("%Object.defineProperty%",!0),o=n.hasArrayLengthDefineBug(),i=o&&r(87097),u=r(21924)("Object.prototype.propertyIsEnumerable");e.exports=function(e,t,r,n,a,c){if(!s){if(!e(c))return!1;if(!c["[[Configurable]]"]||!c["[[Writable]]"])return!1;if(a in n&&u(n,a)!==!!c["[[Enumerable]]"])return!1;var d=c["[[Value]]"];return n[a]=d,t(n[a],d)}return o&&"length"===a&&"[[Value]]"in c&&i(n)&&n.length!==c["[[Value]]"]?(n.length=c["[[Value]]"],n.length===c["[[Value]]"]):(s(n,a,r(c)),!0)}},87097:(e,t,r)=>{"use strict";var n=r(40210)("%Array%"),a=!n.isArray&&r(21924)("Object.prototype.toString");e.exports=n.isArray||function(e){return"[object Array]"===a(e)}},14179:(e,t,r)=>{"use strict";var n=r(40210),a=n("%TypeError%"),s=n("%SyntaxError%"),o=r(17642),i={"Property Descriptor":function(e){var t={"[[Configurable]]":!0,"[[Enumerable]]":!0,"[[Get]]":!0,"[[Set]]":!0,"[[Value]]":!0,"[[Writable]]":!0};for(var r in e)if(o(e,r)&&!t[r])return!1;var n=o(e,"[[Value]]"),s=o(e,"[[Get]]")||o(e,"[[Set]]");if(n&&s)throw new a("Property Descriptors may not be both accessor and data descriptors");return!0},"Match Record":r(87283)};e.exports=function(e,t,r,n){var o=i[t];if("function"!=typeof o)throw new s("unknown record type: "+t);if("Object"!==e(n)||!o(n))throw new a(r+" must be a "+t)}},23005:e=>{"use strict";e.exports=function(e){if(void 0===e)return e;var t={};return"[[Value]]"in e&&(t.value=e["[[Value]]"]),"[[Writable]]"in e&&(t.writable=!!e["[[Writable]]"]),"[[Get]]"in e&&(t.get=e["[[Get]]"]),"[[Set]]"in e&&(t.set=e["[[Set]]"]),"[[Enumerable]]"in e&&(t.enumerable=!!e["[[Enumerable]]"]),"[[Configurable]]"in e&&(t.configurable=!!e["[[Configurable]]"]),t}},94079:(e,t,r)=>{"use strict";var n=r(40210)("%Object.getOwnPropertyDescriptor%",!0);if(n)try{n([],"length")}catch(e){n=null}e.exports=n},53060:e=>{"use strict";var t=Number.isNaN||function(e){return e!=e};e.exports=Number.isFinite||function(e){return"number"==typeof e&&!t(e)&&e!==1/0&&e!==-1/0}},87283:(e,t,r)=>{"use strict";var n=r(17642);e.exports=function(e){return n(e,"[[StartIndex]]")&&n(e,"[[EndIndex]]")&&e["[[StartIndex]]"]>=0&&e["[[EndIndex]]"]>=e["[[StartIndex]]"]&&String(parseInt(e["[[StartIndex]]"],10))===String(e["[[StartIndex]]"])&&String(parseInt(e["[[EndIndex]]"],10))===String(e["[[EndIndex]]"])}},31214:e=>{"use strict";e.exports=Number.isNaN||function(e){return e!=e}},73126:e=>{"use strict";e.exports=function(e){return null===e||"function"!=typeof e&&"object"!=typeof e}},39146:(e,t,r)=>{"use strict";var n=r(40210),a=r(17642),s=n("%TypeError%");e.exports=function(e,t){if("Object"!==e.Type(t))return!1;var r={"[[Configurable]]":!0,"[[Enumerable]]":!0,"[[Get]]":!0,"[[Set]]":!0,"[[Value]]":!0,"[[Writable]]":!0};for(var n in t)if(a(t,n)&&!r[n])return!1;if(e.IsDataDescriptor(t)&&e.IsAccessorDescriptor(t))throw new s("Property Descriptors may not be both accessor and data descriptors");return!0}},65376:(e,t,r)=>{"use strict";var n=r(40210),a=n("%Math%"),s=n("%Number%");e.exports=s.MAX_SAFE_INTEGER||a.pow(2,53)-1},11652:(e,t,r)=>{"use strict";var n=r(21924)("RegExp.prototype.exec");e.exports=function(e){return function(t){return null!==n(e,t)}}},94099:e=>{"use strict";e.exports=function(e){return e>=0?1:-1}},55923:e=>{"use strict";var t,r,n=Function.prototype.toString,a="object"==typeof Reflect&&null!==Reflect&&Reflect.apply;if("function"==typeof a&&"function"==typeof Object.defineProperty)try{t=Object.defineProperty({},"length",{get:function(){throw r}}),r={},a((function(){throw 42}),null,t)}catch(e){e!==r&&(a=null)}else a=null;var s=/^\s*class\b/,o=function(e){try{var t=n.call(e);return s.test(t)}catch(e){return!1}},i=Object.prototype.toString,u="function"==typeof Symbol&&!!Symbol.toStringTag,c="object"==typeof document&&void 0===document.all&&void 0!==document.all?document.all:{};e.exports=a?function(e){if(e===c)return!0;if(!e)return!1;if("function"!=typeof e&&"object"!=typeof e)return!1;if("function"==typeof e&&!e.prototype)return!0;try{a(e,null,t)}catch(e){if(e!==r)return!1}return!o(e)}:function(e){if(e===c)return!0;if(!e)return!1;if("function"!=typeof e&&"object"!=typeof e)return!1;if("function"==typeof e&&!e.prototype)return!0;if(u)return function(e){try{return!o(e)&&(n.call(e),!0)}catch(e){return!1}}(e);if(o(e))return!1;var t=i.call(e);return"[object Function]"===t||"[object GeneratorFunction]"===t}},68896:(e,t,r)=>{var n="function"==typeof Map&&Map.prototype,a=Object.getOwnPropertyDescriptor&&n?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,s=n&&a&&"function"==typeof a.get?a.get:null,o=n&&Map.prototype.forEach,i="function"==typeof Set&&Set.prototype,u=Object.getOwnPropertyDescriptor&&i?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,c=i&&u&&"function"==typeof u.get?u.get:null,d=i&&Set.prototype.forEach,l="function"==typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,p="function"==typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,f="function"==typeof WeakRef&&WeakRef.prototype?WeakRef.prototype.deref:null,h=Boolean.prototype.valueOf,v=Object.prototype.toString,m=Function.prototype.toString,y=String.prototype.match,g=String.prototype.slice,b=String.prototype.replace,C=String.prototype.toUpperCase,_=String.prototype.toLowerCase,k=RegExp.prototype.test,w=Array.prototype.concat,I=Array.prototype.join,S=Array.prototype.slice,O=Math.floor,R="function"==typeof BigInt?BigInt.prototype.valueOf:null,A=Object.getOwnPropertySymbols,x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol.prototype.toString:null,E="function"==typeof Symbol&&"object"==typeof Symbol.iterator,U="function"==typeof Symbol&&Symbol.toStringTag&&(typeof Symbol.toStringTag===E||"symbol")?Symbol.toStringTag:null,M=Object.prototype.propertyIsEnumerable,P=("function"==typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(e){return e.__proto__}:null);function j(e,t){if(e===1/0||e===-1/0||e!=e||e&&e>-1e3&&e<1e3||k.call(/e/,t))return t;var r=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if("number"==typeof e){var n=e<0?-O(-e):O(e);if(n!==e){var a=String(n),s=g.call(t,a.length+1);return b.call(a,r,"$&_")+"."+b.call(b.call(s,/([0-9]{3})/g,"$&_"),/_$/,"")}}return b.call(t,r,"$&_")}var F=r(72006).custom,q=F&&L(F)?F:null;function N(e,t,r){var n="double"===(r.quoteStyle||t)?'"':"'";return n+e+n}function T(e){return b.call(String(e),/"/g,"&quot;")}function D(e){return!("[object Array]"!==G(e)||U&&"object"==typeof e&&U in e)}function L(e){if(E)return e&&"object"==typeof e&&e instanceof Symbol;if("symbol"==typeof e)return!0;if(!e||"object"!=typeof e||!x)return!1;try{return x.call(e),!0}catch(e){}return!1}e.exports=function e(t,r,n,a){var i=r||{};if(H(i,"quoteStyle")&&"single"!==i.quoteStyle&&"double"!==i.quoteStyle)throw new TypeError('option "quoteStyle" must be "single" or "double"');if(H(i,"maxStringLength")&&("number"==typeof i.maxStringLength?i.maxStringLength<0&&i.maxStringLength!==1/0:null!==i.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var u=!H(i,"customInspect")||i.customInspect;if("boolean"!=typeof u&&"symbol"!==u)throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(H(i,"indent")&&null!==i.indent&&"\t"!==i.indent&&!(parseInt(i.indent,10)===i.indent&&i.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(H(i,"numericSeparator")&&"boolean"!=typeof i.numericSeparator)throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var v=i.numericSeparator;if(void 0===t)return"undefined";if(null===t)return"null";if("boolean"==typeof t)return t?"true":"false";if("string"==typeof t)return W(t,i);if("number"==typeof t){if(0===t)return 1/0/t>0?"0":"-0";var C=String(t);return v?j(t,C):C}if("bigint"==typeof t){var k=String(t)+"n";return v?j(t,k):k}var O=void 0===i.depth?5:i.depth;if(void 0===n&&(n=0),n>=O&&O>0&&"object"==typeof t)return D(t)?"[Array]":"[Object]";var A=function(e,t){var r;if("\t"===e.indent)r="\t";else{if(!("number"==typeof e.indent&&e.indent>0))return null;r=I.call(Array(e.indent+1)," ")}return{base:r,prev:I.call(Array(t+1),r)}}(i,n);if(void 0===a)a=[];else if(z(a,t)>=0)return"[Circular]";function F(t,r,s){if(r&&(a=S.call(a)).push(r),s){var o={depth:i.depth};return H(i,"quoteStyle")&&(o.quoteStyle=i.quoteStyle),e(t,o,n+1,a)}return e(t,i,n+1,a)}if("function"==typeof t){var B=function(e){if(e.name)return e.name;var t=y.call(m.call(e),/^function\s*([\w$]+)/);if(t)return t[1];return null}(t),V=X(t,F);return"[Function"+(B?": "+B:" (anonymous)")+"]"+(V.length>0?" { "+I.call(V,", ")+" }":"")}if(L(t)){var Y=E?b.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):x.call(t);return"object"!=typeof t||E?Y:K(Y)}if(function(e){if(!e||"object"!=typeof e)return!1;if("undefined"!=typeof HTMLElement&&e instanceof HTMLElement)return!0;return"string"==typeof e.nodeName&&"function"==typeof e.getAttribute}(t)){for(var Z="<"+_.call(String(t.nodeName)),ee=t.attributes||[],te=0;te<ee.length;te++)Z+=" "+ee[te].name+"="+N(T(ee[te].value),"double",i);return Z+=">",t.childNodes&&t.childNodes.length&&(Z+="..."),Z+="</"+_.call(String(t.nodeName))+">"}if(D(t)){if(0===t.length)return"[]";var re=X(t,F);return A&&!function(e){for(var t=0;t<e.length;t++)if(z(e[t],"\n")>=0)return!1;return!0}(re)?"["+J(re,A)+"]":"[ "+I.call(re,", ")+" ]"}if(function(e){return!("[object Error]"!==G(e)||U&&"object"==typeof e&&U in e)}(t)){var ne=X(t,F);return"cause"in t&&!M.call(t,"cause")?"{ ["+String(t)+"] "+I.call(w.call("[cause]: "+F(t.cause),ne),", ")+" }":0===ne.length?"["+String(t)+"]":"{ ["+String(t)+"] "+I.call(ne,", ")+" }"}if("object"==typeof t&&u){if(q&&"function"==typeof t[q])return t[q]();if("symbol"!==u&&"function"==typeof t.inspect)return t.inspect()}if(function(e){if(!s||!e||"object"!=typeof e)return!1;try{s.call(e);try{c.call(e)}catch(e){return!0}return e instanceof Map}catch(e){}return!1}(t)){var ae=[];return o.call(t,(function(e,r){ae.push(F(r,t,!0)+" => "+F(e,t))})),Q("Map",s.call(t),ae,A)}if(function(e){if(!c||!e||"object"!=typeof e)return!1;try{c.call(e);try{s.call(e)}catch(e){return!0}return e instanceof Set}catch(e){}return!1}(t)){var se=[];return d.call(t,(function(e){se.push(F(e,t))})),Q("Set",c.call(t),se,A)}if(function(e){if(!l||!e||"object"!=typeof e)return!1;try{l.call(e,l);try{p.call(e,p)}catch(e){return!0}return e instanceof WeakMap}catch(e){}return!1}(t))return $("WeakMap");if(function(e){if(!p||!e||"object"!=typeof e)return!1;try{p.call(e,p);try{l.call(e,l)}catch(e){return!0}return e instanceof WeakSet}catch(e){}return!1}(t))return $("WeakSet");if(function(e){if(!f||!e||"object"!=typeof e)return!1;try{return f.call(e),!0}catch(e){}return!1}(t))return $("WeakRef");if(function(e){return!("[object Number]"!==G(e)||U&&"object"==typeof e&&U in e)}(t))return K(F(Number(t)));if(function(e){if(!e||"object"!=typeof e||!R)return!1;try{return R.call(e),!0}catch(e){}return!1}(t))return K(F(R.call(t)));if(function(e){return!("[object Boolean]"!==G(e)||U&&"object"==typeof e&&U in e)}(t))return K(h.call(t));if(function(e){return!("[object String]"!==G(e)||U&&"object"==typeof e&&U in e)}(t))return K(F(String(t)));if(!function(e){return!("[object Date]"!==G(e)||U&&"object"==typeof e&&U in e)}(t)&&!function(e){return!("[object RegExp]"!==G(e)||U&&"object"==typeof e&&U in e)}(t)){var oe=X(t,F),ie=P?P(t)===Object.prototype:t instanceof Object||t.constructor===Object,ue=t instanceof Object?"":"null prototype",ce=!ie&&U&&Object(t)===t&&U in t?g.call(G(t),8,-1):ue?"Object":"",de=(ie||"function"!=typeof t.constructor?"":t.constructor.name?t.constructor.name+" ":"")+(ce||ue?"["+I.call(w.call([],ce||[],ue||[]),": ")+"] ":"");return 0===oe.length?de+"{}":A?de+"{"+J(oe,A)+"}":de+"{ "+I.call(oe,", ")+" }"}return String(t)};var B=Object.prototype.hasOwnProperty||function(e){return e in this};function H(e,t){return B.call(e,t)}function G(e){return v.call(e)}function z(e,t){if(e.indexOf)return e.indexOf(t);for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}function W(e,t){if(e.length>t.maxStringLength){var r=e.length-t.maxStringLength,n="... "+r+" more character"+(r>1?"s":"");return W(g.call(e,0,t.maxStringLength),t)+n}return N(b.call(b.call(e,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,V),"single",t)}function V(e){var t=e.charCodeAt(0),r={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return r?"\\"+r:"\\x"+(t<16?"0":"")+C.call(t.toString(16))}function K(e){return"Object("+e+")"}function $(e){return e+" { ? }"}function Q(e,t,r,n){return e+" ("+t+") {"+(n?J(r,n):I.call(r,", "))+"}"}function J(e,t){if(0===e.length)return"";var r="\n"+t.prev+t.base;return r+I.call(e,","+r)+"\n"+t.prev}function X(e,t){var r=D(e),n=[];if(r){n.length=e.length;for(var a=0;a<e.length;a++)n[a]=H(e,a)?t(e[a],e):""}var s,o="function"==typeof A?A(e):[];if(E){s={};for(var i=0;i<o.length;i++)s["$"+o[i]]=o[i]}for(var u in e)H(e,u)&&(r&&String(Number(u))===u&&u<e.length||E&&s["$"+u]instanceof Symbol||(k.call(/[^\w$]/,u)?n.push(t(u,e)+": "+t(e[u],e)):n.push(u+": "+t(e[u],e))));if("function"==typeof A)for(var c=0;c<o.length;c++)M.call(e,o[c])&&n.push("["+t(o[c])+"]: "+t(e[o[c]],e));return n}},97272:(e,t,r)=>{"use strict";var n=r(17642),a="function"==typeof Symbol&&"symbol"==typeof Symbol.unscopables,s=a&&Array.prototype[Symbol.unscopables],o=TypeError;e.exports=function(e){if("string"!=typeof e||!e)throw new o("method must be a non-empty string");if(!n(Array.prototype,e))throw new o("method must be on Array.prototype");a&&(s[e]=!0)}},41503:(e,t,r)=>{"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator,a=r(34149),s=r(95320),o=r(18923),i=r(12636),u=function(e,t){if(null==e)throw new TypeError("Cannot call method on "+e);if("string"!=typeof t||"number"!==t&&"string"!==t)throw new TypeError('hint must be "string" or "number"');var r,n,o,i="string"===t?["toString","valueOf"]:["valueOf","toString"];for(o=0;o<i.length;++o)if(r=e[i[o]],s(r)&&(n=r.call(e),a(n)))return n;throw new TypeError("No default value")},c=function(e,t){var r=e[t];if(null!=r){if(!s(r))throw new TypeError(r+" returned for property "+t+" of object "+e+" is not a function");return r}};e.exports=function(e){if(a(e))return e;var t,r="default";if(arguments.length>1&&(arguments[1]===String?r="string":arguments[1]===Number&&(r="number")),n&&(Symbol.toPrimitive?t=c(e,Symbol.toPrimitive):i(e)&&(t=Symbol.prototype.valueOf)),void 0!==t){var s=t.call(e,r);if(a(s))return s;throw new TypeError("unable to convert exotic object to primitive")}return"default"===r&&(o(e)||i(e))&&(r="string"),u(e,"default"===r?"number":r)}},34149:e=>{"use strict";e.exports=function(e){return null===e||"function"!=typeof e&&"object"!=typeof e}},17648:e=>{"use strict";var t="Function.prototype.bind called on incompatible ",r=Array.prototype.slice,n=Object.prototype.toString,a="[object Function]";e.exports=function(e){var s=this;if("function"!=typeof s||n.call(s)!==a)throw new TypeError(t+s);for(var o,i=r.call(arguments,1),u=function(){if(this instanceof o){var t=s.apply(this,i.concat(r.call(arguments)));return Object(t)===t?t:this}return s.apply(e,i.concat(r.call(arguments)))},c=Math.max(0,s.length-i.length),d=[],l=0;l<c;l++)d.push("$"+l);if(o=Function("binder","return function ("+d.join(",")+"){ return binder.apply(this,arguments); }")(u),s.prototype){var p=function(){};p.prototype=s.prototype,o.prototype=new p,p.prototype=null}return o}},58612:(e,t,r)=>{"use strict";var n=r(17648);e.exports=Function.prototype.bind||n},40210:(e,t,r)=>{"use strict";var n,a=SyntaxError,s=Function,o=TypeError,i=function(e){try{return s('"use strict"; return ('+e+").constructor;")()}catch(e){}},u=Object.getOwnPropertyDescriptor;if(u)try{u({},"")}catch(e){u=null}var c=function(){throw new o},d=u?function(){try{return c}catch(e){try{return u(arguments,"callee").get}catch(e){return c}}}():c,l=r(41405)(),p=Object.getPrototypeOf||function(e){return e.__proto__},f={},h="undefined"==typeof Uint8Array?n:p(Uint8Array),v={"%AggregateError%":"undefined"==typeof AggregateError?n:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?n:ArrayBuffer,"%ArrayIteratorPrototype%":l?p([][Symbol.iterator]()):n,"%AsyncFromSyncIteratorPrototype%":n,"%AsyncFunction%":f,"%AsyncGenerator%":f,"%AsyncGeneratorFunction%":f,"%AsyncIteratorPrototype%":f,"%Atomics%":"undefined"==typeof Atomics?n:Atomics,"%BigInt%":"undefined"==typeof BigInt?n:BigInt,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?n:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"==typeof Float32Array?n:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?n:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?n:FinalizationRegistry,"%Function%":s,"%GeneratorFunction%":f,"%Int8Array%":"undefined"==typeof Int8Array?n:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?n:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?n:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":l?p(p([][Symbol.iterator]())):n,"%JSON%":"object"==typeof JSON?JSON:n,"%Map%":"undefined"==typeof Map?n:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&l?p((new Map)[Symbol.iterator]()):n,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?n:Promise,"%Proxy%":"undefined"==typeof Proxy?n:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"==typeof Reflect?n:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?n:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&l?p((new Set)[Symbol.iterator]()):n,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?n:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":l?p(""[Symbol.iterator]()):n,"%Symbol%":l?Symbol:n,"%SyntaxError%":a,"%ThrowTypeError%":d,"%TypedArray%":h,"%TypeError%":o,"%Uint8Array%":"undefined"==typeof Uint8Array?n:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?n:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?n:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?n:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"==typeof WeakMap?n:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?n:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?n:WeakSet},m=function e(t){var r;if("%AsyncFunction%"===t)r=i("async function () {}");else if("%GeneratorFunction%"===t)r=i("function* () {}");else if("%AsyncGeneratorFunction%"===t)r=i("async function* () {}");else if("%AsyncGenerator%"===t){var n=e("%AsyncGeneratorFunction%");n&&(r=n.prototype)}else if("%AsyncIteratorPrototype%"===t){var a=e("%AsyncGenerator%");a&&(r=p(a.prototype))}return v[t]=r,r},y={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},g=r(58612),b=r(17642),C=g.call(Function.call,Array.prototype.concat),_=g.call(Function.apply,Array.prototype.splice),k=g.call(Function.call,String.prototype.replace),w=g.call(Function.call,String.prototype.slice),I=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,S=/\\(\\)?/g,O=function(e){var t=w(e,0,1),r=w(e,-1);if("%"===t&&"%"!==r)throw new a("invalid intrinsic syntax, expected closing `%`");if("%"===r&&"%"!==t)throw new a("invalid intrinsic syntax, expected opening `%`");var n=[];return k(e,I,(function(e,t,r,a){n[n.length]=r?k(a,S,"$1"):t||e})),n},R=function(e,t){var r,n=e;if(b(y,n)&&(n="%"+(r=y[n])[0]+"%"),b(v,n)){var s=v[n];if(s===f&&(s=m(n)),void 0===s&&!t)throw new o("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:r,name:n,value:s}}throw new a("intrinsic "+e+" does not exist!")};e.exports=function(e,t){if("string"!=typeof e||0===e.length)throw new o("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof t)throw new o('"allowMissing" argument must be a boolean');var r=O(e),n=r.length>0?r[0]:"",s=R("%"+n+"%",t),i=s.name,c=s.value,d=!1,l=s.alias;l&&(n=l[0],_(r,C([0,1],l)));for(var p=1,f=!0;p<r.length;p+=1){var h=r[p],m=w(h,0,1),y=w(h,-1);if(('"'===m||"'"===m||"`"===m||'"'===y||"'"===y||"`"===y)&&m!==y)throw new a("property names with quotes must have matching quotes");if("constructor"!==h&&f||(d=!0),b(v,i="%"+(n+="."+h)+"%"))c=v[i];else if(null!=c){if(!(h in c)){if(!t)throw new o("base intrinsic for "+e+" exists, but the property is not available.");return}if(u&&p+1>=r.length){var g=u(c,h);c=(f=!!g)&&"get"in g&&!("originalValue"in g.get)?g.get:c[h]}else f=b(c,h),c=c[h];f&&!d&&(v[i]=c)}}return c}},31044:(e,t,r)=>{"use strict";var n=r(40210)("%Object.defineProperty%",!0),a=function(){if(n)try{return n({},"a",{value:1}),!0}catch(e){return!1}return!1};a.hasArrayLengthDefineBug=function(){if(!a())return null;try{return 1!==n([],"length",{value:1}).length}catch(e){return!0}},e.exports=a},41405:(e,t,r)=>{"use strict";var n="undefined"!=typeof Symbol&&Symbol,a=r(55419);e.exports=function(){return"function"==typeof n&&("function"==typeof Symbol&&("symbol"==typeof n("foo")&&("symbol"==typeof Symbol("bar")&&a())))}},55419:e=>{"use strict";e.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var e={},t=Symbol("test"),r=Object(t);if("string"==typeof t)return!1;if("[object Symbol]"!==Object.prototype.toString.call(t))return!1;if("[object Symbol]"!==Object.prototype.toString.call(r))return!1;for(t in e[t]=42,e)return!1;if("function"==typeof Object.keys&&0!==Object.keys(e).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var n=Object.getOwnPropertySymbols(e);if(1!==n.length||n[0]!==t)return!1;if(!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var a=Object.getOwnPropertyDescriptor(e,t);if(42!==a.value||!0!==a.enumerable)return!1}return!0}},23695:(e,t,r)=>{"use strict";var n=r(55419);e.exports=function(){return n()&&!!Symbol.toStringTag}},17642:(e,t,r)=>{"use strict";var n=r(58612);e.exports=n.call(Function.call,Object.prototype.hasOwnProperty)},10746:(e,t,r)=>{"use strict";function n(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];throw Error("[Immer] minified error nr: "+e+(r.length?" "+r.map((function(e){return"'"+e+"'"})).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function a(e){return!!e&&!!e[K]}function s(e){return!!e&&(function(e){if(!e||"object"!=typeof e)return!1;var t=Object.getPrototypeOf(e);if(null===t)return!0;var r=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return r===Object||"function"==typeof r&&Function.toString.call(r)===Q}(e)||Array.isArray(e)||!!e[V]||!!e.constructor[V]||p(e)||f(e))}function o(e,t,r){void 0===r&&(r=!1),0===i(e)?(r?Object.keys:J)(e).forEach((function(n){r&&"symbol"==typeof n||t(n,e[n],e)})):e.forEach((function(r,n){return t(n,r,e)}))}function i(e){var t=e[K];return t?t.i>3?t.i-4:t.i:Array.isArray(e)?1:p(e)?2:f(e)?3:0}function u(e,t){return 2===i(e)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function c(e,t){return 2===i(e)?e.get(t):e[t]}function d(e,t,r){var n=i(e);2===n?e.set(t,r):3===n?(e.delete(t),e.add(r)):e[t]=r}function l(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}function p(e){return H&&e instanceof Map}function f(e){return G&&e instanceof Set}function h(e){return e.o||e.t}function v(e){if(Array.isArray(e))return Array.prototype.slice.call(e);var t=X(e);delete t[K];for(var r=J(t),n=0;n<r.length;n++){var a=r[n],s=t[a];!1===s.writable&&(s.writable=!0,s.configurable=!0),(s.get||s.set)&&(t[a]={configurable:!0,writable:!0,enumerable:s.enumerable,value:e[a]})}return Object.create(Object.getPrototypeOf(e),t)}function m(e,t){return void 0===t&&(t=!1),g(e)||a(e)||!s(e)||(i(e)>1&&(e.set=e.add=e.clear=e.delete=y),Object.freeze(e),t&&o(e,(function(e,t){return m(t,!0)}),!0)),e}function y(){n(2)}function g(e){return null==e||"object"!=typeof e||Object.isFrozen(e)}function b(e){var t=Y[e];return t||n(18,e),t}function C(e,t){Y[e]||(Y[e]=t)}function _(){return L}function k(e,t){t&&(b("Patches"),e.u=[],e.s=[],e.v=t)}function w(e){I(e),e.p.forEach(O),e.p=null}function I(e){e===L&&(L=e.l)}function S(e){return L={p:[],l:L,h:e,m:!0,_:0}}function O(e){var t=e[K];0===t.i||1===t.i?t.j():t.O=!0}function R(e,t){t._=t.p.length;var r=t.p[0],a=void 0!==e&&e!==r;return t.h.g||b("ES5").S(t,e,a),a?(r[K].P&&(w(t),n(4)),s(e)&&(e=A(t,e),t.l||E(t,e)),t.u&&b("Patches").M(r[K].t,e,t.u,t.s)):e=A(t,r,[]),w(t),t.u&&t.v(t.u,t.s),e!==W?e:void 0}function A(e,t,r){if(g(t))return t;var n=t[K];if(!n)return o(t,(function(a,s){return x(e,n,t,a,s,r)}),!0),t;if(n.A!==e)return t;if(!n.P)return E(e,n.t,!0),n.t;if(!n.I){n.I=!0,n.A._--;var a=4===n.i||5===n.i?n.o=v(n.k):n.o;o(3===n.i?new Set(a):a,(function(t,s){return x(e,n,a,t,s,r)})),E(e,a,!1),r&&e.u&&b("Patches").R(n,r,e.u,e.s)}return n.o}function x(e,t,r,n,o,i){if(a(o)){var c=A(e,o,i&&t&&3!==t.i&&!u(t.D,n)?i.concat(n):void 0);if(d(r,n,c),!a(c))return;e.m=!1}if(s(o)&&!g(o)){if(!e.h.F&&e._<1)return;A(e,o),t&&t.A.l||E(e,o)}}function E(e,t,r){void 0===r&&(r=!1),e.h.F&&e.m&&m(t,r)}function U(e,t){var r=e[K];return(r?h(r):e)[t]}function M(e,t){if(t in e)for(var r=Object.getPrototypeOf(e);r;){var n=Object.getOwnPropertyDescriptor(r,t);if(n)return n;r=Object.getPrototypeOf(r)}}function P(e){e.P||(e.P=!0,e.l&&P(e.l))}function j(e){e.o||(e.o=v(e.t))}function F(e,t,r){var n=p(t)?b("MapSet").N(t,r):f(t)?b("MapSet").T(t,r):e.g?function(e,t){var r=Array.isArray(e),n={i:r?1:0,A:t?t.A:_(),P:!1,I:!1,D:{},l:t,t:e,k:null,o:null,j:null,C:!1},a=n,s=Z;r&&(a=[n],s=ee);var o=Proxy.revocable(a,s),i=o.revoke,u=o.proxy;return n.k=u,n.j=i,u}(t,r):b("ES5").J(t,r);return(r?r.A:_()).p.push(n),n}function q(e){return a(e)||n(22,e),function e(t){if(!s(t))return t;var r,n=t[K],a=i(t);if(n){if(!n.P&&(n.i<4||!b("ES5").K(n)))return n.t;n.I=!0,r=N(t,a),n.I=!1}else r=N(t,a);return o(r,(function(t,a){n&&c(n.t,t)===a||d(r,t,e(a))})),3===a?new Set(r):r}(e)}function N(e,t){switch(t){case 2:return new Map(e);case 3:return Array.from(e)}return v(e)}function T(){function e(e,t){function r(){this.constructor=e}i(e,t),e.prototype=(r.prototype=t.prototype,new r)}function t(e){e.o||(e.D=new Map,e.o=new Map(e.t))}function r(e){e.o||(e.o=new Set,e.t.forEach((function(t){if(s(t)){var r=F(e.A.h,t,e);e.p.set(t,r),e.o.add(r)}else e.o.add(t)})))}function a(e){e.O&&n(3,JSON.stringify(h(e)))}var i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},u=function(){function r(e,t){return this[K]={i:2,l:t,A:t?t.A:_(),P:!1,I:!1,o:void 0,D:void 0,t:e,k:this,C:!1,O:!1},this}e(r,Map);var n=r.prototype;return Object.defineProperty(n,"size",{get:function(){return h(this[K]).size}}),n.has=function(e){return h(this[K]).has(e)},n.set=function(e,r){var n=this[K];return a(n),h(n).has(e)&&h(n).get(e)===r||(t(n),P(n),n.D.set(e,!0),n.o.set(e,r),n.D.set(e,!0)),this},n.delete=function(e){if(!this.has(e))return!1;var r=this[K];return a(r),t(r),P(r),r.t.has(e)?r.D.set(e,!1):r.D.delete(e),r.o.delete(e),!0},n.clear=function(){var e=this[K];a(e),h(e).size&&(t(e),P(e),e.D=new Map,o(e.t,(function(t){e.D.set(t,!1)})),e.o.clear())},n.forEach=function(e,t){var r=this;h(this[K]).forEach((function(n,a){e.call(t,r.get(a),a,r)}))},n.get=function(e){var r=this[K];a(r);var n=h(r).get(e);if(r.I||!s(n))return n;if(n!==r.t.get(e))return n;var o=F(r.A.h,n,r);return t(r),r.o.set(e,o),o},n.keys=function(){return h(this[K]).keys()},n.values=function(){var e,t=this,r=this.keys();return(e={})[$]=function(){return t.values()},e.next=function(){var e=r.next();return e.done?e:{done:!1,value:t.get(e.value)}},e},n.entries=function(){var e,t=this,r=this.keys();return(e={})[$]=function(){return t.entries()},e.next=function(){var e=r.next();if(e.done)return e;var n=t.get(e.value);return{done:!1,value:[e.value,n]}},e},n[$]=function(){return this.entries()},r}(),c=function(){function t(e,t){return this[K]={i:3,l:t,A:t?t.A:_(),P:!1,I:!1,o:void 0,t:e,k:this,p:new Map,O:!1,C:!1},this}e(t,Set);var n=t.prototype;return Object.defineProperty(n,"size",{get:function(){return h(this[K]).size}}),n.has=function(e){var t=this[K];return a(t),t.o?!!t.o.has(e)||!(!t.p.has(e)||!t.o.has(t.p.get(e))):t.t.has(e)},n.add=function(e){var t=this[K];return a(t),this.has(e)||(r(t),P(t),t.o.add(e)),this},n.delete=function(e){if(!this.has(e))return!1;var t=this[K];return a(t),r(t),P(t),t.o.delete(e)||!!t.p.has(e)&&t.o.delete(t.p.get(e))},n.clear=function(){var e=this[K];a(e),h(e).size&&(r(e),P(e),e.o.clear())},n.values=function(){var e=this[K];return a(e),r(e),e.o.values()},n.entries=function(){var e=this[K];return a(e),r(e),e.o.entries()},n.keys=function(){return this.values()},n[$]=function(){return this.values()},n.forEach=function(e,t){for(var r=this.values(),n=r.next();!n.done;)e.call(t,n.value,n.value,this),n=r.next()},t}();C("MapSet",{N:function(e,t){return new u(e,t)},T:function(e,t){return new c(e,t)}})}r.d(t,{default:()=>ie,createDraft:()=>se,current:()=>q,enableMapSet:()=>T,finishDraft:()=>oe,produce:()=>ne,setAutoFreeze:()=>ae});var D,L,B="undefined"!=typeof Symbol&&"symbol"==typeof Symbol("x"),H="undefined"!=typeof Map,G="undefined"!=typeof Set,z="undefined"!=typeof Proxy&&void 0!==Proxy.revocable&&"undefined"!=typeof Reflect,W=B?Symbol.for("immer-nothing"):((D={})["immer-nothing"]=!0,D),V=B?Symbol.for("immer-draftable"):"__$immer_draftable",K=B?Symbol.for("immer-state"):"__$immer_state",$="undefined"!=typeof Symbol&&Symbol.iterator||"@@iterator",Q=""+Object.prototype.constructor,J="undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:void 0!==Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames,X=Object.getOwnPropertyDescriptors||function(e){var t={};return J(e).forEach((function(r){t[r]=Object.getOwnPropertyDescriptor(e,r)})),t},Y={},Z={get:function(e,t){if(t===K)return e;var r=h(e);if(!u(r,t))return function(e,t,r){var n,a=M(t,r);return a?"value"in a?a.value:null===(n=a.get)||void 0===n?void 0:n.call(e.k):void 0}(e,r,t);var n=r[t];return e.I||!s(n)?n:n===U(e.t,t)?(j(e),e.o[t]=F(e.A.h,n,e)):n},has:function(e,t){return t in h(e)},ownKeys:function(e){return Reflect.ownKeys(h(e))},set:function(e,t,r){var n=M(h(e),t);if(null==n?void 0:n.set)return n.set.call(e.k,r),!0;if(!e.P){var a=U(h(e),t),s=null==a?void 0:a[K];if(s&&s.t===r)return e.o[t]=r,e.D[t]=!1,!0;if(l(r,a)&&(void 0!==r||u(e.t,t)))return!0;j(e),P(e)}return e.o[t]===r&&"number"!=typeof r&&(void 0!==r||t in e.o)||(e.o[t]=r,e.D[t]=!0,!0)},deleteProperty:function(e,t){return void 0!==U(e.t,t)||t in e.t?(e.D[t]=!1,j(e),P(e)):delete e.D[t],e.o&&delete e.o[t],!0},getOwnPropertyDescriptor:function(e,t){var r=h(e),n=Reflect.getOwnPropertyDescriptor(r,t);return n?{writable:!0,configurable:1!==e.i||"length"!==t,enumerable:n.enumerable,value:r[t]}:n},defineProperty:function(){n(11)},getPrototypeOf:function(e){return Object.getPrototypeOf(e.t)},setPrototypeOf:function(){n(12)}},ee={};o(Z,(function(e,t){ee[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}})),ee.deleteProperty=function(e,t){return ee.set.call(this,e,t,void 0)},ee.set=function(e,t,r){return Z.set.call(this,e[0],t,r,e[0])};var te=function(){function e(e){var t=this;this.g=z,this.F=!0,this.produce=function(e,r,a){if("function"==typeof e&&"function"!=typeof r){var o=r;r=e;var i=t;return function(e){var t=this;void 0===e&&(e=o);for(var n=arguments.length,a=Array(n>1?n-1:0),s=1;s<n;s++)a[s-1]=arguments[s];return i.produce(e,(function(e){var n;return(n=r).call.apply(n,[t,e].concat(a))}))}}var u;if("function"!=typeof r&&n(6),void 0!==a&&"function"!=typeof a&&n(7),s(e)){var c=S(t),d=F(t,e,void 0),l=!0;try{u=r(d),l=!1}finally{l?w(c):I(c)}return"undefined"!=typeof Promise&&u instanceof Promise?u.then((function(e){return k(c,a),R(e,c)}),(function(e){throw w(c),e})):(k(c,a),R(u,c))}if(!e||"object"!=typeof e){if(void 0===(u=r(e))&&(u=e),u===W&&(u=void 0),t.F&&m(u,!0),a){var p=[],f=[];b("Patches").M(e,u,p,f),a(p,f)}return u}n(21,e)},this.produceWithPatches=function(e,r){if("function"==typeof e)return function(r){for(var n=arguments.length,a=Array(n>1?n-1:0),s=1;s<n;s++)a[s-1]=arguments[s];return t.produceWithPatches(r,(function(t){return e.apply(void 0,[t].concat(a))}))};var n,a,s=t.produce(e,r,(function(e,t){n=e,a=t}));return"undefined"!=typeof Promise&&s instanceof Promise?s.then((function(e){return[e,n,a]})):[s,n,a]},"boolean"==typeof(null==e?void 0:e.useProxies)&&this.setUseProxies(e.useProxies),"boolean"==typeof(null==e?void 0:e.autoFreeze)&&this.setAutoFreeze(e.autoFreeze)}var t=e.prototype;return t.createDraft=function(e){s(e)||n(8),a(e)&&(e=q(e));var t=S(this),r=F(this,e,void 0);return r[K].C=!0,I(t),r},t.finishDraft=function(e,t){var r=(e&&e[K]).A;return k(r,t),R(void 0,r)},t.setAutoFreeze=function(e){this.F=e},t.setUseProxies=function(e){e&&!z&&n(20),this.g=e},t.applyPatches=function(e,t){var r;for(r=t.length-1;r>=0;r--){var n=t[r];if(0===n.path.length&&"replace"===n.op){e=n.value;break}}r>-1&&(t=t.slice(r+1));var s=b("Patches").$;return a(e)?s(e,t):this.produce(e,(function(e){return s(e,t)}))},e}(),re=new te,ne=re.produce,ae=(re.produceWithPatches.bind(re),re.setAutoFreeze.bind(re)),se=(re.setUseProxies.bind(re),re.applyPatches.bind(re),re.createDraft.bind(re)),oe=re.finishDraft.bind(re);const ie=ne},95320:e=>{"use strict";var t=Function.prototype.toString,r=/^\s*class\b/,n=function(e){try{var n=t.call(e);return r.test(n)}catch(e){return!1}},a=Object.prototype.toString,s="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag;e.exports=function(e){if(!e)return!1;if("function"!=typeof e&&"object"!=typeof e)return!1;if("function"==typeof e&&!e.prototype)return!0;if(s)return function(e){try{return!n(e)&&(t.call(e),!0)}catch(e){return!1}}(e);if(n(e))return!1;var r=a.call(e);return"[object Function]"===r||"[object GeneratorFunction]"===r}},18923:e=>{"use strict";var t=Date.prototype.getDay,r=Object.prototype.toString,n="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag;e.exports=function(e){return"object"==typeof e&&null!==e&&(n?function(e){try{return t.call(e),!0}catch(e){return!1}}(e):"[object Date]"===r.call(e))}},98420:(e,t,r)=>{"use strict";var n,a,s,o,i=r(21924),u=r(23695)();if(u){n=i("Object.prototype.hasOwnProperty"),a=i("RegExp.prototype.exec"),s={};var c=function(){throw s};o={toString:c,valueOf:c},"symbol"==typeof Symbol.toPrimitive&&(o[Symbol.toPrimitive]=c)}var d=i("Object.prototype.toString"),l=Object.getOwnPropertyDescriptor;e.exports=u?function(e){if(!e||"object"!=typeof e)return!1;var t=l(e,"lastIndex");if(!(t&&n(t,"value")))return!1;try{a(e,o)}catch(e){return e===s}}:function(e){return!(!e||"object"!=typeof e&&"function"!=typeof e)&&"[object RegExp]"===d(e)}},12636:(e,t,r)=>{"use strict";var n=Object.prototype.toString;if(r(41405)()){var a=Symbol.prototype.toString,s=/^Symbol\(.*\)$/;e.exports=function(e){if("symbol"==typeof e)return!0;if("[object Symbol]"!==n.call(e))return!1;try{return function(e){return"symbol"==typeof e.valueOf()&&s.test(a.call(e))}(e)}catch(e){return!1}}}else e.exports=function(e){return!1}},68641:()=>{},29354:()=>{},18987:(e,t,r)=>{"use strict";var n;if(!Object.keys){var a=Object.prototype.hasOwnProperty,s=Object.prototype.toString,o=r(50884),i=Object.prototype.propertyIsEnumerable,u=!i.call({toString:null},"toString"),c=i.call((function(){}),"prototype"),d=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],l=function(e){var t=e.constructor;return t&&t.prototype===e},p={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},f=function(){if("undefined"==typeof window)return!1;for(var e in window)try{if(!p["$"+e]&&a.call(window,e)&&null!==window[e]&&"object"==typeof window[e])try{l(window[e])}catch(e){return!0}}catch(e){return!0}return!1}();n=function(e){var t=null!==e&&"object"==typeof e,r="[object Function]"===s.call(e),n=o(e),i=t&&"[object String]"===s.call(e),p=[];if(!t&&!r&&!n)throw new TypeError("Object.keys called on a non-object");var h=c&&r;if(i&&e.length>0&&!a.call(e,0))for(var v=0;v<e.length;++v)p.push(String(v));if(n&&e.length>0)for(var m=0;m<e.length;++m)p.push(String(m));else for(var y in e)h&&"prototype"===y||!a.call(e,y)||p.push(String(y));if(u)for(var g=function(e){if("undefined"==typeof window||!f)return l(e);try{return l(e)}catch(e){return!1}}(e),b=0;b<d.length;++b)g&&"constructor"===d[b]||!a.call(e,d[b])||p.push(d[b]);return p}}e.exports=n},82215:(e,t,r)=>{"use strict";var n=Array.prototype.slice,a=r(50884),s=Object.keys,o=s?function(e){return s(e)}:r(18987),i=Object.keys;o.shim=function(){if(Object.keys){var e=function(){var e=Object.keys(arguments);return e&&e.length===arguments.length}(1,2);e||(Object.keys=function(e){return a(e)?i(n.call(e)):i(e)})}else Object.keys=o;return Object.keys||o},e.exports=o},50884:e=>{"use strict";var t=Object.prototype.toString;e.exports=function(e){var r=t.call(e),n="[object Arguments]"===r;return n||(n="[object Array]"!==r&&null!==e&&"object"==typeof e&&"number"==typeof e.length&&e.length>=0&&"[object Function]"===t.call(e.callee)),n}},11728:(e,t,r)=>{"use strict";r.d(t,{default:()=>g});var n=r(67294),a=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},u=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,a=!1,s=void 0;try{for(var o,i=e[Symbol.iterator]();!(n=(o=i.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){a=!0,s=e}finally{try{!n&&i.return&&i.return()}finally{if(a)throw s}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},c=void 0;c="undefined"!=typeof window?window:"undefined"!=typeof self?self:r.g;var d=null,l=null,p=c.clearTimeout,f=c.setTimeout,h=c.cancelAnimationFrame||c.mozCancelAnimationFrame||c.webkitCancelAnimationFrame,v=c.requestAnimationFrame||c.mozRequestAnimationFrame||c.webkitRequestAnimationFrame;function m(e){var t=void 0,r=void 0,n=void 0,a=void 0,s=void 0,o=void 0,i=void 0,u="undefined"!=typeof document&&document.attachEvent;if(!u){o=function(e){var t=e.__resizeTriggers__,r=t.firstElementChild,n=t.lastElementChild,a=r.firstElementChild;n.scrollLeft=n.scrollWidth,n.scrollTop=n.scrollHeight,a.style.width=r.offsetWidth+1+"px",a.style.height=r.offsetHeight+1+"px",r.scrollLeft=r.scrollWidth,r.scrollTop=r.scrollHeight},s=function(e){return e.offsetWidth!==e.__resizeLast__.width||e.offsetHeight!==e.__resizeLast__.height},i=function(e){if(!(e.target.className&&"function"==typeof e.target.className.indexOf&&e.target.className.indexOf("contract-trigger")<0&&e.target.className.indexOf("expand-trigger")<0)){var t=this;o(this),this.__resizeRAF__&&d(this.__resizeRAF__),this.__resizeRAF__=l((function(){s(t)&&(t.__resizeLast__.width=t.offsetWidth,t.__resizeLast__.height=t.offsetHeight,t.__resizeListeners__.forEach((function(r){r.call(t,e)})))}))}};var p=!1,f="";n="animationstart";var h="Webkit Moz O ms".split(" "),v="webkitAnimationStart animationstart oAnimationStart MSAnimationStart".split(" "),m=document.createElement("fakeelement");if(void 0!==m.style.animationName&&(p=!0),!1===p)for(var y=0;y<h.length;y++)if(void 0!==m.style[h[y]+"AnimationName"]){f="-"+h[y].toLowerCase()+"-",n=v[y],p=!0;break}t="@"+f+"keyframes "+(r="resizeanim")+" { from { opacity: 0; } to { opacity: 0; } } ",a=f+"animation: 1ms "+r+"; "}return{addResizeListener:function(s,d){if(u)s.attachEvent("onresize",d);else{if(!s.__resizeTriggers__){var l=s.ownerDocument,p=c.getComputedStyle(s);p&&"static"===p.position&&(s.style.position="relative"),function(r){if(!r.getElementById("detectElementResize")){var n=(t||"")+".resize-triggers { "+(a||"")+'visibility: hidden; opacity: 0; } .resize-triggers, .resize-triggers > div, .contract-trigger:before { content: " "; display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; z-index: -1; } .resize-triggers > div { background: #eee; overflow: auto; } .contract-trigger:before { width: 200%; height: 200%; }',s=r.head||r.getElementsByTagName("head")[0],o=r.createElement("style");o.id="detectElementResize",o.type="text/css",null!=e&&o.setAttribute("nonce",e),o.styleSheet?o.styleSheet.cssText=n:o.appendChild(r.createTextNode(n)),s.appendChild(o)}}(l),s.__resizeLast__={},s.__resizeListeners__=[],(s.__resizeTriggers__=l.createElement("div")).className="resize-triggers";var f=l.createElement("div");f.className="expand-trigger",f.appendChild(l.createElement("div"));var h=l.createElement("div");h.className="contract-trigger",s.__resizeTriggers__.appendChild(f),s.__resizeTriggers__.appendChild(h),s.appendChild(s.__resizeTriggers__),o(s),s.addEventListener("scroll",i,!0),n&&(s.__resizeTriggers__.__animationListener__=function(e){e.animationName===r&&o(s)},s.__resizeTriggers__.addEventListener(n,s.__resizeTriggers__.__animationListener__))}s.__resizeListeners__.push(d)}},removeResizeListener:function(e,t){if(u)e.detachEvent("onresize",t);else if(e.__resizeListeners__.splice(e.__resizeListeners__.indexOf(t),1),!e.__resizeListeners__.length){e.removeEventListener("scroll",i,!0),e.__resizeTriggers__.__animationListener__&&(e.__resizeTriggers__.removeEventListener(n,e.__resizeTriggers__.__animationListener__),e.__resizeTriggers__.__animationListener__=null);try{e.__resizeTriggers__=!e.removeChild(e.__resizeTriggers__)}catch(e){}}}}}null==h||null==v?(d=p,l=function(e){return f(e,20)}):(d=function(e){var t=u(e,2),r=t[0],n=t[1];h(r),p(n)},l=function(e){var t=v((function(){p(r),e()})),r=f((function(){h(t),e()}),20);return[t,r]});var y=function(e){function t(){var e,r,n;a(this,t);for(var s=arguments.length,o=Array(s),u=0;u<s;u++)o[u]=arguments[u];return r=n=i(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),n.state={height:n.props.defaultHeight||0,width:n.props.defaultWidth||0},n._onResize=function(){var e=n.props,t=e.disableHeight,r=e.disableWidth,a=e.onResize;if(n._parentNode){var s=n._parentNode.offsetHeight||0,o=n._parentNode.offsetWidth||0,i=window.getComputedStyle(n._parentNode)||{},u=parseInt(i.paddingLeft,10)||0,c=parseInt(i.paddingRight,10)||0,d=parseInt(i.paddingTop,10)||0,l=parseInt(i.paddingBottom,10)||0,p=s-d-l,f=o-u-c;(!t&&n.state.height!==p||!r&&n.state.width!==f)&&(n.setState({height:s-d-l,width:o-u-c}),a({height:s,width:o}))}},n._setRef=function(e){n._autoSizer=e},i(n,r)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),s(t,[{key:"componentDidMount",value:function(){var e=this.props.nonce;this._autoSizer&&this._autoSizer.parentNode&&this._autoSizer.parentNode.ownerDocument&&this._autoSizer.parentNode.ownerDocument.defaultView&&this._autoSizer.parentNode instanceof this._autoSizer.parentNode.ownerDocument.defaultView.HTMLElement&&(this._parentNode=this._autoSizer.parentNode,this._detectElementResize=m(e),this._detectElementResize.addResizeListener(this._parentNode,this._onResize),this._onResize())}},{key:"componentWillUnmount",value:function(){this._detectElementResize&&this._parentNode&&this._detectElementResize.removeResizeListener(this._parentNode,this._onResize)}},{key:"render",value:function(){var e=this.props,t=e.children,r=e.className,a=e.disableHeight,s=e.disableWidth,i=e.style,u=this.state,c=u.height,d=u.width,l={overflow:"visible"},p={},f=!1;return a||(0===c&&(f=!0),l.height=0,p.height=c),s||(0===d&&(f=!0),l.width=0,p.width=d),(0,n.createElement)("div",{className:r,ref:this._setRef,style:o({},l,i)},!f&&t(p))}}]),t}(n.PureComponent);y.defaultProps={onResize:function(){},disableHeight:!1,disableWidth:!1,style:{}};const g=y},57554:(e,t,r)=>{"use strict";function n(){return n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},n.apply(this,arguments)}function a(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function s(e,t){return s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},s(e,t)}function o(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,s(e,t)}r.d(t,{FixedSizeList:()=>I,VariableSizeList:()=>w});var i=Number.isNaN||function(e){return"number"==typeof e&&e!=e};function u(e,t){if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(n=e[r],a=t[r],!(n===a||i(n)&&i(a)))return!1;var n,a;return!0}const c=function(e,t){var r;void 0===t&&(t=u);var n,a=[],s=!1;return function(){for(var o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];return s&&r===this&&t(o,a)||(n=e.apply(this,o),s=!0,r=this,a=o),n}};var d=r(67294);var l="object"==typeof performance&&"function"==typeof performance.now?function(){return performance.now()}:function(){return Date.now()};function p(e){cancelAnimationFrame(e.id)}function f(e,t){var r=l();var n={id:requestAnimationFrame((function a(){l()-r>=t?e.call(null):n.id=requestAnimationFrame(a)}))};return n}var h=null;function v(e){if(void 0===e&&(e=!1),null===h||e){var t=document.createElement("div"),r=t.style;r.width="50px",r.height="50px",r.overflow="scroll",r.direction="rtl";var n=document.createElement("div"),a=n.style;return a.width="100px",a.height="100px",t.appendChild(n),document.body.appendChild(t),t.scrollLeft>0?h="positive-descending":(t.scrollLeft=1,h=0===t.scrollLeft?"negative":"positive-ascending"),document.body.removeChild(t),h}return h}var m=function(e,t){return e};function y(e){var t,r=e.getItemOffset,s=e.getEstimatedTotalSize,i=e.getItemSize,u=e.getOffsetForIndexAndAlignment,l=e.getStartIndexForOffset,h=e.getStopIndexForStartIndex,y=e.initInstanceProps,b=e.shouldResetStyleCacheOnItemSizeChange,C=e.validateProps;return t=function(e){function t(t){var n;return(n=e.call(this,t)||this)._instanceProps=y(n.props,a(n)),n._outerRef=void 0,n._resetIsScrollingTimeoutId=null,n.state={instance:a(n),isScrolling:!1,scrollDirection:"forward",scrollOffset:"number"==typeof n.props.initialScrollOffset?n.props.initialScrollOffset:0,scrollUpdateWasRequested:!1},n._callOnItemsRendered=void 0,n._callOnItemsRendered=c((function(e,t,r,a){return n.props.onItemsRendered({overscanStartIndex:e,overscanStopIndex:t,visibleStartIndex:r,visibleStopIndex:a})})),n._callOnScroll=void 0,n._callOnScroll=c((function(e,t,r){return n.props.onScroll({scrollDirection:e,scrollOffset:t,scrollUpdateWasRequested:r})})),n._getItemStyle=void 0,n._getItemStyle=function(e){var t,a=n.props,s=a.direction,o=a.itemSize,u=a.layout,c=n._getItemStyleCache(b&&o,b&&u,b&&s);if(c.hasOwnProperty(e))t=c[e];else{var d=r(n.props,e,n._instanceProps),l=i(n.props,e,n._instanceProps),p="horizontal"===s||"horizontal"===u,f="rtl"===s,h=p?d:0;c[e]=t={position:"absolute",left:f?void 0:h,right:f?h:void 0,top:p?0:d,height:p?"100%":l,width:p?l:"100%"}}return t},n._getItemStyleCache=void 0,n._getItemStyleCache=c((function(e,t,r){return{}})),n._onScrollHorizontal=function(e){var t=e.currentTarget,r=t.clientWidth,a=t.scrollLeft,s=t.scrollWidth;n.setState((function(e){if(e.scrollOffset===a)return null;var t=n.props.direction,o=a;if("rtl"===t)switch(v()){case"negative":o=-a;break;case"positive-descending":o=s-r-a}return o=Math.max(0,Math.min(o,s-r)),{isScrolling:!0,scrollDirection:e.scrollOffset<a?"forward":"backward",scrollOffset:o,scrollUpdateWasRequested:!1}}),n._resetIsScrollingDebounced)},n._onScrollVertical=function(e){var t=e.currentTarget,r=t.clientHeight,a=t.scrollHeight,s=t.scrollTop;n.setState((function(e){if(e.scrollOffset===s)return null;var t=Math.max(0,Math.min(s,a-r));return{isScrolling:!0,scrollDirection:e.scrollOffset<t?"forward":"backward",scrollOffset:t,scrollUpdateWasRequested:!1}}),n._resetIsScrollingDebounced)},n._outerRefSetter=function(e){var t=n.props.outerRef;n._outerRef=e,"function"==typeof t?t(e):null!=t&&"object"==typeof t&&t.hasOwnProperty("current")&&(t.current=e)},n._resetIsScrollingDebounced=function(){null!==n._resetIsScrollingTimeoutId&&p(n._resetIsScrollingTimeoutId),n._resetIsScrollingTimeoutId=f(n._resetIsScrolling,150)},n._resetIsScrolling=function(){n._resetIsScrollingTimeoutId=null,n.setState({isScrolling:!1},(function(){n._getItemStyleCache(-1,null)}))},n}o(t,e),t.getDerivedStateFromProps=function(e,t){return g(e,t),C(e),null};var _=t.prototype;return _.scrollTo=function(e){e=Math.max(0,e),this.setState((function(t){return t.scrollOffset===e?null:{scrollDirection:t.scrollOffset<e?"forward":"backward",scrollOffset:e,scrollUpdateWasRequested:!0}}),this._resetIsScrollingDebounced)},_.scrollToItem=function(e,t){void 0===t&&(t="auto");var r=this.props.itemCount,n=this.state.scrollOffset;e=Math.max(0,Math.min(e,r-1)),this.scrollTo(u(this.props,e,t,n,this._instanceProps))},_.componentDidMount=function(){var e=this.props,t=e.direction,r=e.initialScrollOffset,n=e.layout;if("number"==typeof r&&null!=this._outerRef){var a=this._outerRef;"horizontal"===t||"horizontal"===n?a.scrollLeft=r:a.scrollTop=r}this._callPropsCallbacks()},_.componentDidUpdate=function(){var e=this.props,t=e.direction,r=e.layout,n=this.state,a=n.scrollOffset;if(n.scrollUpdateWasRequested&&null!=this._outerRef){var s=this._outerRef;if("horizontal"===t||"horizontal"===r)if("rtl"===t)switch(v()){case"negative":s.scrollLeft=-a;break;case"positive-ascending":s.scrollLeft=a;break;default:var o=s.clientWidth,i=s.scrollWidth;s.scrollLeft=i-o-a}else s.scrollLeft=a;else s.scrollTop=a}this._callPropsCallbacks()},_.componentWillUnmount=function(){null!==this._resetIsScrollingTimeoutId&&p(this._resetIsScrollingTimeoutId)},_.render=function(){var e=this.props,t=e.children,r=e.className,a=e.direction,o=e.height,i=e.innerRef,u=e.innerElementType,c=e.innerTagName,l=e.itemCount,p=e.itemData,f=e.itemKey,h=void 0===f?m:f,v=e.layout,y=e.outerElementType,g=e.outerTagName,b=e.style,C=e.useIsScrolling,_=e.width,k=this.state.isScrolling,w="horizontal"===a||"horizontal"===v,I=w?this._onScrollHorizontal:this._onScrollVertical,S=this._getRangeToRender(),O=S[0],R=S[1],A=[];if(l>0)for(var x=O;x<=R;x++)A.push((0,d.createElement)(t,{data:p,key:h(x,p),index:x,isScrolling:C?k:void 0,style:this._getItemStyle(x)}));var E=s(this.props,this._instanceProps);return(0,d.createElement)(y||g||"div",{className:r,onScroll:I,ref:this._outerRefSetter,style:n({position:"relative",height:o,width:_,overflow:"auto",WebkitOverflowScrolling:"touch",willChange:"transform",direction:a},b)},(0,d.createElement)(u||c||"div",{children:A,ref:i,style:{height:w?"100%":E,pointerEvents:k?"none":void 0,width:w?E:"100%"}}))},_._callPropsCallbacks=function(){if("function"==typeof this.props.onItemsRendered&&this.props.itemCount>0){var e=this._getRangeToRender(),t=e[0],r=e[1],n=e[2],a=e[3];this._callOnItemsRendered(t,r,n,a)}if("function"==typeof this.props.onScroll){var s=this.state,o=s.scrollDirection,i=s.scrollOffset,u=s.scrollUpdateWasRequested;this._callOnScroll(o,i,u)}},_._getRangeToRender=function(){var e=this.props,t=e.itemCount,r=e.overscanCount,n=this.state,a=n.isScrolling,s=n.scrollDirection,o=n.scrollOffset;if(0===t)return[0,0,0,0];var i=l(this.props,o,this._instanceProps),u=h(this.props,i,o,this._instanceProps),c=a&&"backward"!==s?1:Math.max(1,r),d=a&&"forward"!==s?1:Math.max(1,r);return[Math.max(0,i-c),Math.max(0,Math.min(t-1,u+d)),i,u]},t}(d.PureComponent),t.defaultProps={direction:"ltr",itemData:void 0,layout:"vertical",overscanCount:2,useIsScrolling:!1},t}var g=function(e,t){e.children,e.direction,e.height,e.layout,e.innerTagName,e.outerTagName,e.width,t.instance},b=function(e,t,r){var n=e.itemSize,a=r.itemMetadataMap,s=r.lastMeasuredIndex;if(t>s){var o=0;if(s>=0){var i=a[s];o=i.offset+i.size}for(var u=s+1;u<=t;u++){var c=n(u);a[u]={offset:o,size:c},o+=c}r.lastMeasuredIndex=t}return a[t]},C=function(e,t,r,n,a){for(;n<=r;){var s=n+Math.floor((r-n)/2),o=b(e,s,t).offset;if(o===a)return s;o<a?n=s+1:o>a&&(r=s-1)}return n>0?n-1:0},_=function(e,t,r,n){for(var a=e.itemCount,s=1;r<a&&b(e,r,t).offset<n;)r+=s,s*=2;return C(e,t,Math.min(r,a-1),Math.floor(r/2),n)},k=function(e,t){var r=e.itemCount,n=t.itemMetadataMap,a=t.estimatedItemSize,s=t.lastMeasuredIndex,o=0;if(s>=r&&(s=r-1),s>=0){var i=n[s];o=i.offset+i.size}return o+(r-s-1)*a},w=y({getItemOffset:function(e,t,r){return b(e,t,r).offset},getItemSize:function(e,t,r){return r.itemMetadataMap[t].size},getEstimatedTotalSize:k,getOffsetForIndexAndAlignment:function(e,t,r,n,a){var s=e.direction,o=e.height,i=e.layout,u=e.width,c="horizontal"===s||"horizontal"===i?u:o,d=b(e,t,a),l=k(e,a),p=Math.max(0,Math.min(l-c,d.offset)),f=Math.max(0,d.offset-c+d.size);switch("smart"===r&&(r=n>=f-c&&n<=p+c?"auto":"center"),r){case"start":return p;case"end":return f;case"center":return Math.round(f+(p-f)/2);default:return n>=f&&n<=p?n:n<f?f:p}},getStartIndexForOffset:function(e,t,r){return function(e,t,r){var n=t.itemMetadataMap,a=t.lastMeasuredIndex;return(a>0?n[a].offset:0)>=r?C(e,t,a,0,r):_(e,t,Math.max(0,a),r)}(e,r,t)},getStopIndexForStartIndex:function(e,t,r,n){for(var a=e.direction,s=e.height,o=e.itemCount,i=e.layout,u=e.width,c="horizontal"===a||"horizontal"===i?u:s,d=b(e,t,n),l=r+c,p=d.offset+d.size,f=t;f<o-1&&p<l;)f++,p+=b(e,f,n).size;return f},initInstanceProps:function(e,t){var r={itemMetadataMap:{},estimatedItemSize:e.estimatedItemSize||50,lastMeasuredIndex:-1};return t.resetAfterIndex=function(e,n){void 0===n&&(n=!0),r.lastMeasuredIndex=Math.min(r.lastMeasuredIndex,e-1),t._getItemStyleCache(-1),n&&t.forceUpdate()},r},shouldResetStyleCacheOnItemSizeChange:!1,validateProps:function(e){e.itemSize}}),I=y({getItemOffset:function(e,t){return t*e.itemSize},getItemSize:function(e,t){return e.itemSize},getEstimatedTotalSize:function(e){var t=e.itemCount;return e.itemSize*t},getOffsetForIndexAndAlignment:function(e,t,r,n){var a=e.direction,s=e.height,o=e.itemCount,i=e.itemSize,u=e.layout,c=e.width,d="horizontal"===a||"horizontal"===u?c:s,l=Math.max(0,o*i-d),p=Math.min(l,t*i),f=Math.max(0,t*i-d+i);switch("smart"===r&&(r=n>=f-d&&n<=p+d?"auto":"center"),r){case"start":return p;case"end":return f;case"center":var h=Math.round(f+(p-f)/2);return h<Math.ceil(d/2)?0:h>l+Math.floor(d/2)?l:h;default:return n>=f&&n<=p?n:n<f?f:p}},getStartIndexForOffset:function(e,t){var r=e.itemCount,n=e.itemSize;return Math.max(0,Math.min(r-1,Math.floor(t/n)))},getStopIndexForStartIndex:function(e,t,r){var n=e.direction,a=e.height,s=e.itemCount,o=e.itemSize,i=e.layout,u=e.width,c=t*o,d="horizontal"===n||"horizontal"===i?u:a,l=Math.ceil((d+r-c)/o);return Math.max(0,Math.min(s-1,t+l-1))},initInstanceProps:function(e){},shouldResetStyleCacheOnItemSizeChange:!0,validateProps:function(e){e.itemSize}})},48898:(e,t,r)=>{"use strict";r.d(t,{ExternalEvents:()=>u});var n=r(50706),a=r(25155),s=r(22559);function o(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return i(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){u=!0,s=e},f:function(){try{o||null==r.return||r.return()}finally{if(u)throw s}}}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var u=(0,n.default)((function e(){var t=this;(0,a.default)(this,e),(0,s.default)(this,"listeners",[]),(0,s.default)(this,"send",(function(e,r){var n,a=o(t.listeners);try{for(a.s();!(n=a.n()).done;){(0,n.value)(e,r)}}catch(e){a.e(e)}finally{a.f()}})),(0,s.default)(this,"subscribe",(function(e){return t.listeners.push(e),function(){t.listeners=t.listeners.filter((function(t){return t!==e}))}}))}))},17254:(e,t,r)=>{"use strict";r.d(t,{Storage:()=>l});var n=r(31989),a=r(67846),s=r(25155),o=r(50706),i=r(22559),u=r(43883),c=r.n(u),d=r(91047),l=function(){function e(t){var r=this;(0,s.default)(this,e),(0,i.default)(this,"idbStoreName","storage"),(0,i.default)(this,"identify",(function(e){r.viewerPeerId=e})),(0,i.default)(this,"get",(function(e){var t=r.mapKey(e);try{var n=localStorage.getItem(t);if(!n)return;return JSON.parse(n,f)}catch(e){return}})),(0,i.default)(this,"set",(function(e,t){var n=r.mapKey(e);try{localStorage.setItem(n,JSON.stringify(t,p))}catch(e){}})),(0,i.default)(this,"del",(function(e){var t=r.mapKey(e);try{localStorage.removeItem(t)}catch(e){}})),(0,i.default)(this,"getIDB",function(){var e=(0,a.default)(c().mark((function e(t){var n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.mapKey(t),e.next=3,d.get(n,r.idbStorage);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),(0,i.default)(this,"setIDB",function(){var e=(0,a.default)(c().mark((function e(t,n){var a;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.mapKey(t),e.next=3,d.set(a,n,r.idbStorage);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()),(0,i.default)(this,"delIDB",function(){var e=(0,a.default)(c().mark((function e(t){var n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.mapKey(t),e.next=3,d.del(n,r.idbStorage);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.dbName=t,this.idbStorage=window.indexedDB&&d.createStore(t,this.idbStoreName)}return(0,o.default)(e,[{key:"mapKey",value:function(e){if(!this.viewerPeerId)throw new Error("Перед использованием Storage должен быть идентифицирован!");return"".concat(this.dbName,"-").concat(this.viewerPeerId,"-").concat(e)}}]),e}();function p(e,t){return t instanceof Map?{dataType:"Map",entries:Array.from(t.entries())}:t instanceof Set?{dataType:"Set",values:Array.from(t.values())}:t}function f(e,t){if("object"===(0,n.default)(t)&&null!==t){if("Map"===t.dataType)return new Map(t.entries);if("Set"===t.dataType)return new Set(t.values)}return t}},47337:(e,t,r)=>{"use strict";r.d(t,{Avatar:()=>v});var n=r(31989),a=r(92993),s=r(97433),o=r(67294),i=r(20700),u=r.n(i),c=r(84970),d=r(14432),l=r(21705);const p=(0,r(93708).makeIcon)("Icon12OnlineMobile","online_mobile_12","0 0 8 12",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 8 12" id="online_mobile_12"><path fill="currentColor" d="M5.99 0C7.1 0 8 .9 8 2.01v7.98C8 11.1 7.1 12 5.99 12H2.01C.9 12 0 11.1 0 9.99V2.01C0 .9.9 0 2.01 0h3.98Zm.007 3H2.004a.502.502 0 0 0-.503.502v4.995c0 .278.225.503.503.503h3.995a.502.502 0 0 0 .502-.502V3.503A.502.502 0 0 0 5.997 3Z" /></symbol>',8,12,!1,void 0);var f=r(58895);function h(){h=function(e,t){return new r(e,void 0,t)};var e=RegExp.prototype,t=new WeakMap;function r(e,n,a){var o=new RegExp(e,n);return t.set(o,a||t.get(e)),(0,s.default)(o,r.prototype)}function o(e,r){var n=t.get(r);return Object.keys(n).reduce((function(t,r){return t[r]=e[n[r]],t}),Object.create(null))}return(0,a.default)(r,RegExp),r.prototype.exec=function(t){var r=e.exec.call(this,t);return r&&(r.groups=o(r,this)),r},r.prototype[Symbol.replace]=function(r,a){if("string"==typeof a){var s=t.get(this);return e[Symbol.replace].call(this,r,a.replace(/\$<([^>]+)>/g,(function(e,t){return"$"+s[t]})))}if("function"==typeof a){var i=this;return e[Symbol.replace].call(this,r,(function(){var e=arguments;return"object"!==(0,n.default)(e[e.length-1])&&(e=[].slice.call(e)).push(o(e,i)),a.apply(this,e)}))}return e[Symbol.replace].call(this,r,a)},h.apply(this,arguments)}var v=o.memo((function(e){var t=e.peer,r=e.size,n=e.activityIndicator,a=e.withOnline,s=void 0!==a&&a,i=e.withBirthday,p=void 0!==i&&i,v=e.activeCall,y=e.className,g=(0,c.useOnline)(t.id),b=(0,c.usePixelDensity)(),C=function(e,t){if("User"!==e.kind)return"Offline";if(t)switch(e.lastSeen.platform){case"vkme":case"mobile":return"Mobile";case"other":return"Online";default:return(0,l.exhaustivenessCheck)(e.lastSeen.platform)}return"Offline"}(t,s&&g),_=!!v,k=p&&function(e){var t;if("User"!==e.kind||!e.bdate)return!1;var r=new Date,n=String(r.getDate()),a=String(r.getMonth()+1),s=(null===(t=h(/(\d+)\.(\d+)/,{day:1,month:2}).exec(e.bdate))||void 0===t?void 0:t.groups)||{},o=s.day,i=s.month;return o===n&&i===a}(t),w=function(e,t){if("Contact"===e.kind)return e.photo50;return t?e.photo100:e.photo50}(t,b),I=(0,o.useMemo)((function(){return{width:r,height:r}}),[r]),S=function(e,t,r){return"mePeerFrame".concat(e).concat(t).concat(r?"c":"")}(C,r,_||k),O="url(#".concat(S,"Mask").concat(t.id,")"),R=u()("MEAvatar","MEAvatar--size-".concat(r),{"MEAvatar--withActivity":!!n,"MEAvatar--emptyCall":"empty"===v},y);return o.createElement("figure",{style:I,className:R},o.createElement("div",{className:"MEAvatar__imgWrapper",style:{clipPath:O}},w?o.createElement("img",{className:"MEAvatar__img",alt:d.name(t),src:w}):o.createElement(f.AvatarNoPhoto,{peer:t,size:r}),n&&o.createElement("div",{className:"MEAvatar__activityIndicator"},n)),o.createElement(m,{frameType:C}),k&&o.createElement("div",{className:"MEAvatar__birthday"},o.createElement("svg",{className:"MEAvatar__upperRightIcon"},o.createElement("use",{href:"#meCake10"}))),_&&o.createElement("div",{className:"MEAvatar__call"},o.createElement("svg",{className:"MEAvatar__upperRightIcon"},o.createElement("use",{href:"#mePhone10"}))),o.createElement("svg",{className:"MEAvatar__svg"},o.createElement("clipPath",{id:S+"Mask"+t.id},o.createElement("use",{href:"#"+S})),o.createElement("use",{href:"#"+S,className:"MEAvatar__shadow",clipPath:O})))}));var m=function(e){var t=e.frameType;switch(t){case"Me":case"Mobile":return o.createElement("div",{className:"MEAvatar__mobile"},o.createElement(p,null));case"Online":return o.createElement("div",{className:"MEAvatar__online"});case"Offline":return null;default:(0,l.exhaustivenessCheck)(t)}}},58895:(e,t,r)=>{"use strict";r.d(t,{AvatarNoPhoto:()=>c,AvatarNoPhotoSimple:()=>d});var n=r(67294),a=r(20700),s=r.n(a),o=r(14432),i=r(21705),u=r(87075),c=function(e){var t=e.peer,r=e.size,a=e.style,s=e.className;return n.createElement(d,{peerId:t.id,size:r,style:a,className:s,text:l(t)})},d=function(e){var t=e.text,r=e.peerId,a=e.size,i=e.style,u=e.className,c=void 0!==r&&o.isContactPeerId(r)?"AvatarNoPhoto--color-contact":"AvatarNoPhoto--color-".concat(Math.abs((null!=r?r:0)%6));return n.createElement("div",{style:i,className:s()("AvatarNoPhoto","AvatarNoPhoto--size-".concat(a),c,u)},t)};function l(e){var t="";switch(e.kind){case"User":t=[e.firstName,e.lastName].filter(Boolean).map(u.getFirstLetter).join("");break;case"Group":t=(0,u.getFirstLetter)(e.name);break;case"Chat":t=(0,u.getFirstLetter)(e.title);break;case"Contact":t=e.name.split(/\s/).slice(0,2).map(u.getFirstLetter).join("");break;default:(0,i.exhaustivenessCheck)(e)}return t}},69303:(e,t,r)=>{"use strict";r.d(t,{OptionsListItem:()=>i,OptionsListItemWrapper:()=>c});var n=r(67294),a=r(20700),s=r.n(a);const o=(0,r(93708).makeIcon)("Icon28ChevronRightOutline","chevron_right_outline_28","0 0 28 28",'<symbol viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" id="chevron_right_outline_28"><g fill="none" fill-rule="evenodd"><path d="M0 0h28v28H0z" /><path d="m11 7.5 6.5 6.5-6.5 6.5" stroke="#8BC1FF" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" /><path d="m16.086 14-5.793 5.793a1 1 0 0 0 1.414 1.414l6.5-6.5a1 1 0 0 0 0-1.414l-6.5-6.5a1 1 0 0 0-1.414 1.414L16.086 14Z" fill="currentColor" fill-rule="nonzero" /></g></symbol>',28,28,!1,void 0);var i=function(e){var t=e.icon,r=e.title,a=e.description,s=e.aside,i=e.isPadded,u=void 0===i||i,d=e.isInteractive,l=e.hasChevron,p=e.onClick,f=e.className;return n.createElement(c,{onClick:p,isInteractive:d,className:f,isPadded:u},n.createElement("div",{className:"OptionsListItem__icon","aria-hidden":!0},t),n.createElement("div",{className:"OptionsListItem__main"},n.createElement("div",{className:"OptionsListItem__title"},r),a&&n.createElement("div",{className:"OptionsListItem__description"},a)),l&&n.createElement("div",{className:"OptionsListItem__aside OptionsListItem__aside--chevron"},n.createElement(o,null)),s&&n.createElement("div",{className:"OptionsListItem__aside"},s))};function u(e){e.preventDefault()}var c=function(e){var t=e.children,r=e.className,a=e.isInteractive,o=e.isPadded,i=void 0===o||o,c=e.onClick,d=s()("OptionsListItem",r,{"OptionsListItem--interactive":null!=a?a:c,"OptionsListItem--padded":i});return n.createElement("li",{className:d,onClick:c,tabIndex:c?0:void 0,onMouseDown:c?u:void 0},t)}},82597:(e,t,r)=>{"use strict";r.d(t,{empty:()=>c,snakeCaseId:()=>l,getLockId:()=>p,isLoaded:()=>f,push:()=>h,refresh:()=>v,updateCounters:()=>m,sorter:()=>y});var n=r(22559),a=r(16352);function s(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return o(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return o(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){u=!0,s=e},f:function(){try{i||null==r.return||r.return()}finally{if(u)throw s}}}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function c(){var e={channelIds:new Set,hasMore:!0,unreadCount:0,totalCount:0,boundary:{channelId:a.resolveId(0),majorSortId:1/0,minorSortId:1/0}};return{all:u({kind:"all"},e),unread:u({kind:"unread"},e),archive:u({kind:"archive",isHidden:!1},e)}}var d={all:"all",unread:"unread",archive:"archived"};function l(e){return d[e]}function p(e){return"filter_".concat(e)}function f(e){return e.boundary.minorSortId!==1/0&&e.boundary.majorSortId!==1/0}function h(e,t,r,n){var o,i=s(r);try{for(i.s();!(o=i.n()).done;){var u=o.value;g(e,t,u),v(e,u)}}catch(e){i.e(e)}finally{i.f()}e[t].hasMore=n,e[t].hasMore||(e[t].boundary={majorSortId:0,minorSortId:0,channelId:a.resolveId(0)})}function v(e,t){e.all.channelIds.delete(t.id),e.unread.channelIds.delete(t.id),e.archive.channelIds.delete(t.id),t.isMember&&(t.isArchived?b(e.archive,t)&&e.archive.channelIds.add(t.id):(b(e.all,t)&&e.all.channelIds.add(t.id),a.isUnread(t)&&b(e.unread,t)&&e.unread.channelIds.add(t.id)))}function m(e,t){var r=t.unread,n=t.archiveTotal;void 0!==r&&(e.all.unreadCount=r,e.unread.unreadCount=r),void 0!==n&&(e.archive.totalCount=n)}function y(e,t){return e.majorSortId!==t.majorSortId?t.majorSortId-e.majorSortId:t.minorSortId!==e.minorSortId?t.minorSortId-e.minorSortId:e.id-t.id}function g(e,t,r){a.isHidden(r)||(r.majorSortId<e[t].boundary.majorSortId?e[t].boundary={channelId:r.id,majorSortId:r.majorSortId,minorSortId:r.minorSortId}:r.majorSortId===e[t].boundary.majorSortId&&r.minorSortId<e[t].boundary.minorSortId?(e[t].boundary.channelId=r.id,e[t].boundary.minorSortId=r.minorSortId):r.majorSortId===e[t].boundary.majorSortId&&r.minorSortId===e[t].boundary.minorSortId&&(e[t].boundary.channelId=r.id),"all"===t&&g(e,"unread",r))}function b(e,t){return!a.isHidden(t)&&(!(t.majorSortId<e.boundary.majorSortId)&&(t.majorSortId>e.boundary.majorSortId||!(t.minorSortId<e.boundary.minorSortId)&&(t.minorSortId>e.boundary.minorSortId||!(t.id>e.boundary.channelId))))}},52229:(e,t,r)=>{"use strict";r.d(t,{empty:()=>d,snakeCaseId:()=>p,isLoaded:()=>f,getLockId:()=>h,isVisible:()=>v,push:()=>m,refresh:()=>y,updateCounters:()=>g,sorter:()=>b,toggleArchiveVisibility:()=>C,toggleBusinessNotifyVisibility:()=>_});var n=r(22559),a=r(9727),s=r(21705);function o(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return i(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){u=!0,s=e},f:function(){try{o||null==r.return||r.return()}finally{if(u)throw s}}}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function d(){var e={peerIds:new Set,hasMore:!0,unreadCount:0,unreadUnmutedCount:0,totalCount:0,boundary:{majorSortId:1/0,minorSortId:1/0}};return{all:c({kind:"all"},e),unread:c({kind:"unread",headerNotMutedUnread:0},e),chats:c({kind:"chats"},e),archive:c({kind:"archive",hasMentions:!1,isHidden:!1},e),messageRequest:c({kind:"messageRequest"},e),businessNotify:c({kind:"businessNotify",isHidden:!1},e)}}var l={all:"all",unread:"unread",chats:"chats",messageRequest:"message_request",businessNotify:"business_notify",archive:"archive"};function p(e){return l[e]}function f(e){return e.boundary.majorSortId!==1/0&&e.boundary.minorSortId!==1/0}function h(e){return"filter_".concat(e)}function v(e){switch(e.kind){case"all":case"unread":case"chats":return!0;case"messageRequest":return e.peerIds.size>0||e.hasMore;case"businessNotify":return!e.isHidden&&e.totalCount>0;default:return!e.isHidden&&(e.peerIds.size>0||e.hasMore)}}function m(e,t,r,n){var a,s=o(r);try{for(s.s();!(a=s.n()).done;){var i=a.value;k(e,t,i),y(e,i)}}catch(e){s.e(e)}finally{s.f()}e[t].hasMore=n,e[t].hasMore||(e[t].boundary={majorSortId:0,minorSortId:0})}function y(e,t){switch(t.kind){case"ChatConvo":case"GroupConvo":case"UserConvo":case"ContactConvo":case"MessageRequestUserConvo":case"MessageRequestChatConvo":case"BusinessNotify":return e.all.peerIds.delete(t.peerId),e.unread.peerIds.delete(t.peerId),e.archive.peerIds.delete(t.peerId),e.messageRequest.peerIds.delete(t.peerId),e.businessNotify.peerIds.delete(t.peerId),a.isBusinessNotify(t)?void(w(e.businessNotify,t)&&e.businessNotify.peerIds.add(t.peerId)):a.isMR(t)?void(a.isPendingMR(t)&&w(e.messageRequest,t)&&e.messageRequest.peerIds.add(t.peerId)):t.isArchived?void(w(e.archive,t)&&e.archive.peerIds.add(t.peerId)):(w(e.all,t)&&e.all.peerIds.add(t.peerId),a.isUnread(t)&&w(e.unread,t)&&e.unread.peerIds.add(t.peerId),void("ChatConvo"===t.kind&&w(e.chats,t)&&e.chats.peerIds.add(t.peerId)));default:return(0,s.exhaustivenessCheck)(t)}}function g(e,t){var r=t.unread,n=t.unreadUnmuted,a=t.headerNotMutedUnread,s=t.archive,o=t.archiveTotal,i=t.archiveMentions,u=t.messageRequests,c=t.businessNotify,d=t.businessNotifyTotal;void 0!==r&&(e.all.unreadCount=r,e.unread.unreadCount=r),void 0!==n&&(e.all.unreadUnmutedCount=n,e.unread.unreadUnmutedCount=n),void 0!==a&&(e.unread.headerNotMutedUnread=a),void 0!==s&&(e.archive.unreadCount=s),void 0!==i&&(e.archive.hasMentions=!!i),void 0!==o&&(e.archive.totalCount=o),void 0!==u&&(e.messageRequest.totalCount=u),void 0!==c&&(e.businessNotify.unreadCount=c),void 0!==d&&(e.businessNotify.totalCount=d)}function b(e,t){if(e.majorSortId!==t.majorSortId)return t.majorSortId-e.majorSortId;var r=null==e?void 0:e.queued.get(e.queuedId),n=null==t?void 0:t.queued.get(t.queuedId);return r&&!n?-1:n&&!r?1:r&&n?n.sentAt-r.sentAt:t.minorSortId-e.minorSortId}function C(e,t){e.archive.isHidden=!t}function _(e,t){e.businessNotify.isHidden=!t}function k(e,t,r){a.isHidden(r)||(r.majorSortId<e[t].boundary.majorSortId?e[t].boundary={majorSortId:r.majorSortId,minorSortId:r.minorSortId}:r.majorSortId===e[t].boundary.majorSortId&&r.minorSortId<e[t].boundary.minorSortId&&(e[t].boundary.minorSortId=r.minorSortId),"all"===t&&(k(e,"unread",r),k(e,"chats",r)))}function w(e,t){return!a.isHidden(t)&&(t.majorSortId>e.boundary.majorSortId||t.majorSortId===e.boundary.majorSortId&&t.minorSortId>=e.boundary.minorSortId)}},27119:(e,t,r)=>{"use strict";r.d(t,{refresh:()=>i,refreshChannels:()=>u,empty:()=>c,isEqual:()=>d});var n=r(21705),a=r(52229),s=r(82597),o=r(60202);function i(e,t){o.refresh(e.folders,t),a.refresh(e.filters,t)}function u(e,t){s.refresh(e.channelFilters,t)}function c(){return{filters:a.empty(),folders:o.empty(),channelFilters:s.empty()}}function d(e,t){if(e.kind!==t.kind)return!1;switch(e.kind){case"filters":return e.filter===t.filter;case"folders":return e.id===t.id;default:(0,n.exhaustivenessCheck)(e)}}},10454:(e,t,r)=>{"use strict";r.d(t,{fromApiComment:()=>f});var n=r(22559),a=r(51766),s=r(14432),o=r(30966),i=r(16352),u=r(94170),c=r(41450),d=r(3460);function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function f(e){var t,r,n,l,h,v={cmid:a.resolveCmid(e.id),postCmid:o.resolveCmid(e.post_id||0),channelId:i.resolveId(e.owner_id||0),canEdit:Boolean(e.can_edit),rootCmid:null!==(t=e.parents_stack)&&void 0!==t&&t[0]?a.resolveCmid(e.parents_stack[0]):void 0,replies:{count:(null==e||null===(r=e.thread)||void 0===r?void 0:r.count)||0,history:((null===(n=e.thread)||void 0===n?void 0:n.items)||[]).map(f)},sentAt:1e3*e.date};return e.deleted?p({kind:"Deleted"},v):p(p({kind:"Normal"},v),{},{chunks:e.text?c.fromServerText(e.text):[],attaches:(0,d.fromApiWallReplyAttach)(e.attachments||[]),likes:{count:(null===(l=e.likes)||void 0===l?void 0:l.count)||0,reactionId:Boolean(null===(h=e.likes)||void 0===h?void 0:h.user_likes)?u.resolveId(0):void 0,availableReactionIds:[],peerIds:new Set},peerId:s.resolveId(e.from_id)})}},3589:(e,t,r)=>{"use strict";r.d(t,{fromApiViewerAccount:()=>a,fromApiViewerProfileInfo:()=>s,fromApiProfileType:()=>o});var n=r(14432);function a(e){var t,r;return{id:n.resolveRealId("User",e.id),profileType:o(e.profile_type),firstName:null!==(t=e.first_name)&&void 0!==t?t:"",lastName:null!==(r=e.last_name)&&void 0!==r?r:"",photo:e.photo_100}}function s(e){var t=e.screen_name,r=e.phone,a=e.id,s=e.photo_200,o=e.first_name,i=e.last_name;return{screenName:t,phoneNumber:r,id:n.resolveRealId("User",a),avatarPhoto:s,firstName:o,lastName:i}}function o(e){var t;return null!==(t={0:"normal",2:"edu"}[null!=e?e:0])&&void 0!==t?t:"normal"}},11719:(e,t,r)=>{"use strict";r.d(t,{Engine:()=>f});var n=r(80312),a=r(67846),s=r(50706),o=r(25155),i=r(22559),u=r(43883),c=r.n(u),d=r(21705);function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var f=(0,s.default)((function e(t,r){var s=this;(0,o.default)(this,e),(0,i.default)(this,"isWorking",!1),(0,i.default)(this,"empty",(function(){return{kind:"Buffer",buffer:[]}})),(0,i.default)(this,"queued",this.empty()),(0,i.default)(this,"connect",(function(e){if(!s.isWorking){s.isWorking=!0,s.queued=s.empty();var t=function(){var t=(0,a.default)(c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!s.isWorking){t.next=16;break}if(!("Buffer"===s.queued.kind&&s.queued.buffer.length>=50)){t.next=5;break}return s.isWorking=!1,s.dispatch({kind:"Failure"}),t.abrupt("return");case 5:return t.prev=5,t.delegateYield(c().mark((function t(){var r,n,a,o;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r="https://".concat(e.server,"?version=").concat(s.version,"&mode=").concat(682),n=new AbortController,a=setTimeout((function(){return n.abort()}),3e4),t.next=5,s.request(r,{act:"a_check",key:e.key,ts:e.ts,wait:25},n.signal).finally((function(){return clearTimeout(a)}));case 5:if(!("failed"in(o=t.sent))){t.next=8;break}throw o;case 8:e.ts=o.ts,e.pts=o.pts,s.dispatch(p({kind:"Batch"},o));case 11:case"end":return t.stop()}}),t)}))(),"t0",7);case 7:t.next=14;break;case 9:t.prev=9,t.t1=t.catch(5),s.logger.info("[ENGINE] Error",t.t1),s.isWorking=!1,s.dispatch({kind:"Failure"});case 14:t.next=0;break;case 16:case"end":return t.stop()}}),t,null,[[5,9]])})));return function(){return t.apply(this,arguments)}}();t(),s.logger.info("[ENGINE] Connected")}})),(0,i.default)(this,"dispatch",(function(e){if("Callback"===s.queued.kind)return s.queued.resolve(e),void(s.queued=s.empty());switch(e.kind){case"Failure":return void s.queued.buffer.push(e);case"Batch":var t,r=s.queued.buffer[s.queued.buffer.length-1];if(r&&"Failure"!==r.kind&&r.pts===e.pts)r.ts=e.ts,r.pts=e.pts,(t=r.updates).push.apply(t,(0,n.default)(e.updates));else s.queued.buffer.push(e);return;default:(0,d.exhaustivenessCheck)(e)}})),(0,i.default)(this,"poll",(function(){if("Callback"===s.queued.kind)return s.queued.reject("Engine.poll вызван повторно до обработки первого вызова!"),new Promise((function(e,t){s.queued={kind:"Callback",resolve:e,reject:t}}));var e=s.queued.buffer.shift();return e?Promise.resolve(e):s.isWorking?new Promise((function(e,t){s.queued={kind:"Callback",resolve:e,reject:t}})):Promise.reject("Engine.connect еще не был вызван!")})),(0,i.default)(this,"isConnected",(function(){return s.isWorking})),this.logger=t,this.request=r,this.version=19}))},9621:(e,t,r)=>{"use strict";r.d(t,{IApi:()=>n});var n,a=r(50706),s=r(25155),o=r(79324),i=r(92993),u=r(4604),c=r(81944),d=r(97433);function l(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function p(e,t,r){return p=l()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var a=new(Function.bind.apply(e,n));return r&&(0,d.default)(a,r.prototype),a},p.apply(null,arguments)}function f(e){var t="function"==typeof Map?new Map:void 0;return f=function(e){if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;var r;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return p(e,arguments,(0,c.default)(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),(0,d.default)(n,e)},f(e)}function h(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,c.default)(e);if(t){var a=(0,c.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,u.default)(this,r)}}!function(e){e.resolveTrackId=function(e,t){if(0===t.length)throw new Error("Нельзя отдавать пустую строку в IApi.resolveTrackId");return"".concat(e,"-").concat(t)};var t=function(e){(0,i.default)(r,e);var t=h(r);function r(){var e;return(0,s.default)(this,r),e=t.call(this),Object.setPrototypeOf((0,o.default)(e),r.prototype),e}return(0,a.default)(r)}(f(Error));e.TimeoutError=t;var r=function(e){(0,i.default)(r,e);var t=h(r);function r(){var e;return(0,s.default)(this,r),e=t.call(this),Object.setPrototypeOf((0,o.default)(e),r.prototype),e}return(0,a.default)(r)}(f(Error));e.AbortError=r;var n=function(e){(0,i.default)(r,e);var t=h(r);function r(e,n,a){var i;return(0,s.default)(this,r),(i=t.call(this,n)).code=e,i.payload=a,Object.setPrototypeOf((0,o.default)(i),r.prototype),i}return(0,a.default)(r)}(f(Error));e.RequestError=n;var u=function(e){(0,i.default)(r,e);var t=h(r);function r(e){var n;return(0,s.default)(this,r),(n=t.call(this,String(e[0].error_code))).list=e.map((function(e){return{code:e.error_code,message:e.error_msg}})),Object.setPrototypeOf((0,o.default)(n),r.prototype),n}return(0,a.default)(r)}(f(Error));e.ExecuteErrors=u}(n||(n={}))},16032:(e,t,r)=>{"use strict";r.d(t,{Stack:()=>i,Modals:()=>u,resolveId:()=>c});var n=r(25155),a=r(50706),s=r(22559),o=r(8994),i=function(){function e(){var t;(0,n.default)(this,e),(0,s.default)(this,"index",0),this.history=[],this.listeners=(t=[],{get length(){return t.length},push:function(e){return t.push(e),function(){t=t.filter((function(t){return t!==e}))}},call:function(e){t.forEach((function(t){return t&&t(e)}))}})}return(0,a.default)(e,[{key:"pop",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=this.history.splice(-e,e);this.index=this.history.length-1,this.listeners.call({action:"remove",payload:t}),this.lastElement&&this.listeners.call({action:"add",payload:this.lastElement})}},{key:"push",value:function(e){this.history.push(e),this.index=this.history.length-1,this.listeners.call({action:"add",payload:e})}},{key:"goBack",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.index-=e}},{key:"subscribe",value:function(e){return this.listeners.push(e)}},{key:"lastElement",get:function(){return this.history[this.history.length-1]||null}},{key:"currentElement",get:function(){return this.history[this.index]||null}}]),e}();var u=(0,a.default)((function e(){var t=this;(0,n.default)(this,e),(0,s.default)(this,"createGroup",(function(){var e=(0,o.nanoid)(),r={id:e,group:[]};return t.system.groups.set(e,r),r})),(0,s.default)(this,"createModal",(function(e){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,a=t.system.groups.get(e);if(!a)throw Error("Нет такого стека");var s=n||(0,o.nanoid)();return a.group.push({id:s}),t.system.modals.set(s,{groupId:a.id,isSubModal:r}),s})),(0,s.default)(this,"getModalGroup",(function(e){var r=t.system.groups.get(e);if(!r)throw Error("Передан Id несуществующей модалки");return r})),(0,s.default)(this,"getModalParams",(function(e){var r=t.system.modals.get(e);if(!r)throw Error("Попытка получить несуществующую модалку");return r})),this.system={modals:new Map,groups:new Map}}));function c(e){return e}},63843:(e,t,r)=>{"use strict";r.d(t,{Uploader:()=>g});var n=r(80312),a=r(67846),s=r(25155),o=r(50706),i=r(22559),u=r(43883),c=r.n(u),d=r(9669),l=r.n(d),p=r(3460),f=r(21705),h=r(90831),v=function(e){return"video"===e.kind},m=function(e){return"audio"===e.kind},y=function(e){return"doc"===e.kind},g=function(){function e(t){var r=this;(0,s.default)(this,e),(0,i.default)(this,"emitter",new b),(0,i.default)(this,"requestTimeout",0),(0,i.default)(this,"freeResources",5),(0,i.default)(this,"waiting",[]),(0,i.default)(this,"lock",(function(){return 0!==r.freeResources&&(r.freeResources=Math.max(r.freeResources-1,0),!0)})),(0,i.default)(this,"release",(function(){setTimeout((function(){r.freeResources=Math.min(r.freeResources+1,5);var e=r.waiting.shift();e&&e()}),h.API_RATE_LIMIT_WINDOW+50)})),this.api=t}var t,r,n,u,d,g,C,_;return(0,o.default)(e,[{key:"uploadImage",value:(_=(0,a.default)(c().mark((function e(t,r){var n=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.api.fetch("photos.getMessagesUploadServer",{peer_id:r.viewerId,group_id:r.groupId,upload_v2:0}).then((function(e){var r=e.upload_url,a=new FormData;return a.append("photo",t.file),n.uploadRequest(r,a,t.trackId,(function(e){var t=e.data,r=t.server,a=t.hash,s=t.photo;return n.api.fetch("photos.saveMessagesPhoto",{server:r,hash:a,photo:s}).then((function(e){if(0===e.length||void 0===e[0])throw new Error("Метод photos.saveMessagesPhoto не вернул фотографию");var t=(0,p.fromApiPhoto)(e[0]);if(void 0===t)throw new Error("Не удалось конвертировать фотографию с сервера");return t}))}))})));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return _.apply(this,arguments)})},{key:"uploadVideo",value:(C=(0,a.default)(c().mark((function e(t){var r=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.api.fetch("video.save",{target:"messages",preview:1,no_comments:1}).then((function(e){var n=e.upload_url;if(e.access_key,e.owner_id,e.video_id,!n)throw new Error("В методе video.save не вернулся upload_url");var a=new FormData;return a.append("video_file",t.file),r.uploadRequest(n,a,t.trackId,(function(e){var t=e.data,r=t.video_id,n=t.owner_id;return Promise.resolve({kind:"Video",id:r,ownerId:n,image:[{url:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAA1JREFUGFdjYGBg+A8AAQQBAHAgZQsAAAAASUVORK5CYII=",width:1,height:1}],views:0})}))})));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return C.apply(this,arguments)})},{key:"uploadAudio",value:(g=(0,a.default)(c().mark((function e(t){var r=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.api.fetch("audio.getUploadServer",{}).then((function(e){var n=e.upload_url,a=new FormData;return a.append("file",t.file),r.uploadRequest(n,a,t.trackId,(function(e){var t=e.data,n=t.server,a=t.audio,s=t.hash;return r.api.fetch("audio.save",{server:n,audio:a,hash:s}).then((function(e){return(0,p.fromApiAudio)(e)}))}))})));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return g.apply(this,arguments)})},{key:"uploadDoc",value:(d=(0,a.default)(c().mark((function e(t,r){var n=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.api.fetch("docs.getMessagesUploadServer",{type:"doc",peer_id:r.targetPeerId}).then((function(e){var r=e.upload_url,a=new FormData;return a.append("file",t.file),n.uploadRequest(r,a,t.trackId,(function(e){var t=e.data.file;return n.api.fetch("docs.save",{file:t}).then((function(e){if(!e.doc)throw new Error("Метод doc.save не вернул документ");var t=(0,p.fromApiDoc)(e.doc);if(!t)throw new Error("Не удалось конвертировать документ (нет поля url)");return t}))}))})));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return d.apply(this,arguments)})},{key:"uploadVoice",value:(u=(0,a.default)(c().mark((function t(r,n){var a=this;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.api.fetch("docs.getMessagesUploadServer",{type:"audio_message",peer_id:n.targetPeerId}).then((function(t){var n=t.upload_url,s=e.resolveTrackId("voice",e.hash()),o=new FormData;return o.append("file",r.file),a.uploadRequest(n,o,s,(function(e){var t=e.data.file;return a.api.fetch("docs.save",{file:t}).then((function(e){if(!e.audio_message)throw new Error("Метод doc.save не вернул аудиосообщение");return(0,p.fromApiVoice)(e.audio_message,!1)}))}))})));case 1:case"end":return t.stop()}}),t,this)}))),function(e,t){return u.apply(this,arguments)})},{key:"uploadChatPhoto",value:(n=(0,a.default)(c().mark((function e(t,r,n){var a=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.api.fetch("photos.getChatUploadServer",{chat_id:r.targetPeerId-2e9,crop_x:n.x,crop_y:n.y,crop_width:n.width}).then((function(e){var n=e.upload_url,s=new FormData;return s.append("photo",t.file),a.uploadRequest(n,s,t.trackId,(function(e){var t=e.data.response;return a.api.fetch("messages.setChatPhoto",{file:t,user_id:r.viewerId}).then((function(){}))}))})));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"uploadOwnerPhoto",value:(r=(0,a.default)(c().mark((function e(t,r){var n=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.api.fetch("photos.getOwnerPhotoUploadServer",{owner_id:r}).then((function(e){var r=e.upload_url,a=new FormData;return a.append("photo",t.file),new Promise((function(e,s){try{n.uploadRequest(r,a,t.trackId,(function(t){var r=t.data;return e(r),Promise.resolve(r)}))}catch(e){s(e)}}))})));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"upload",value:(t=(0,a.default)(c().mark((function e(t,r){var n=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all(t.reduce((function(e,t){return"image"===t.kind&&e.push(n.uploadImage(t,r)),v(t)&&e.push(n.uploadVideo(t)),m(t)&&e.push(n.uploadAudio(t)),y(t)&&e.push(n.uploadDoc(t,r)),e}),[])));case 1:case"end":return e.stop()}}),e)}))),function(e,r){return t.apply(this,arguments)})},{key:"uploadRequest",value:function(e,t,r,n){var a=this,s=r,o=new AbortController,i=function(){return l().post(e,t,{signal:o.signal,timeout:a.requestTimeout,headers:{"Content-Type":"multipart/form-data"},onUploadProgress:function(e){a.emitter.emit(s,{loaded:e.loaded,total:e.total})}}).then((function(e){return a.emitter.removeAllListeners(s),n(e)})).then((function(e){return a.release(),e})).catch((function(e){return a.release(),Promise.reject(e)}))};return this.lock()?{abort:function(){return o.abort()},trackId:r,response:i()}:{abort:function(){return o.abort()},trackId:r,response:new Promise((function(e,t){a.waiting.push((function(){return i().then(e).catch(t)}))}))}}},{key:"trackProgress",value:function(e,t){this.emitter.addListener(e,t)}}],[{key:"hash",value:function(){return Math.floor(1e8*Math.random()+1e8).toString(16)}},{key:"resolveTrackId",value:function(e,t){if(0===t.length)throw new Error("Нельзя отдавать пустую строку в Uploader.resolveTrackId");return"".concat(e,"-").concat(t)}},{key:"toFileInfo",value:function(t,r){switch(r){case"image":return{kind:"image",trackId:e.resolveTrackId("image",e.hash()),file:t};case"video":return{kind:"video",trackId:e.resolveTrackId("video",e.hash()),file:t};case"audio":return{kind:"audio",trackId:e.resolveTrackId("audio",e.hash()),file:t};case"doc":return{kind:"doc",trackId:e.resolveTrackId("doc",e.hash()),file:t};case"voice":return{kind:"voice",trackId:e.resolveTrackId("voice",e.hash()),file:t};case"chat-photo":return{kind:"chat-photo",trackId:e.resolveTrackId("chat-photo",e.hash()),file:t};case"owner-photo":return{kind:"owner-photo",trackId:e.resolveTrackId("owner-photo",e.hash()),file:t};default:(0,f.exhaustivenessCheck)(r)}}}]),e}(),b=function(){function e(){(0,s.default)(this,e),(0,i.default)(this,"map",new Map)}return(0,o.default)(e,[{key:"addListener",value:function(e,t){this.map.set(e,[].concat((0,n.default)(this.map.get(e)||[]),[t]))}},{key:"removeListener",value:function(e,t){var r=this.map.get(e);r&&r.length>0&&this.map.set(e,r.filter((function(e){return e!==t})))}},{key:"removeAllListeners",value:function(e){this.map.delete(e)}},{key:"emit",value:function(e,t){var r;null===(r=this.map.get(e))||void 0===r||r.forEach((function(e){return e(t)}))}}]),e}()},53752:(e,t,r)=>{"use strict";r.d(t,{IMPORTANT_USERS_COUNT:()=>c,handler:()=>d});var n=r(67846),a=r(43883),s=r.n(a),o=r(21705),i=r(37021),u=r(89032),c=10,d=function(e,t,r){switch(t.type){case"LoadImportantUsers":if(e.locks.getImportantUsers||null!==e.importantUsers)return[];e.locks.getImportantUsers=!0;var a=(0,i.getOwnerGroupId)(e.ownerId);return[function(){var e=(0,n.default)(s().mark((function e(t){var r,n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,t.logger,e.prev=1,e.next=4,r.fetch("messages.searchConversations",{q:" ",count:c,group_id:a},{retries:2});case 4:return n=e.sent,e.abrupt("return",{type:"LoadImportantUsers_RequestCompleted",hasFailed:!1,response:n});case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",{type:"LoadImportantUsers_RequestCompleted",hasFailed:!0});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()];case"LoadImportantUsers_RequestCompleted":if(e.locks.getImportantUsers=!1,t.hasFailed)return[];var d=t.response,l=d.profiles,p=d.groups,f=d.items,h=d.contacts;(0,i.insertConvos)(e,f),(0,i.insertPeers)(e,{apiUsers:l||[],apiGroups:p||[],apiContacts:h||[]});var v=f.reduce((function(e,t){var r=(0,u.fromApiConvo)(t);return r&&e.add(r.convo.peerId),e}),new Set);return e.importantUsers=v,[];default:(0,o.exhaustivenessCheck)(t)}}},60082:(e,t,r)=>{"use strict";r.d(t,{handler:()=>f,getCommentsHistoryLockKey:()=>h});var n=r(67846),a=r(43883),s=r.n(a),o=r(21705),i=r(16352),u=r(30966),c=r(51766),d=r(37021),l=r(90831),p=r(10454),f=function(e,t){switch(t.type){case"UserLoadedCommentsHistory":var r=t.channelId,a=t.postCmid,f=t.startCmid,v=t.commentCmid,m=t.order,y=h(r,a,v);if(e.locks.getPostCommentsHistory.has(y))return[];e.locks.getPostCommentsHistory.add(y);var g=e.channels.get(r);if(!g)return[];var b,C=i.findPostByCmid(g,a);if(!C||"Normal"!==C.kind)return[];if(v&&!u.findCommentByCmid(C,v))return[];switch(m){case"interesting":b="smart";break;case"new":b="desc";break;case"old":b="asc";break;default:(0,o.exhaustivenessCheck)(m)}return[function(){var e=(0,n.default)(s().mark((function e(t){var n,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.api,e.prev=1,e.next=4,n.fetch("wall.getComments",{owner_id:r,post_id:a,count:l.COMMENTS_PER_PAGE,sort:b,thread_items_count:l.THREAD_COMMENTS_COUNT,need_likes:1,extended:1,start_comment_id:f,comment_id:v||void 0,offset:f?1:0});case 4:return o=e.sent,e.abrupt("return",{type:"UserLoadedCommentsHistory_RequestSucceed",channelId:r,response:o,postCmid:a,order:m,commentCmid:v});case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",{type:"UserLoadedCommentsHistory_RequestFailed",channelId:r,postCmid:a,commentCmid:v,hasFailed:!0});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()];case"UserLoadedCommentsHistory_RequestSucceed":var _=t.response,k=t.channelId,w=t.postCmid,I=t.commentCmid,S=t.order;e.locks.getPostCommentsHistory.delete(h(k,w,I));var O=e.channels.get(k);if(!O)return[];var R=i.findPostByCmid(O,w);if(!R||"Normal"!==R.kind)return[];var A=_.items.map((function(e){return(0,p.fromApiComment)(e)}));if(S!==R.comments.order&&u.changeCommentsOrder(R,S),I){var x=u.findCommentByCmid(R,I);if(!x)return[];c.insertReplies(x,A),x.replies.count=_.current_level_count||x.replies.count}else u.insertComments(R,A,_.current_level_count||0),R.comments.count=_.count,R.comments.oneLevelCount=_.current_level_count||R.comments.oneLevelCount;return(0,d.insertPeers)(e,{apiUsers:_.profiles||[],apiGroups:_.groups||[],apiContacts:[]}),[];case"UserLoadedCommentsHistory_RequestFailed":var E=t.channelId,U=t.postCmid,M=t.commentCmid;return e.locks.getPostCommentsHistory.delete(h(E,U,M)),[];default:return(0,o.exhaustivenessCheck)(t)}},h=function(e,t,r){return"".concat(e,"-").concat(t,"-").concat(r||"")}},7412:(e,t,r)=>{"use strict";r.d(t,{createStore:()=>bt});var n=r(56568);function a(){return"undefined"!=typeof window&&"__REDUX_DEVTOOLS_EXTENSION__"in window?window.__REDUX_DEVTOOLS_EXTENSION__.connect({serialize:{options:{map:!0,set:!0}}}):null}var s=r(21705),o=r(22559),i=r(80312),u=r(67846),c=r(43883),d=r.n(c),l=r(10746),p=r(37021),f=r(27119),h=r(52229),v=r(60202),m=r(82597),y=r(9727),g=r(14432),b=r(80662),C=r(89018),_=r(16352),k=r(30966),w=r(33600),I=r(4850),S=r(90831),O=r(3589),R=r(51225),A=function e(t,r,n){switch(r.type){case"StickersAddToFavorite":var a=r.stickerId;return t.stickers.has(a)?(t.favoriteStickers=[].concat((0,i.default)(t.favoriteStickers.filter((function(e){return e!==a}))),[a]),[function(){var e=(0,u.default)(d().mark((function e(t){var r,n;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,e.prev=1,e.next=4,r.fetch("store.addStickersToFavorite",{sticker_ids:"".concat(a)});case 4:return n=e.sent,e.abrupt("return",{type:"StickersAddToFavorite__RequestCompleted",stickerId:a,hasFailed:!Boolean(n)});case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",{type:"StickersAddToFavorite__RequestCompleted",stickerId:a,hasFailed:!0});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()]):[];case"StickersAddToFavorite__RequestCompleted":var o=r.stickerId;return r.hasFailed&&e(t,{type:"StickersRemoveFromFavorite",stickerId:o},n),[];case"StickersRemoveFromFavorite":var c=r.stickerId;return t.stickers.has(c)?(t.favoriteStickers=t.favoriteStickers.filter((function(e){return e!==c})),[function(){var e=(0,u.default)(d().mark((function e(t){var r,n;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,e.prev=1,e.next=4,r.fetch("store.removeStickersFromFavorite",{sticker_ids:"".concat(c)});case 4:return n=e.sent,e.abrupt("return",{type:"StickersRemoveFromFavorite__RequestCompleted",stickerId:c,hasFailed:!Boolean(n)});case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",{type:"StickersRemoveFromFavorite__RequestCompleted",stickerId:c,hasFailed:!0});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()]):[];case"StickersRemoveFromFavorite__RequestCompleted":var l=r.stickerId;return r.hasFailed&&e(t,{type:"StickersAddToFavorite",stickerId:l},n),[];case"StickerAddToRecent":var p=r.stickerId;return t.recentStickers=[p].concat((0,i.default)(t.recentStickers.filter((function(e){return e!==p})))).slice(0,32),[];default:return(0,s.exhaustivenessCheck)(r)}};function x(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function E(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?x(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):x(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var U=function e(t,r,a){switch(r.type){case"UserHitSend":var o=r.peerId,u=t.convos.get(o);return u?(y.clearAfterGap(u),function(e,t){for(var r=e.text,a=e.attaches,s=e.peerId,o=e.timestamp,i=e.expireTTL,u=e.deleteTTL,c=e.entrypoint,d=e.extra,l=e.reply,p=e.forwarded,f=function(e){var t=e.length;if(t<S.MAX_MESSAGE_SIZE)return[e];for(var r=[],n=0,a=0;a<Math.ceil(t/S.MAX_MESSAGE_SIZE);a++){var s=e.substring(n,n+S.MAX_MESSAGE_SIZE).lastIndexOf(" "),o=-1===s?S.MAX_MESSAGE_SIZE:s,i=t-n<=S.MAX_MESSAGE_SIZE?e.substring(n):e.substring(n,n+o);n+=i.length,r.push(i)}return r.map((function(e){return e.trim()}))}(r),h=function(e){var t=Object.values(e).flat(),r=Object.fromEntries(Object.entries(e).map((function(e){var t=(0,n.default)(e,2),r=t[0],a=t[1];return Array.isArray(a)?[a[0].kind,r]:[a.kind,r]})));if(t.length<=S.MAX_MESSAGE_ATTACHES)return[e];return t.reduce((function(e,t,n){var a,s=Math.floor(n/S.MAX_MESSAGE_ATTACHES),o=r[t.kind];return o?(e[s][o]=(null===(a=e[s][o])||void 0===a?void 0:a.concat(t))||[t],e):e}),Array(Math.ceil(t.length/S.MAX_MESSAGE_ATTACHES)).fill("").map(Object))}(a),v=f.length+h.length-1,m=[],y=0;y<v;y++){var g=f[y]||"",C=h[y-f.length+1]||{},_=b.newQueued({peerId:s,text:g,isOut:!0,sentAt:o+y,authorId:t,attaches:C,expireTTL:i,deleteTTL:u,extra:d,entrypoint:c},0===y?l:void 0,y===v-1?p:void 0);m.push(_)}return m}(r,t.ownerId).flatMap((function(e){var r,n;y.appendQueuedMessage(u,e);var a=t.locks.sendQueue.get(u.peerId);return a?(a.add(e.randomId),[]):(t.locks.sendQueue.set(u.peerId,new Set([e.randomId])),e.attaches.sticker&&(t.recentStickers=[e.attaches.sticker.id].concat((0,i.default)(t.recentStickers.filter((function(t){var r;return t!==(null===(r=e.attaches.sticker)||void 0===r?void 0:r.id)})))).slice(0,32)),[M(e.peerId,e.randomId,e.text,R.ids(e.attaches),e.extra,e.entrypoint,e.attaches.geo,(0,p.getOwnerGroupId)(t.ownerId),null===(r=e.replyMessage)||void 0===r?void 0:r.id,null===(n=e.forwardedMessages)||void 0===n?void 0:n.map((function(e){return e.id})))])}))):[];case"UserHitSend_RequestCompleted":var c,d,f=r.peerId,h=r.randomId,v=r.hasFailed,m=t.convos.get(f),g=t.ownerId;if(!m)return t.locks.sendQueue.delete(f),[];v&&y.updateSendingFail(m,h,v);var C=t.locks.sendQueue.get(m.peerId);if(!C)return[];C.delete(h);var _=(0,i.default)(C)[0];if(!_)return t.locks.sendQueue.delete(f),[];var k=m.queued.get(_);if(!k)return[];var w=(0,l.current)(k);return[M(f,w.randomId,w.text,R.ids(w.attaches),w.extra,w.entrypoint,w.attaches.geo,(0,p.getOwnerGroupId)(g),null===(c=w.replyMessage)||void 0===c?void 0:c.id,null===(d=w.forwardedMessages)||void 0===d?void 0:d.map((function(e){return e.id})))];case"UserHitResendFailedMessage":var I=r.randomId,O=r.peerId,A=r.entrypoint,x=t.convos.get(O),E=t.ownerId;if(!x)return[];var U=x.queued.get(I);if(!U)return[];y.updateSendingFail(x,I,!1),y.changeQueuedMessageEntrypoint(x,I,A);var P=t.locks.sendQueue.get(x.peerId);if(P)return P.add(U.randomId),[];t.locks.sendQueue.set(x.peerId,new Set([U.randomId]));var j=(0,l.current)(U);return[M(O,j.randomId,j.text,R.ids(j.attaches),j.extra,A,j.attaches.geo,(0,p.getOwnerGroupId)(E))];case"UserHitResendAllFailedMessages":var F=r.peerId,q=r.entrypoint,N=t.convos.get(F);return N?y.allQueuedMessages(N).filter((function(e){return e.hasFailed})).flatMap((function(r){return e(t,{type:"UserHitResendFailedMessage",peerId:F,randomId:r.randomId,entrypoint:q||r.entrypoint},a)})):[];case"ResendAllFailedMessages":return Array.from(t.convos.values()).flatMap((function(r){return e(t,{type:"UserHitResendAllFailedMessages",peerId:r.peerId},a)}));default:return(0,s.exhaustivenessCheck)(r)}};function M(e,t,r,n,a,s,o,i,c,l){return function(){var p=(0,u.default)(d().mark((function u(p){var f,h,v;return d().wrap((function(u){for(;;)switch(u.prev=u.next){case 0:return f=p.api,h=!1,v={},a.sticker&&(v.sticker_id=a.sticker.id,v.sticker_referrer=a.sticker.referrer),a.botPayload&&(v.payload=a.botPayload),o&&(v.lat=o.coordinates.latitude,v.long=o.coordinates.longitude),u.prev=6,u.next=9,f.fetch("messages.send",E(E({},v),{},{peer_id:e,random_id:t,message:r,reply_to:c,forward_messages:null==l?void 0:l.join(","),attachment:0===n.length?void 0:n.join(","),entrypoint:s,group_id:i}));case 9:u.next=14;break;case 11:u.prev=11,u.t0=u.catch(6),h=!0;case 14:return u.abrupt("return",{type:"UserHitSend_RequestCompleted",peerId:e,randomId:t,hasFailed:h});case 15:case"end":return u.stop()}}),u,null,[[6,11]])})));return function(e){return p.apply(this,arguments)}}()}function P(e){return function(){var t=(0,u.default)(d().mark((function t(){return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,s.sleep)(300);case 2:return t.abrupt("return",{type:"UserSeenMessage_ThrottleTimedOut",peerId:e});case 3:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()}var j=r(96543),F=r(78399),q=function e(t,r,a){switch(r.type){case"LoadChatMembers":return[];case"UserOpenedConvo":var o=r.peerId,i=r.cmid,c=t.convos.get(o),l=t.locks.convosCleanup.get(o)||0;t.locks.convosCleanup.set(o,l+1);var h=(0,p.getOwnerGroupId)(t.ownerId);return c?e(t,{type:"UserOpenedConvo_ConvoRequestCompleted",peerId:o,cmid:i,hasFailed:!1},a):[function(){var e=(0,u.default)(d().mark((function e(t){var r,n;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,e.prev=1,e.next=4,r.fetch("messages.getConversationsById",{peer_ids:o.toString(),group_id:h},{retries:3});case 4:return n=e.sent,e.abrupt("return",{type:"UserOpenedConvo_ConvoRequestCompleted",peerId:o,cmid:i,hasFailed:!1,profiles:n.profiles,groups:n.groups,conversations:n.items,contacts:n.contacts});case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",{type:"UserOpenedConvo_ConvoRequestCompleted",peerId:o,hasFailed:!0});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()];case"UserOpenedConvo_ConvoRequestCompleted":var v=r.peerId,m=r.conversations,b=r.profiles,C=r.cmid,_=r.groups,k=r.contacts;if(r.hasFailed){if(s.isDev)throw new Error("Не удалось загрузить диалог");return[function(){var e=(0,u.default)(d().mark((function e(t){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.router.replace({kind:"MainRoute"}),e.abrupt("return",{type:"Noop"});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()]}(0,p.insertConvos)(t,m||[]),(0,p.insertPeers)(t,{apiUsers:b||[],apiGroups:_||[],apiContacts:k||[]});var w=t.convos.get(v);if(!w){if(s.isDev)throw new Error("Диалог не был найден");return[function(){var e=(0,u.default)(d().mark((function e(t){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.router.replace({kind:"MainRoute"}),e.abrupt("return",{type:"Noop"});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()]}var I=void 0!==C,O=w.isMarkedUnread&&0===w.unreadCount;O&&y.markRead(w),f.refresh(t.organisers,w);var R="ChatConvo"===w.kind&&void 0===w.members&&y.canReadMembers(w)&&!t.locks.getConversationMembers.has(v);R&&t.locks.getConversationMembers.add(v);var A=I||y.length(w).persisted<S.MESSAGES_PER_PAGE&&w.hasMore&&!t.locks.getHistory.has(w.peerId);A&&t.locks.getHistory.add(w.peerId);var x=Object.values(a.me_sticker_packs).flat(),E=w.unreadCount>0,U=!t.locks.getStickerPacks;U&&(t.locks.getStickerPacks=!0);var M=(0,p.getOwnerGroupId)(t.ownerId);return[R&&g.isChatPeerId(v)&&function(){var e=(0,u.default)(d().mark((function e(){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{type:"LoadChatMembers",peerId:v});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),U&&function(){var e=(0,u.default)(d().mark((function e(t){var r,a,s,o,i,u,c,l,p,f,h,v;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,a=t.storage,e.prev=1,s={retries:10},e.next=5,Promise.all([r.fetch("store.getProducts",{type:"stickers",filters:"active",extended:1},s),N({api:r,storage:a})]);case 5:return o=e.sent,i=(0,n.default)(o,2),u=i[0],c=i[1],e.next=11,r.fetchMany([{method:"store.getFavoriteStickers",params:{}},{method:"messages.getRecentStickers",params:{group_id:M}},x.length>0&&{method:"store.getStickers",params:{sticker_ids:x.join()}}],{retries:10});case 11:return l=e.sent,p=(0,n.default)(l,3),f=p[0],h=p[1],v=p[2],e.abrupt("return",{type:"UserOpenedConvo_StickersLoadRequestSucceed",favoriteStickersResponse:f,recentStickersResponse:h,stickerPacksResponse:u,helloStickersResponse:v,stickersKeywordsResponse:c});case 19:return e.prev=19,e.t0=e.catch(1),e.abrupt("return",{type:"UserOpenedConvo_StickersLoadRequestFailed"});case 22:case"end":return e.stop()}}),e,null,[[1,19]])})));return function(t){return e.apply(this,arguments)}}(),O&&function(){var e=(0,u.default)(d().mark((function e(t){var r;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,e.prev=1,e.next=4,r.fetch("messages.markAsRead",{peer_id:v,mark_conversation_as_read:1,group_id:M});case 4:e.next=8;break;case 6:e.prev=6,e.t0=e.catch(1);case 8:return e.abrupt("return",{type:"Noop"});case 9:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(t){return e.apply(this,arguments)}}(),A&&function(){var e=(0,u.default)(d().mark((function e(t){var r,n,a,s;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.api,e.t0=!0,e.next=e.t0===I?4:e.t0===E?7:10;break;case 4:return n=S.MESSAGES_PER_PAGE,a=-(Math.floor(S.MESSAGES_PER_PAGE/2)-1),e.abrupt("break",12);case 7:return n=Math.floor(1.25*S.MESSAGES_PER_PAGE),a=-S.MESSAGES_PER_PAGE,e.abrupt("break",12);case 10:n=S.MESSAGES_PER_PAGE,a=0;case 12:return e.prev=12,e.next=15,r.fetch("messages.getHistory",{peer_id:v,start_cmid:I?C:-1,count:n,offset:a,group_id:M},{retries:5});case 15:return s=e.sent,e.abrupt("return",{type:"UserOpenedConvo_HistoryRequestSucceed",peerId:v,hasMore:I||s.items.length>=n+a,response:s});case 19:return e.prev=19,e.t1=e.catch(12),e.abrupt("return",{type:"UserOpenedConvo_HistoryRequestFailed",peerId:v});case 22:case"end":return e.stop()}}),e,null,[[12,19]])})));return function(t){return e.apply(this,arguments)}}()];case"UserClosedConvo":if((l=t.locks.convosCleanup.get(r.peerId))&&l>1)return t.locks.convosCleanup.set(r.peerId,l-1),[];t.locks.convosCleanup.delete(r.peerId);var P=t.convos.get(r.peerId);return P?(y.cleanup(P),[]):[];case"UserOpenedConvo_HistoryRequestSucceed":var q=r.peerId,T=r.response,D=r.hasMore;t.locks.getHistory.delete(q);var L=t.convos.get(q);if(!L)return[];var B=T.items.map((function(e){return(0,j.fromApiMessage)(e).message}));return y.insertMessages(L,B,D),(0,p.insertPeers)(t,{apiUsers:T.profiles||[],apiGroups:T.groups||[],apiContacts:[]}),[];case"UserOpenedConvo_HistoryRequestFailed":return t.locks.getHistory.delete(r.peerId),[];case"UserOpenedConvo_StickersLoadRequestSucceed":var H,G,z,W=r.stickerPacksResponse,V=r.helloStickersResponse,K=r.favoriteStickersResponse,$=r.recentStickersResponse,Q=r.stickersKeywordsResponse,J=new Map;null===(H=W.items)||void 0===H||H.forEach((function(e){var r=(0,F.fromApiStickerPack)(e);if(r){var n=r.stickerPack,a=r.stickers;J.set(n.id,n),a.forEach((function(e){t.stickers.set(e.id,e)}))}})),t.stickerPacks=J,t.stickersKeywords=(0,F.fromApiStickersKeywords)(Q);var X=function(e){var r=(0,F.fromApiSticker)(e);if(r)return t.stickers.set(r.id,r),r.id};return null==V||V.forEach(X),t.favoriteStickers=[],null===(G=K.items)||void 0===G||G.forEach((function(e){var r=X(e);r&&t.favoriteStickers.push(r)})),t.recentStickers=[],null===(z=$.items)||void 0===z||z.forEach((function(e){var r=X(e);r&&t.recentStickers.push(r)})),[function(){var e=(0,u.default)(d().mark((function e(){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,s.sleep)(S.STICKERS_REFRESH_INTERVAL);case 2:return e.abrupt("return",{type:"UserOpenedConvo_StickersRefreshThrottleTimedOut"});case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()];case"UserOpenedConvo_StickersRefreshThrottleTimedOut":case"UserOpenedConvo_StickersLoadRequestFailed":return t.locks.getStickerPacks=!1,[];default:return(0,s.exhaustivenessCheck)(r)}};function N(e){return T.apply(this,arguments)}function T(){return(T=(0,u.default)(d().mark((function e(t){var r,n,a,s,o,i,u;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,n=t.storage,e.next=3,n.getIDB("stickers-keywords");case 3:if(a=e.sent,s=Math.round((new Date).getTime()/1e3),o=86400,!(i=a&&a.expiresAt>s)){e.next=11;break}e.t0=a.response,e.next=14;break;case 11:return e.next=13,r.fetch("store.getStickersKeywords",{need_stickers:0,all_products:0},{retries:3});case 13:e.t0=e.sent;case 14:return u=e.t0,i||n.setIDB("stickers-keywords",{response:u,expiresAt:s+o}),e.abrupt("return",u);case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var D=r(93209),L=r(81385),B=r(89032),H=r(83906),G=r(90917);function z(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return W(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return W(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,i=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){i=!0,s=e},f:function(){try{o||null==r.return||r.return()}finally{if(i)throw s}}}}function W(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function V(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function K(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?V(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):V(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var $=function(e,t,r){switch(t.type){case"EngineBatchReceived":var n=t.variant;switch(n.kind){case"FromEngine":return Q(r,e,n);case"FromEngineWithMissingData":return function(e,t,r){var n=r.apiConvos,a=r.apiMessages,s=r.apiUsers,o=r.apiGroups,i=r.apiContacts,u=X(a,n);return(0,p.insertConvos)(t,n.map((function(e){return{conversation:e,last_message:u.messages_legacy.get(e.last_message_id)}})),{dangerouslyMerge:!0}),(0,p.insertPeers)(t,{apiUsers:s,apiGroups:o,apiContacts:i}),Q(e,t,{kind:"FromEngine",next:r.skippedBatch},u)}(r,e,n);case"FromApiEngineHistory":return function(e,t,r){var n=r.next,a=r.apiMessages,s=r.apiConvos,o=r.apiUsers,c=r.apiGroups,l=r.apiContacts,f=r.apiCounters,v=X(a,s);(0,p.insertConvos)(t,s.map((function(e){return{conversation:e,last_message:v.messages_legacy.get(e.last_message_id)}})),{dangerouslyMerge:!0}),(0,p.insertPeers)(t,{apiUsers:o,apiGroups:c,apiContacts:l},{dangerouslyOverwrite:!0}),h.updateCounters(t.organisers.filters,{unread:f.messages||0,unreadUnmuted:f.messages_unread_unmuted||0,headerNotMutedUnread:0,archive:f.messages_archive_unread||0,archiveMentions:f.messages_archive_mentions_count||0,archiveTotal:f.messages_archive||0,messageRequests:f.message_requests||0});var m=t.organisers.filters.unread.unreadUnmutedCount;return[].concat((0,i.default)(Q(e,t,{kind:"FromEngine",next:n},v)),[function(){var e=(0,u.default)(d().mark((function e(t){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.notification.setCounters({unread:m}),e.abrupt("return",{type:"Noop"});case 3:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()])}(r,e,n);default:return(0,s.exhaustivenessCheck)(n)}case"EngineBatchReceived_TypingsTimedOut":var a=t.peerId,o=t.typingType,c=t.timestamp,l=e.typings.get(a);if(!l)return[];var f=l[o];return f?(f.updatedAt<=c&&delete l[o],0===Object.keys(l).length&&e.typings.delete(a),[]):[];case"TemporaryHackForResync":case"UpdateMessageRequestsCounter":case"LoadChatMembers":case"UpdateComposerDraftOnMessageDelete":case"ActualizeArchiveMentions":return[];default:return(0,s.exhaustivenessCheck)(t)}};function Q(e,t,r,a){var c=r.next;if("Failure"===c.kind){t.convoConn.status="resyncing";var l=t.convoConn.pts,m=t.ownerId;return[function(){var e=(0,u.default)(d().mark((function e(t){var r,a,o,i,u,c,f,h;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.api,o=t.engine,i=t.queue,e.next=3,(0,s.sleep)(1e3);case 3:return e.prev=3,e.next=7,a.fetchSeq([{method:"messages.getLongPollHistory",params:{lp_version:o.version,credentials:1,pts:l,msgs_limit:1100,events_limit:1100,last_n:1e3,group_id:(0,p.getOwnerGroupId)(m)}},{method:"account.getCounters",params:{filter:"all"}}],{retries:1/0});case 7:f=e.sent,h=(0,n.default)(f,2),u=h[0],c=h[1],e.next=16;break;case 13:return e.prev=13,e.t0=e.catch(3),e.abrupt("return",{type:"Noop"});case 16:if(!(l<(u.from_pts||0))){e.next=19;break}return i.disconnect(),e.abrupt("return",{type:"TemporaryHackForResync"});case 19:if(u.credentials&&u.credentials.pts){e.next=21;break}throw new Error("В ответе getLongPollHistory отсутствуют новые креды!");case 21:return e.next=23,o.connect(K(K({},u.credentials),{},{pts:u.credentials.pts}));case 23:return e.abrupt("return",{type:"EngineBatchReceived",variant:{kind:"FromApiEngineHistory",apiMessages:(null===(r=u.messages)||void 0===r?void 0:r.items)||[],apiConvos:u.conversations||[],apiUsers:u.profiles||[],apiGroups:u.groups||[],apiContacts:u.contacts||[],apiCounters:c,next:{kind:"Batch",pts:u.credentials.pts,ts:u.credentials.ts,updates:u.history||[]}}});case 24:case"end":return e.stop()}}),e,null,[[3,13]])})));return function(t){return e.apply(this,arguments)}}()]}if(!(void 0!==a)&&function(e,t){var r,a=z(t.updates);try{for(a.s();!(r=a.n()).done;){var s=r.value;if(L.IEngine.isIncompleteUpdate(s))return!0;switch(s[0]){case 20:case 21:var o=(0,n.default)(s,2)[1],i=g.resolveId(o);if(!e.convos.has(i))return!0;break;case 52:var u=(0,n.default)(s,4),c=u[1],d=u[2],l=u[3],p=g.resolveId(d),f=e.convos.get(p);if(!f)break;switch(c){case L.IEngine.ChatUpdateType.TitleChanged:case L.IEngine.ChatUpdateType.AvatarChanged:case L.IEngine.ChatUpdateType.BannerChanged:case L.IEngine.ChatUpdateType.MessageRequestChanged:case L.IEngine.ChatUpdateType.MessageRequestCanceled:case L.IEngine.ChatUpdateType.MessageRequestAccepted:case L.IEngine.ChatUpdateType.MessageRequestRejected:return!0;case L.IEngine.ChatUpdateType.UserJoined:case L.IEngine.ChatUpdateType.UserLeft:case L.IEngine.ChatUpdateType.UserKicked:var h=g.resolveId(l);if(!e.peers.has(h))return!0;if(c===L.IEngine.ChatUpdateType.UserJoined&&h===e.ownerId)return!0;break;case L.IEngine.ChatUpdateType.Pinned:var v=(0,n.default)(s,4)[3];if(0===v)break;var m=b.resolveCmid(v);return!f.persisted.has(m);case L.IEngine.ChatUpdateType.CallInProgressChanged:case L.IEngine.ChatUpdateType.ContactConverted:case L.IEngine.ChatUpdateType.ContactJoined:return!0;case L.IEngine.ChatUpdateType.CopyFlagChanged:case L.IEngine.ChatUpdateType.AdminGrated:case L.IEngine.ChatUpdateType.FlagsChanged:case L.IEngine.ChatUpdateType.AdminKicked:case L.IEngine.ChatUpdateType.KeyboardChanged:case L.IEngine.ChatUpdateType.BusinessNotifyDataChanged:case L.IEngine.ChatUpdateType.DonUnsubscribed:case L.IEngine.ChatUpdateType.DonSubscribed:case L.IEngine.ChatUpdateType.IsNewChange:case L.IEngine.ChatUpdateType.StyleChanged:break;default:}break;case 10013:var y=(0,n.default)(s,2)[1],C=g.resolveId(y);return e.convos.has(C);case 63:case 64:case 65:case 66:case 67:case 1:case 2:case 3:case 6:case 7:case 10:case 11:case 12:case 80:case 114:case 115:case 119:case 501:case 502:case 503:case 504:case 505:case 506:case 507:case 508:case 10001:case 10002:case 10006:case 10007:break;case 10003:var _=(0,n.default)(s,4),k=_[2],w=_[3];if(L.IEngine.isIncompleteUpdate(s))break;var I=g.resolveId(w),S=e.convos.get(I);if(!S)break;var O=b.convertFlags(k),R=O.isDeleted,A=O.isSpam;if((R||A)&&S)return!0;break;case 4:case 10004:var x=(0,n.default)(s,9),E=x[4],U=x[7],M=x[8],P=g.resolveId(E),F=e.convos.get(P);if(!F)return!0;var q=Y(F);if(Z(M,q))return!0;if(U.has_template)return!0;var N=(0,j.fromEngineMessage)(s,e.ownerId,q).message;if(!e.peers.has(N.peerId)||!e.peers.has(N.authorId))return!0;break;case 5:case 18:case 10005:case 10018:var T=(0,n.default)(s,8),D=T[3],B=T[7],H=g.resolveId(D),G=e.convos.get(H);if(!G)break;if(Z(B,Y(G)))return!0;break;case 19:case 10019:return!0;default:}}}catch(e){a.e(e)}finally{a.f()}return!1}(t,c))return[J(t.convoConn.pts,c,t.ownerId)];t.convoConn.status="running",t.convoConn.pts=c.pts;var C=c.updates.flatMap((function(e){switch(e[0]){case 1:case 2:case 3:return function(e,t,r){var a=(0,n.default)(t,4),s=a[0],o=a[1],i=a[2],u=a[3],c=g.resolveId(u),d=b.resolveId(o),l=e.convos.get(c);if(!l)return[];var p=y.findMessageById(l,d);if(!p)return[];return ee(e,[{1:10001,2:10002,3:10003}[s],p.cmid,i,u])}(t,e);case 4:case 5:case 18:case 19:return function(e,t,r){var a,o=(0,n.default)(t,2)[1],i=null==r?void 0:r.messages_legacy.get(o);switch(t[0]){case 4:if(L.IEngine.isIncompleteUpdate(t)){if(!i)return[];var u=(0,n.default)(t,4),c=u[2],d=u[3];a=[10004,i.conversation_message_id,c,d,i.peer_id];break}var l=(0,n.default)(t,12),p=l[2],f=l[3],h=l[4],v=l[5],m=l[6],y=l[7],g=l[8],b=l[9];a=[10004,l[10],p,f,h,v,m,y,g,b,o,l[11]];break;case 5:if(L.IEngine.isIncompleteUpdate(t)){if(!i)return[];var C=(0,n.default)(t,3)[2];a=[10005,i.conversation_message_id,C,i.peer_id];break}var _=(0,n.default)(t,11),k=_[2],w=_[3],I=_[4],S=_[5],O=_[6],R=_[7],A=_[8];a=[10005,_[9],k,w,I,S,O,R,A,o,_[10]];break;case 18:if(L.IEngine.isIncompleteUpdate(t)){if(!i)return[];var x=(0,n.default)(t,3)[2];a=[10018,i.conversation_message_id,x,i.peer_id];break}var E=(0,n.default)(t,11),U=E[2],M=E[3],P=E[4],j=E[5],F=E[6],q=E[7],N=E[8];a=[10018,E[9],U,M,P,j,F,q,N,o,E[10]];break;case 19:if(!i)return[];a=[10019,i.conversation_message_id,i.peer_id];break;default:(0,s.exhaustivenessCheck)(t)}return te(e,a,r)}(t,e,a);case 6:case 7:return function(e,t,r){var a,s=(0,n.default)(t,2),o=s[0],i=s[1],u=g.resolveId(i),c=e.convos.get(u);if(!c)return[];var d=null==r?void 0:r.convos.get(i),l=d&&(null===(a=(0,B.fromApiConvo)(d))||void 0===a?void 0:a.convo);if(!l)return[];return 6===o?y.readInUntil(c,l.inReadBy,l.unreadCount):y.readOutUntil(c,l.outReadBy),f.refresh(e.organisers,c),[]}(t,e,a);case 10:case 11:case 12:return function(e,t){var r=(0,n.default)(t,3),a=r[0],s=r[1],o=r[2],i=g.resolveId(s),u=e.convos.get(i);if(!u)return[];var c={10:"unset",11:"replace",12:"set"}[a];return y.updateFlags(u,c,o),f.refresh(e.organisers,u),[]}(t,e);case 20:return function(e,t){var r=(0,n.default)(t,3),a=r[1],s=r[2],o=g.resolveId(a),i=e.convos.get(o);if(!i)return[];return y.updateSortId(i,{majorSortId:s}),f.refresh(e.organisers,i),[]}(t,e);case 21:return function(e,t){var r=(0,n.default)(t,3),a=r[1],s=r[2],o=g.resolveId(a),i=e.convos.get(o);if(!i)return[];y.updateSortId(i,{minorSortId:s}),f.refresh(e.organisers,i);var c=s<=0,l=e.organisers.filters.messageRequest.totalCount>0;if(c&&l)return[(0,u.default)(d().mark((function e(){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{type:"UpdateMessageRequestsCounter",peerId:o});case 1:case"end":return e.stop()}}),e)})))];return[]}(t,e);case 52:return function(e,t,r,a){var s=(0,n.default)(t,4),o=s[1],i=s[2],c=s[3],l=g.resolveId(i),p=e.convos.get(l);if(!p)return[];var h=null==a?void 0:a.convos.get(i),v=h&&(0,B.fromApiConvo)(h);switch(o){case L.IEngine.ChatUpdateType.CopyFlagChanged:case L.IEngine.ChatUpdateType.TitleChanged:case L.IEngine.ChatUpdateType.AvatarChanged:case L.IEngine.ChatUpdateType.FlagsChanged:return[];case L.IEngine.ChatUpdateType.Pinned:if("ChatConvo"!==p.kind)return[];var m=c,C=b.resolveCmid(m);if(e.hiddenPinnedMessages.delete(l),(null==v?void 0:v.convo.kind)===p.kind)return v.convo.pinnedMessage&&y.pinMessage(p,v.convo.pinnedMessage),[];if(0===C)y.unpinMessage(p);else{var _=p.persisted.get(C);"Normal"===(null==_?void 0:_.kind)&&y.pinMessage(p,b.toPinned(_))}return[];case L.IEngine.ChatUpdateType.ContactJoined:return[];case L.IEngine.ChatUpdateType.UserJoined:if("ChatConvo"!==p.kind)return[];var k=g.resolveId(c);if(!g.isUserPeerId(k)&&!g.isGroupPeerId(k))return[];var w={peerId:k,isAdmin:p.adminIds.has(k),canKick:p.adminIds.has(e.viewer.id),isMessageRequest:!1};return y.addMembers(p,[w]),k===e.ownerId?(y.changeUserState(p,"in"),y.allowWrite(p),[g.isChatPeerId(l)&&(0,u.default)(d().mark((function e(){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{type:"LoadChatMembers",peerId:l});case 1:case"end":return e.stop()}}),e)})))]):[];case L.IEngine.ChatUpdateType.UserLeft:if("ChatConvo"!==p.kind)return[];var I=g.resolveId(c);return g.isUserPeerId(I)||g.isGroupPeerId(I)?(I===e.ownerId&&y.changeUserState(p,"left"),y.removeMember(p,I),[]):[];case L.IEngine.ChatUpdateType.UserKicked:if("ChatConvo"!==p.kind)return[];var S=g.resolveId(c);if(!g.isUserPeerId(S)&&!g.isGroupPeerId(S))break;S===e.ownerId&&(y.changeUserState(p,"kicked"),y.restrictWrite(p,"kicked")),y.removeMember(p,S);break;case L.IEngine.ChatUpdateType.KeyboardChanged:return[];case L.IEngine.ChatUpdateType.CallInProgressChanged:return"ChatConvo"===p.kind&&(null==v?void 0:v.convo.kind)===p.kind&&y.updateActiveCall(p,v.convo.activeCall),[];case L.IEngine.ChatUpdateType.IsNewChange:return y.updateIsNew(p,!!c),[];case L.IEngine.ChatUpdateType.MessageRequestChanged:var O=c;switch(O){case L.IEngine.MRStatus.Accepted:if("MessageRequestChatConvo"!==p.kind&&"MessageRequestUserConvo"!==p.kind||"pending"!==p.MRStatus){f.refresh(e.organisers,p);break}var R=y.fromAcceptedMessageRequest(p,null==v?void 0:v.convo);e.convos.set(l,R),f.refresh(e.organisers,R);break;case L.IEngine.MRStatus.New:var A;null!=v&&v.convo&&e.convos.set(l,null==v?void 0:v.convo),f.refresh(e.organisers,null!==(A=null==v?void 0:v.convo)&&void 0!==A?A:p);break;case L.IEngine.MRStatus.Deleted:if("MessageRequestChatConvo"!==p.kind&&"MessageRequestUserConvo"!==p.kind&&"UserConvo"!==p.kind)break;var x=y.fromCancelledMessageRequest(p);e.convos.set(l,x),f.refresh(e.organisers,x);break;case L.IEngine.MRStatus.Rejected:if(y.isRejectedMR(p)){f.refresh(e.organisers,p);break}if("MessageRequestChatConvo"!==p.kind&&"MessageRequestUserConvo"!==p.kind&&"UserConvo"!==p.kind)break;var E=y.fromRejectedMessageRequest(p);e.convos.set(l,E),f.refresh(e.organisers,E);break;default:}return[(0,u.default)(d().mark((function e(){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{type:"UpdateMessageRequestsCounter",peerId:l});case 1:case"end":return e.stop()}}),e)})))];case L.IEngine.ChatUpdateType.AdminGrated:var U=g.resolveId(c);return"ChatConvo"!==p.kind||!g.isUserPeerId(U)&&!g.isGroupPeerId(U)||p.adminIds.add(U),[];case L.IEngine.ChatUpdateType.AdminKicked:var M=g.resolveId(c);return"ChatConvo"!==p.kind||!g.isUserPeerId(M)&&!g.isGroupPeerId(M)||p.adminIds.delete(M),[];case L.IEngine.ChatUpdateType.ContactConverted:var P=g.resolveId(c),j=e.convos.get(P),F=e.peers.get(P);return F&&j&&"Contact"===F.kind&&g.isUserPeerId(l)?(g.convertContact(F,l),y.updateSortId(j,{minorSortId:0}),[function(){var e=(0,u.default)(d().mark((function e(t){var r,n;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.router,"ConvoRoute"===(n=r.currentRoute).kind&&n.peerId===P&&r.replace({kind:"ConvoRoute",entrypoint:"list_all",peerId:l}),e.abrupt("return",{type:"Noop"});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()]):[];case L.IEngine.ChatUpdateType.BannerChanged:return"UserConvo"!==p.kind||(null==v?void 0:v.convo.kind)!==p.kind||(p.convoBanner=null==v?void 0:v.convo.convoBanner),[];case L.IEngine.ChatUpdateType.BusinessNotifyDataChanged:case L.IEngine.ChatUpdateType.MessageRequestAccepted:case L.IEngine.ChatUpdateType.MessageRequestCanceled:case L.IEngine.ChatUpdateType.MessageRequestRejected:case L.IEngine.ChatUpdateType.DonSubscribed:case L.IEngine.ChatUpdateType.DonUnsubscribed:case L.IEngine.ChatUpdateType.StyleChanged:return[];default:}return[]}(t,e,0,a);case 63:case 64:case 65:case 66:case 67:return function(e,t){var r=(0,n.default)(t,5),a=r[0],i=r[1],c=r[2],l=r[3],p=r[4],f=g.resolveId(i),h=new Set(c.map((function(e){return g.resolveId(e)})));if(h.delete(e.viewer.id),!e.convos.get(f))return[];var v={63:"text",64:"voice",65:"photo",66:"video",67:"file"}[a],m=K(K({},e.typings.get(f)||{}),{},(0,o.default)({},v,{peerIds:h,updatedAt:p,totalCount:l}));return e.typings.set(f,m),[function(){var e=(0,u.default)(d().mark((function e(){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,s.sleep)(S.TYPING_EXPIRATION_TIME);case 2:return e.abrupt("return",{type:"EngineBatchReceived_TypingsTimedOut",peerId:f,typingType:v,timestamp:p});case 3:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}()]}(t,e);case 80:return function(e,t){var r=(0,n.default)(t,10),a=r[1],s=r[2],o=r[4],i=r[6],c=r[7],l=r[9];return h.updateCounters(e.organisers.filters,{unread:a,headerNotMutedUnread:i,unreadUnmuted:s,archive:c,archiveMentions:l,businessNotify:o}),[function(){var e=(0,u.default)(d().mark((function e(t){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.notification.setCounters({unreadIdle:i,unread:s}),e.abrupt("return",{type:"Noop"});case 3:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()]}(t,e);case 114:return function(e,t){var r=(0,n.default)(t,2)[1].peer_id,a=g.resolveId(r),s=e.convos.get(a);if(!s)return[];var o=(0,B.fromLongpollPushSettings)(t);return y.updatePush(s,o),[]}(t,e);case 115:return function(e,t){var r=(0,n.default)(t,2)[1];return[function(){var e=(0,u.default)(d().mark((function e(t){var n;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null===(n=t.calls)||void 0===n||n.showIncomingCall(r),e.abrupt("return",{type:"Noop"});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()]}(0,e);case 119:return function(e,t){var r=(0,n.default)(t,2)[1],a=g.resolveId(r.peer_id),s=g.resolveId(r.owner_id),o=e.convos.get(a),i=e.peers.get(a),c=e.peers.get(s),l=o&&i&&c?(0,H.fromApiMessageEvent)(i,c,r):void 0;return[function(){var e=(0,u.default)(d().mark((function e(t){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l&&t.botKeyboard.update(l),e.abrupt("return",{type:"Noop"});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()]}(t,e);case 501:return function(e,t){var r=(0,n.default)(t,3),a=r[1],s=r[2];return(0,p.insertFolders)(e,[{id:a,name:s}]),[]}(t,e);case 502:return function(e,t){var r=(0,n.default)(t,2)[1],a=v.resolveId(r);v.deleteFolder(e.organisers.folders,a);var s,o=z(e.convos.values());try{for(o.s();!(s=o.n()).done;){var i=s.value;y.removeFolder(i,a)}}catch(e){o.e(e)}finally{o.f()}return[]}(t,e);case 503:return function(e,t){var r=(0,n.default)(t,3),a=r[1],s=r[2],o=v.resolveId(a),i=e.organisers.folders.find((function(e){return e.id===o}));if(!i)return[];return v.setName(i,s),[]}(t,e);case 504:return function(e,t){var r=(0,D.default)(t),n=r[1],a=r.slice(2),s=v.resolveId(n),o=(0,p.getConvosByIds)(e,a);if(!e.organisers.folders.find((function(e){return e.id===s})))return[];return(0,p.addConvosToFolder)(e,s,o),[]}(t,e);case 505:return function(e,t){var r=(0,D.default)(t),n=r[1],a=r.slice(2),s=v.resolveId(n),o=(0,p.getConvosByIds)(e,a);if(!e.organisers.folders.find((function(e){return e.id===s})))return[];return(0,p.removeConvosFromFolder)(e,s,o),[]}(t,e);case 506:return function(e,t){var r=(0,D.default)(t).slice(1);return v.reorderFolders(e.organisers.folders,r.map((function(e){return v.resolveId(e)}))),[]}(t,e);case 507:return function(e,t){var r,n=z((0,D.default)(t).slice(1));try{for(n.s();!(r=n.n()).done;){var a=r.value;if(!(a.length<3)){var s=v.resolveId(a[0]);v.setUnreadCounters(e.organisers.folders,s,a[1],a[2])}}}catch(e){n.e(e)}finally{n.f()}return[]}(t,e);case 508:return function(e,t){var r=(0,n.default)(t,2)[1],a=v.resolveId(r),s=e.organisers.folders.find((function(e){return e.id===a}));if(!s)return[];return v.replaceFolder(e.organisers.folders,(0,G.fromApiFolder)({id:a,name:s.name})),[]}(t,e);case 10001:case 10002:case 10003:return ee(t,e,a);case 10004:case 10005:case 10018:case 10019:return te(t,e,a);case 10006:case 10007:return function(e,t){var r=(0,n.default)(t,4),a=r[0],s=r[1],o=r[2],i=r[3],u=g.resolveId(s),c=b.resolveCmid(o),d=e.convos.get(u);if(!d)return[];10006===a?(y.readInUntil(d,c,i),g.isFavorites(d.peerId,e.ownerId)&&y.readOutUntil(d,c)):y.readOutUntil(d,c);return f.refresh(e.organisers,d),[]}(t,e);case 10013:return function(e,t,r){var a=(0,n.default)(t,3),s=a[1],o=a[2],i=g.resolveId(s),c=b.resolveCmid(o),l=e.convos.get(i);if(!l)return[];if(l.persistedCmid!==c)return[];var p=null==r?void 0:r.convos.get(s),h=p&&(0,B.fromApiConvo)(p);if(!h)return[function(){var e=(0,u.default)(d().mark((function e(r){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.logger.error("[EngineBatchReceived]",new Error("В ".concat(t[0]," отсутствует дозагруженная беседа"))),e.abrupt("return",{type:"Noop"});case 3:case"end":return e.stop()}}),e)})));function r(t){return e.apply(this,arguments)}return r}()];e.convos.set(h.convo.peerId,h.convo),h.peer&&e.peers.set(h.peer.id,h.peer);return f.refresh(e.organisers,l),[]}(t,e,a);default:return[]}}));return[function(){var e=(0,u.default)(d().mark((function e(t){var r;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.engine,e.next=3,r.poll();case 3:return e.t0=e.sent,e.t1={kind:"FromEngine",next:e.t0},e.abrupt("return",{type:"EngineBatchReceived",variant:e.t1});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()].concat((0,i.default)(C))}function J(e,t,r){return function(){var n=(0,u.default)(d().mark((function n(a){var s,o,i,u;return d().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=a.api,i=a.engine,a.logger,n.prev=1,n.next=4,o.fetch("messages.getLongPollHistory",{pts:e,lp_version:i.version,group_id:(0,p.getOwnerGroupId)(r)},{retries:1/0});case 4:u=n.sent,n.next=10;break;case 7:return n.prev=7,n.t0=n.catch(1),n.abrupt("return",{type:"Noop"});case 10:return n.abrupt("return",{type:"EngineBatchReceived",variant:{kind:"FromEngineWithMissingData",apiConvos:u.conversations||[],apiMessages:(null===(s=u.messages)||void 0===s?void 0:s.items)||[],apiUsers:u.profiles||[],apiGroups:u.groups||[],skippedBatch:t,apiContacts:u.contacts||[]}});case 11:case"end":return n.stop()}}),n,null,[[1,7]])})));return function(e){return n.apply(this,arguments)}}()}function X(e,t){var r,n=new Map,a=z(e);try{for(a.s();!(r=a.n()).done;){var s=r.value,o=n.get(s.peer_id);o||(o=new Map,n.set(s.peer_id,o)),o.set(s.conversation_message_id,s)}}catch(e){a.e(e)}finally{a.f()}return{messages_legacy:new Map(e.map((function(e){return[e.id,e]}))),messagesByPeerId:n,convos:new Map(t.map((function(e){return[e.peer.id,e]})))}}function Y(e){return function(t){var r=e.persisted.get(t);return"Normal"===(null==r?void 0:r.kind)?r:void 0}}function Z(e,t){if("string"==typeof e.attach1_type)return"sticker"!==e.attach1_type&&("audiomsg"!==e.attach1_kind||"doc"!==e.attach1_type);if(void 0!==e.geo)return!0;if(void 0!==e.fwd&&void 0===e.reply)return!0;if(void 0!==e.reply){var r=JSON.parse(e.reply);if(!t(b.resolveCmid(r.conversation_message_id)))return!0}return!1}function ee(e,t,r){var a=(0,n.default)(t,9),s=a[0],o=a[1],i=a[2],c=a[3],l=b.resolveCmid(o),p=g.resolveId(c),f=e.convos.get(p);if(!f)return[];var h=b.convertFlags(i);if(10003===s){var v=h.isDeleted,m=h.isSpam;if((v||m)&&o){var C,_=null==r||null===(C=r.messagesByPeerId.get(c))||void 0===C?void 0:C.get(o);if(_){var k=(0,j.fromApiMessage)(_);y.restoreMessage(f,k.message,k.mentions.hasDirect||k.mentions.hasMass)}}}var w={10001:"replace",10002:"set",10003:"unset"}[s],I=f.persisted.get(l);return I?(y.updateMessageFlags(f,I.cmid,w,i),[(0,u.default)(d().mark((function e(){var t,r;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(10002===s){e.next=2;break}return e.abrupt("return",{type:"Noop"});case 2:if(t=h.isDeleted,r=h.isDeletedForAll,!t&&!r){e.next=5;break}return e.abrupt("return",{type:"UpdateComposerDraftOnMessageDelete",peerId:p,deletedMessagesCmid:[l]});case 5:return e.abrupt("return",{type:"Noop"});case 6:case"end":return e.stop()}}),e)})))]):[]}function te(e,t,r){var a,o,i=(0,n.default)(t,2)[1];switch(t[0]){case 10004:o=t[4];break;case 10005:case 10018:o=t[3];break;case 10019:o=t[2];break;default:(0,s.exhaustivenessCheck)(t)}var c=g.resolveId(o),l=e.convos.get(c);if(!l)return[];var h,v,m,b=null==r||null===(a=r.messagesByPeerId.get(o))||void 0===a?void 0:a.get(i);if(b){var C,_=(0,j.fromApiMessage)(b);h=_.message,v=_.mentions;var k=null==r||null===(C=r.convos.get(c))||void 0===C?void 0:C.current_keyboard;if(k){var w=(0,H.fromApiKeyboard)(k,c);m="InputKeyboard"===w.kind?{kind:"InputKeyboardUpsertEvent",keyboard:w}:void 0}else m={kind:"InputKeyboardDeleteEvent"}}else{if(L.IEngine.isIncompleteUpdate(t)||10019===t[0])return[];var I=(0,j.fromEngineMessage)(t,e.ownerId,Y(l));h=I.message,v=I.mentions,m=I.keyboardEvent}switch(t[0]){case 10004:var S,O=e.typings.get(l.peerId);if(O){var R,A=z(p.TypingVariants);try{for(A.s();!(R=A.n()).done;){var x=R.value,E=O[x];E&&E.peerIds.has(h.authorId)&&(E.peerIds.delete(h.authorId),E.totalCount--,0===E.totalCount&&delete O[x],0===Object.keys(O).length&&e.typings.delete(l.peerId))}}catch(e){A.e(e)}finally{A.f()}}var U=t[3],M=v.hasDirect||v.hasMass;"ChatConvo"===l.kind?y.appendMessage(l,h,U,M,m):y.appendMessage(l,h,U,!1,m),f.refresh(e.organisers,l);var P=e.organisers.filters.archive,F=P.peerIds,q=P.hasMore,N="ChatConvo"===l.kind&&M&&(q||F.has(l.peerId));e.locks.convosCleanup.has(l.peerId)||y.cleanup(l),"InputKeyboardUpsertEvent"===(null===(S=m)||void 0===S?void 0:S.kind)&&e.hiddenBotKeyboards.delete(l.peerId);var T=h.authorId!==e.viewer.id&&!y.isMuted(l);switch(l.push.mode){case"nothing":T=!1;break;case"direct-mention":T||(T=v.hasDirect);break;case"every-mention":T||(T=v.hasMass||v.hasDirect);break;case"everything":break;default:(0,s.exhaustivenessCheck)(l.push)}var D=e.viewer.settings,B=D.browserNotifications,G=D.soundNotifications;return[function(){var e=(0,u.default)(d().mark((function e(t){var r,n,a;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.notification,n=t.router,a="ConvoRoute"===n.currentRoute.kind&&n.currentRoute.peerId===c,B&&T&&r.notify({message:h},{mode:a?"idle":"normal"}),G&&T&&r.playSound(),e.abrupt("return",{type:"Noop"});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),(0,u.default)(d().mark((function e(){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",N?{type:"ActualizeArchiveMentions",undoHideOnNewMention:!0}:{type:"Noop"});case 1:case"end":return e.stop()}}),e)})))];case 10005:case 10018:case 10019:return y.replaceMessage(l,h,v.hasDirect||v.hasMass),[];default:return(0,s.exhaustivenessCheck)(t)}}var re=r(92954);function ne(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return ae(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ae(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,i=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){i=!0,s=e},f:function(){try{o||null==r.return||r.return()}finally{if(i)throw s}}}}function ae(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function se(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function oe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?se(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):se(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var ie=function(e,t){switch(t.variant.kind){case"FromChannelEngine":return ue(e,t.variant);case"FromChannelEngineWithMissingData":return function(e,t){var r=t.next,n=t.responseChannels;return(0,p.insertChannels)(e,{apiChannels:n.items||[],apiGroups:n.groups||[],dangerouslyMerge:!0}),ue(e,{kind:"FromChannelEngine",isRetry:!0,next:r})}(e,t.variant);case"FromChannelEngineApiHistory":return function(e,t){var r,n=t.ts,a=t.history,s=t.posts,o=new Map,u=ne(s);try{for(u.s();!(r=u.n()).done;){var c=r.value,d=o.get(c.channel_id);d||(d=new Map,o.set(c.channel_id,d)),d.set(c.cmid,c)}}catch(e){u.e(e)}finally{u.f()}return ue(e,{kind:"FromChannelEngine",next:{kind:"Batch",ts:n,updates:a.reduce((function(e,t){switch(t[0]){case 70001:case 70002:var r,n=null===(r=o.get(t[1]))||void 0===r?void 0:r.get(t[2]);return n?(e.push([].concat((0,i.default)(t),[n])),e):e;default:return e.push(t),e}}),[])}})}(e,t.variant);default:return(0,s.exhaustivenessCheck)(t.variant)}};function ue(e,t){var r=t.isRetry,a=t.next;if("Failure"===a.kind){e.channelConn.status="resyncing";var o=e.channelConn.ts;return[function(){var e=(0,u.default)(d().mark((function e(t){var r,n,a;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.api,n=t.channelEngine){e.next=3;break}return e.abrupt("return",{type:"Noop"});case 3:return e.next=5,(0,s.sleep)(1e3);case 5:return e.prev=5,e.next=8,r.fetch("channels.getLongPollHistory",{lp_version:n.version,ts:o,limit:1e3},{retries:1/0});case 8:a=e.sent,e.next=14;break;case 11:return e.prev=11,e.t0=e.catch(5),e.abrupt("return",{type:"Noop"});case 14:return n.connect(oe(oe({},a.credentials),{},{ts:a.new_ts})),e.abrupt("return",{type:"ChannelEngineBatchReceived",variant:{kind:"FromChannelEngineApiHistory",ts:a.new_ts,history:a.history,posts:a.messages||[]}});case 16:case"end":return e.stop()}}),e,null,[[5,11]])})));return function(t){return e.apply(this,arguments)}}()]}if(!r){var c=function(e,t){var r,a=new Set,s=ne(t.updates);try{for(s.s();!(r=s.n()).done;){var o=r.value,i=(0,n.default)(o,2)[1],u=_.resolveId(i);switch(o[0]){case 70001:e.channels.has(u)||a.add(u);break;case 70002:case 70003:case 70004:case 70008:break;case 70005:(0,n.default)(o,3)[2]&&a.add(u);break;case 70009:(0,n.default)(o,3)[2]&&a.add(u);break;default:}}}catch(e){s.e(e)}finally{s.f()}return{channelIds:a}}(e,a);if(c.channelIds.size>0)return[function(){var e=(0,u.default)(d().mark((function e(t){var r,n;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,e.prev=1,e.next=4,r.fetch("channels.getById",{channel_ids:Array.from(c.channelIds).join(",")},{retries:1/0});case 4:return n=e.sent,e.abrupt("return",{type:"ChannelEngineBatchReceived",variant:{kind:"FromChannelEngineWithMissingData",next:a,responseChannels:n}});case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",{type:"Noop"});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()]}e.channelConn.status="running",e.channelConn.ts=a.ts;var l=a.updates.flatMap((function(t){switch(t[0]){case 70001:return function(e,t){var r=(0,n.default)(t,5),a=r[1],s=r[3],o=r[4],i=_.resolveId(a),u=e.channels.get(i);if(!u)return[];_.setSortId(u,{minorSortId:s});var c,d=(0,re.fromApiPost)(o),l=d.post,p=ne(d.reactions);try{for(p.s();!(c=p.n()).done;){var h=c.value;e.reactions.set(h.id,h)}}catch(e){p.e(e)}finally{p.f()}_.appendPost(u,l),f.refreshChannels(e.organisers,u),e.locks.channelsCleanup.has(i)||_.cleanup(u);return[]}(e,t);case 70002:return function(e,t){var r=(0,n.default)(t,4),a=r[1],s=r[3],o=_.resolveId(a),i=e.channels.get(o);if(!i)return[];var u,c=(0,re.fromApiPost)(s),d=c.post,l=ne(c.reactions);try{for(l.s();!(u=l.n()).done;){var p=u.value;e.reactions.set(p.id,p)}}catch(e){l.e(e)}finally{l.f()}return _.replacePost(i,d),[]}(e,t);case 70003:return function(e,t){var r=(0,n.default)(t,4),a=r[1],s=r[2],o=r[3],i=_.resolveId(a),u=k.resolveCmid(s),c=e.channels.get(i);if(!c)return[];return _.setSortId(c,{minorSortId:o}),_.deletePost(c,u),[]}(e,t);case 70004:return function(e,t){var r=(0,n.default)(t,4),a=r[1],s=r[2],o=r[3],i=_.resolveId(a),u=k.resolveCmid(s),c=e.channels.get(i);if(!c)return[];return _.readUntil(c,u,o),[]}(e,t);case 70005:return function(e,t){var r=(0,n.default)(t,4),a=r[1],s=r[2],o=r[3],i=_.resolveId(a),u=e.channels.get(i);if(!u)return[];return _.setArchived(u,!s),m.updateCounters(e.organisers.channelFilters,{archiveTotal:o}),f.refreshChannels(e.organisers,u),[]}(e,t);case 70008:return function(e,t){var r=(0,n.default)(t,2)[1];return m.updateCounters(e.organisers.channelFilters,{unread:r}),[]}(e,t);case 70009:return function(e,t){var r=(0,n.default)(t,3),a=r[1],s=r[2],o=_.resolveId(a),i=e.channels.get(o);if(!i)return[];return _.setMembership(i,Boolean(s)),f.refreshChannels(e.organisers,i),[]}(e,t);default:return[]}}));return[].concat((0,i.default)(l),[function(){var e=(0,u.default)(d().mark((function e(t){var r;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.channelEngine){e.next=3;break}return e.abrupt("return",{type:"Noop"});case 3:return e.next=5,r.poll();case 5:return e.t0=e.sent,e.t1={kind:"FromChannelEngine",next:e.t0},e.abrupt("return",{type:"ChannelEngineBatchReceived",variant:e.t1});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()])}var ce=r(9621);function de(e,t,r){var n=e.api,a=e.storage;switch(t){case"ctrSubmit":var o=ce.IApi.resolveTrackId("account.setInfo","messages_multiline_input");return n.dangerouslyAbort(o),n.fetch("account.setInfo",{name:"messages_multiline_input",value:String(Number(r))},{trackId:o});case"soundNotifications":return a.set("settings-sound-notifications-on",r),Promise.resolve(1);case"showRecommendations":var i=ce.IApi.resolveTrackId("account.setInfo","messages_recommendation_list_hidden");return n.dangerouslyAbort(i),n.fetch("account.setInfo",{name:"messages_recommendation_list_hidden",value:String(Number(!r))},{trackId:i});case"countOnlyNotMuted":var u=ce.IApi.resolveTrackId("account.setInfo","show_only_not_muted_messages");return n.dangerouslyAbort(u),n.fetch("account.setInfo",{name:"show_only_not_muted_messages",value:String(Number(r))},{trackId:u});case"autoUnarchive":var c=ce.IApi.resolveTrackId("account.setInfo","messages_auto_unarchive");return n.dangerouslyAbort(c),n.fetch("account.setInfo",{name:"messages_auto_unarchive",value:String(Number(r))},{trackId:c});case"transcriptAutoShow":var d=ce.IApi.resolveTrackId("account.setInfo","messages_transcript_auto_show");return n.dangerouslyAbort(d),n.fetch("account.setInfo",{name:"messages_transcript_auto_show",value:String(Number(r))},{trackId:d});case"verticalFoldersView":return a.set("folders-view-vertical",r),Promise.resolve(1);default:(0,s.exhaustivenessCheck)(t)}}function le(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function pe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?le(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):le(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function fe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function he(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?fe(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):fe(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function ve(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return me(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return me(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,i=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){i=!0,s=e},f:function(){try{o||null==r.return||r.return()}finally{if(i)throw s}}}}function me(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function ye(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ge(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ye(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ye(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var be={mute:"mute",unmute:"mute",mute_until:"mute_until",pin:"pin",unpin:"pin",mark_read:"mark_read",mark_unread:"mark_read",archive:"archive",unarchive:"archive",clear:"clear",leave:"leave",leave_and_clear:"leave_and_clear",show_pinned_message:"show_pinned_message",hide_pinned_message:"show_pinned_message",show_bot_keyboard:"show_bot_keyboard",hide_bot_keyboard:"hide_bot_keyboard",pin_message_for_all:"pin_message_for_all",unpin_message_for_all:"pin_message_for_all",ban:"ban",unban:"unban",return_to_chat:"return_to_chat",business_notify_enable:"business_notify_enable",business_notify_disable:"business_notify_enable"},Ce={pin:"unpin",unpin:"pin",mark_read:"mark_unread",mark_unread:"mark_read",archive:"unarchive",unarchive:"archive",show_pinned_message:"hide_pinned_message",hide_pinned_message:"show_pinned_message",show_bot_keyboard:"hide_bot_keyboard",hide_bot_keyboard:"show_bot_keyboard"},_e=function e(t,r,n){switch(r.type){case"UserChangedConvo":var a=r.peerId,o=r.userAction,c=t.organisers,h=t.viewer.id,v=ke(r.userAction,a);if(t.locks.convoActions.has(v))return[];t.locks.convoActions.add(v);var m,C=t.convos.get(a),_=t.peers.get(a),k=t.ownerId;if(!C||!_)return[];switch(o){case"pin":m=function(e){return e.fetch("messages.pinConversation",{peer_id:a})};break;case"unpin":m=function(e){return e.fetch("messages.unpinConversation",{peer_id:a})};break;case"mark_read":C.isMarkedUnread=!1,m=function(e){return e.fetch("messages.markAsRead",{peer_id:a,mark_conversation_as_read:1,group_id:(0,p.getOwnerGroupId)(k)})};break;case"mark_unread":C.isMarkedUnread=!0,m=function(e){return e.fetch("messages.markAsUnreadConversation",{peer_id:a,group_id:0})};break;case"archive":case"unarchive":C.isArchived="archive"===o,f.refresh(c,C),m=function(e){return e.fetch("archive"===o?"messages.archiveConversation":"messages.unarchiveConversation",{peer_id:a})};break;case"hide_pinned_message":"ChatConvo"===C.kind&&C.pinnedMessage&&t.hiddenPinnedMessages.set(r.peerId,C.pinnedMessage.cmid);break;case"show_pinned_message":t.hiddenPinnedMessages.delete(r.peerId);break;case"hide_bot_keyboard":t.hiddenBotKeyboards.add(r.peerId);break;case"show_bot_keyboard":t.hiddenBotKeyboards.delete(r.peerId);break;case"clear":m=function(e){return e.fetch("messages.deleteConversation",{peer_id:a,group_id:(0,p.getOwnerGroupId)(k)}).then((function(e){var t=e.last_deleted_id;return Boolean(t)}))};break;case"leave":case"leave_and_clear":if("ChatConvo"!==C.kind)break;m=function(e){return e.fetch("messages.removeChatUser",{chat_id:g.toRealId(a),user_id:h,group_id:(0,p.getOwnerGroupId)(k)})};var w=t.peers.get(a);if(!w||"Chat"!==w.kind)break;y.clearChatDataOnLeave(C),g.clearChatDataOnLeave(w);break;case"ban":if(!("User"===_.kind&&"UserConvo"===C.kind||"Group"===_.kind&&"GroupConvo"===C.kind))break;if(g.updateIsPeerBlacklistedByMe(_,!0),"UserConvo"===C.kind&&y.restrictWrite(C,"peer_blacklisted_by_me"),g.isGroupPeerId(k)){m=function(e){return e.fetch("groups.ban",{owner_id:a,group_id:(0,p.getOwnerGroupId)(k)})};break}m=function(e){return e.fetch("account.ban",{owner_id:a})};break;case"unban":if(!("User"===_.kind&&"UserConvo"===C.kind||"Group"===_.kind&&"GroupConvo"===C.kind))break;if(g.updateIsPeerBlacklistedByMe(_,!1),"UserConvo"===C.kind&&y.allowWrite(C),g.isGroupPeerId(k)){m=function(e){return e.fetch("groups.unban",{owner_id:a,group_id:(0,p.getOwnerGroupId)(k)})};break}m=function(e){return e.fetch("account.unban",{owner_id:a})};break;case"return_to_chat":m=function(e){return e.fetch("messages.addChatUser",{chat_id:g.toRealId(a),user_id:h})};break;default:(0,s.exhaustivenessCheck)(o)}return[function(){var e=(0,u.default)(d().mark((function e(t){var r,n;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.api,e.prev=1,n=!1,!m){e.next=7;break}return e.next=6,m(r);case 6:n=!e.sent;case 7:return e.abrupt("return",{type:"UserChangedConvo_RequestCompleted",hasFailed:n,userAction:o,peerId:a});case 10:return e.prev=10,e.t0=e.catch(1),e.abrupt("return",{type:"UserChangedConvo_RequestCompleted",hasFailed:!0,userAction:o,peerId:a});case 13:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t){return e.apply(this,arguments)}}()];case"UserChangedConvo_RequestCompleted":var I=r.peerId,S=r.userAction,O=r.hasFailed,R=ke(S,I);t.locks.convoActions.delete(R);var A=Ce[S];if(O&&A)return e(t,{type:"UserChangedConvo",userAction:A,peerId:I},n),[];if(O)return[];switch(S){case"clear":case"pin":case"unpin":case"mark_read":case"mark_unread":case"unarchive":case"show_pinned_message":case"hide_pinned_message":case"show_bot_keyboard":case"hide_bot_keyboard":case"ban":case"unban":return[];case"archive":var x=t.convos.get(I);if(!x||"ChatConvo"!==x.kind||!x.unreadMentions.size)return[];var E=b.resolveCmid(Math.max.apply(Math,(0,i.default)(x.unreadMentions)));return[function(){var e=(0,u.default)(d().mark((function e(t){var r,n;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.storage,(n=r.get("archive-mentions-map"))&&E){e.next=4;break}return e.abrupt("return",{type:"Noop"});case 4:return n[I]=E,r.set("archive-mentions-map",n),e.abrupt("return",{type:"Noop"});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()];case"leave":var U=t.convos.get(I);return"ChatConvo"===(null==U?void 0:U.kind)&&y.setConvoState(U,"left"),[];case"leave_and_clear":var M=t.convos.get(I);return"ChatConvo"!==(null==M?void 0:M.kind)?[]:(y.setConvoState(M,"left"),e(t,{type:"UserChangedConvo",userAction:"clear",peerId:I},n));case"return_to_chat":var P=t.convos.get(I);return"ChatConvo"===(null==P?void 0:P.kind)&&y.setConvoState(P,"in"),[];default:return(0,s.exhaustivenessCheck)(r)}case"UserChangedMute":var j=r.peerId,F=r.timer,q=r.userAction,N=ke(r.userAction,j);if(t.locks.convoActions.has(N))return[];var T,D=t.convos.get(j);if(!D)return[];switch(q){case"mute":D.push={mode:"every-mention",disabledUntil:1/0},T=-1;break;case"unmute":D.push={mode:"everything",disabledUntil:0},T=0;break;case"mute_until":D.push={mode:"every-mention",disabledUntil:Date.now()+1e3*F},T=F;break;default:(0,s.exhaustivenessCheck)(q)}return[function(){var e=(0,u.default)(d().mark((function e(t){var r,n;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,e.prev=1,e.next=4,r.fetch("account.setSilenceMode",{time:T,peer_id:j,sound:"unmute"===q?1:0});case 4:return n=e.sent,e.abrupt("return",{type:"UserChangedMute_RequestCompleted",hasFailed:1!==n,userAction:q,peerId:j});case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",{type:"UserChangedMute_RequestCompleted",hasFailed:!0,userAction:q,peerId:j});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()];case"UserChangedMute_RequestCompleted":var L=r.peerId,B=r.userAction,H=r.hasFailed,G=ke(B,L);t.locks.convoActions.delete(G);var z={mute:"unmute",unmute:"mute",mute_until:"unmute"}[B];return H&&z?(e(t,{type:"UserChangedMute",userAction:z,peerId:L,timer:0},n),[]):[];case"UserPinMessage":var W=r.peerId,V=r.cmid,K=r.userAction,$=ke(r.userAction,W);if(t.locks.convoActions.has($))return[];t.locks.convoActions.add($);var Q=t.convos.get(W),J=t.ownerId;if(!Q||"ChatConvo"!==Q.kind)return[];var X=Q.pinnedMessage&&(0,l.current)(Q.pinnedMessage),Y=Q.persisted.get(V);return"Normal"===(null==Y?void 0:Y.kind)&&y.pinMessage(Q,b.toPinned(Y)),[function(){var e=(0,u.default)(d().mark((function e(t){var r;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,e.prev=1,e.next=4,r.fetch("messages.pin",{peer_id:W,conversation_message_id:V,group_id:(0,p.getOwnerGroupId)(J)});case 4:return e.abrupt("return",{type:"UserPinMessage_RequestCompleted",hasFailed:!1,userAction:K,peerId:W,cmid:V});case 7:return e.prev=7,e.t0=e.catch(1),e.abrupt("return",{type:"UserPinMessage_RequestCompleted",hasFailed:!0,userAction:K,pinnedMessage:X,peerId:W,cmid:V});case 10:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t){return e.apply(this,arguments)}}()];case"UserPinMessage_RequestCompleted":var Z=r.peerId,ee=r.hasFailed,te=r.pinnedMessage,re=r.userAction,ne=ke(re,Z);t.locks.convoActions.delete(ne);var ae=t.convos.get(Z);return ae&&"ChatConvo"===ae.kind?(ee&&(y.unpinMessage(ae),te&&y.pinMessage(ae,te)),[]):[];case"UserUnpinMessage":var se=r.peerId,oe=r.userAction,ie=ke(r.userAction,se);if(t.locks.convoActions.has(ie))return[];var ue=t.convos.get(se),ce=t.ownerId;if(!ue||"ChatConvo"!==ue.kind)return[];var de=(0,l.current)(y.unpinMessage(ue));return[function(){var e=(0,u.default)(d().mark((function e(t){var r;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,e.prev=1,e.next=4,r.fetch("messages.unpin",{peer_id:se,group_id:(0,p.getOwnerGroupId)(ce)});case 4:return e.abrupt("return",{type:"UserUnpinMessage_RequestCompleted",hasFailed:!1,userAction:oe,peerId:se});case 7:return e.prev=7,e.t0=e.catch(1),e.abrupt("return",{type:"UserUnpinMessage_RequestCompleted",hasFailed:!0,userAction:oe,prevPinnedMessage:de,peerId:se});case 10:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t){return e.apply(this,arguments)}}()];case"UserUnpinMessage_RequestCompleted":var le=r.peerId,pe=r.hasFailed,fe=r.prevPinnedMessage,he=r.userAction,ve=ke(he,le);t.locks.convoActions.delete(ve);var me=t.convos.get(le);return me&&"ChatConvo"===me.kind?(pe&&fe&&y.pinMessage(me,fe),[]):[];case"UserChangedBusinessNotify":var ye=r.userAction,ge=r.peerId,be=ke(r.userAction,ge);if(t.locks.convoActions.has(be))return[];var _e=t.peers.get(ge);return"Group"!==(null==_e?void 0:_e.kind)||_e.isBlacklistedByMe&&"business_notify_disable"===ye||!_e.isBlacklistedByMe&&"business_notify_enable"===ye?[]:(g.updateIsPeerBlacklistedByMe(_e,"business_notify_disable"===ye),[function(){var e=(0,u.default)(d().mark((function e(t){var r,n;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,e.prev=1,e.next=4,r.fetch("business_notify_disable"===ye?"messages.denyMessagesFromGroup":"messages.allowMessagesFromGroup",{group_id:g.toRealId(ge)});case 4:return n=e.sent,e.abrupt("return",{type:"UserChangedBusinessNotify_RequestCompleted",hasFailed:1!==n,userAction:ye,peerId:ge});case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",{type:"UserChangedBusinessNotify_RequestCompleted",hasFailed:!0,userAction:ye,peerId:ge});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()]);case"UserChangedBusinessNotify_RequestCompleted":var we=r.userAction,Ie=r.peerId,Se=r.hasFailed,Oe=ke(we,Ie);t.locks.convoActions.delete(Oe);var Re=t.peers.get(Ie);return"Group"!==(null==Re?void 0:Re.kind)||Se&&g.updateIsPeerBlacklistedByMe(Re,!Re.isBlacklistedByMe),[];default:(0,s.exhaustivenessCheck)(r)}},ke=function(e,t){return"".concat(be[e],"-").concat(t.toString())},we=function(e,t){return"".concat(e,"-").concat(t)},Ie={mark_important:"unmark_important",unmark_important:"mark_important"},Se={delete:"delete",restore:"restore",mark_important:"mark_important",unmark_important:"mark_important"},Oe=function e(t,r,n){switch(r.type){case"UpdateComposerDraftOnMessageDelete":return[];case"UserChangedMessage":for(var a=r.peerId,o=r.userAction,i=r.cmids,c=r.ids,l=0;l<i.length;l+=1){var f=i[l];if(!f)return[];var h=Re(o,a,f);if(t.locks.messageActions.has(h))return[];t.locks.messageActions.add(h)}var v,m=t.convos.get(a);switch(o){case"mark_important":case"unmark_important":i.forEach((function(e){if(m){var r=m.persisted.get(e);"Normal"===(null==r?void 0:r.kind)&&(r.isImportant="mark_important"===o)}var n=t.importantMessages.messages.get(we(a,e));n&&(n.isImportant="mark_important"===o)})),v=function(e){return e.fetch("messages.markAsImportant",{message_ids:"".concat(c.join(",")),important:"mark_important"===o?1:0}).then((function(e){return Boolean(e[0])}))};break;default:(0,s.exhaustivenessCheck)(o)}return[function(){var e=(0,u.default)(d().mark((function e(t){var r,n;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.api,e.prev=1,n=!1,!v){e.next=7;break}return e.next=6,v(r);case 6:n=!e.sent;case 7:return e.abrupt("return",{type:"UserChangedMessage_RequestCompleted",hasFailed:n,userAction:o,ids:c,cmids:i,peerId:a});case 10:return e.prev=10,e.t0=e.catch(1),e.abrupt("return",{type:"UserChangedMessage_RequestCompleted",hasFailed:!0,userAction:o,ids:c,cmids:i,peerId:a});case 13:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t){return e.apply(this,arguments)}}()];case"UserChangedMessage_RequestCompleted":var g=r.peerId,C=r.userAction,_=r.hasFailed,k=r.cmids,w=r.ids;k.forEach((function(e){var r=Re(C,g,e);t.locks.messageActions.delete(r)}));var I=Ie[C];return _&&I&&e(t,{type:"UserChangedMessage",userAction:I,ids:w,peerId:g,cmids:k},n),[];case"UserDeleteMessage":var S=r.deleteType,O=r.peerId,R=r.userAction,A=r.messages,x=t.ownerId,E=t.convos.get(O);if(!E)return[];for(var U=[],M=0;M<A.length;M+=1){var P=A[M];if(!P||"Normal"!==P.kind)return[];var j=Re(R,O,P.cmid);if(t.locks.messageActions.has(j))return[];t.locks.messageActions.add(j);var F=b.markDeleted(P,"spam"===S);U.push(F);var q=y.isCasper(E)||b.isCall(P);switch(S){case"local":case"spam":if(q){y.deleteMessage(E,P.cmid);break}y.replaceMessage(E,F,!1);break;case"for_all":y.deleteMessage(E,P.cmid);break;default:(0,s.exhaustivenessCheck)(S)}}return[function(){var e=(0,u.default)(d().mark((function e(t){var r,n,a;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,e.prev=1,e.next=4,r.fetch("messages.delete",{message_ids:A.map((function(e){return e.id})).join(","),peer_id:O,delete_for_all:"for_all"===S?1:0,spam:"spam"===S?1:0,group_id:(0,p.getOwnerGroupId)(x)});case 4:return a=e.sent,e.abrupt("return",{type:"UserDeleteMessage_RequestCompleted",hasFailed:!Boolean(null===(n=a[0])||void 0===n?void 0:n.response),userAction:R,deleteType:S,peerId:O,messages:A,deletedMessages:U});case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",{type:"UserDeleteMessage_RequestCompleted",hasFailed:!0,userAction:R,deleteType:S,peerId:O,messages:A,deletedMessages:U});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()];case"UserDeleteFailedMessage":var N=r.peerId,T=r.randomId,D=t.convos.get(N);return D?(y.removeQueued(D,T),[]):[];case"UserDeleteAllFailedMessage":var L=r.peerId,B=t.convos.get(L);return B?(y.allQueuedMessages(B).filter((function(e){return e.hasFailed})).forEach((function(e){y.removeQueued(B,e.randomId)})),[]):[];case"UserDeleteMessage_RequestCompleted":var H=r.peerId,G=r.userAction,z=r.messages,W=r.hasFailed,V=r.deletedMessages,K=t.convos.get(H);return W&&K&&V.forEach((function(e){var t=b.restoreDeleted(e);y.restoreMessage(K,t,!1)})),z.forEach((function(e){var r=e.cmid,n=Re(G,H,r);t.locks.messageActions.delete(n)})),[(0,u.default)(d().mark((function e(){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",W?{type:"Noop"}:{type:"UpdateComposerDraftOnMessageDelete",peerId:H,deletedMessagesCmid:V.map((function(e){return e.cmid}))});case 1:case"end":return e.stop()}}),e)})))];case"UserRestoreMessage":var $=r.peerId,Q=r.userAction,J=r.cmid,X=r.messageId,Y=Re(Q,$,J);if(t.locks.messageActions.has(Y))return[];t.locks.messageActions.add(Y);var Z=t.convos.get($);if(!Z)return[];var ee=t.ownerId,te=Z.persisted.get(J);if(te&&"MarkedDeleted"===te.kind){var re=b.restoreDeleted(te);y.restoreMessage(Z,re,!1)}return[function(){var e=(0,u.default)(d().mark((function e(t){var r,n;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,e.prev=1,e.next=4,r.fetch("messages.restore",{message_id:X,group_id:(0,p.getOwnerGroupId)(ee)});case 4:return n=e.sent,e.abrupt("return",{type:"UserRestoreMessage_RequestCompleted",hasFailed:!Boolean(n),userAction:Q,messageId:X,peerId:$,cmid:J});case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",{type:"UserRestoreMessage_RequestCompleted",hasFailed:!0,userAction:Q,messageId:X,peerId:$,cmid:J});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()];case"UserRestoreMessage_RequestCompleted":var ne=r.peerId,ae=r.userAction,se=r.cmid,oe=r.hasFailed,ie=Re(ae,ne,se);t.locks.messageActions.delete(ie);var ue=t.convos.get(ne),ce=null==ue?void 0:ue.persisted.get(se);return oe&&ue&&ce&&"Normal"===ce.kind&&e(t,{type:"UserDeleteMessage",messages:[ce],deleteType:"local",peerId:ne,userAction:"delete"},n),[];default:(0,s.exhaustivenessCheck)(r)}},Re=function(e,t,r){return"".concat(Se[e],"-").concat(t.toString(),"-").concat(r.toString())};function Ae(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function xe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ae(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ae(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Ee(e,t,r){return Ue.apply(this,arguments)}function Ue(){return(Ue=(0,u.default)(d().mark((function e(t,r,n){var a,s;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.fetch("messages.getConversations",{filter:"archive",count:t.totalCount,group_id:(0,p.getOwnerGroupId)(n)});case 2:return a=e.sent,s=a.items,e.abrupt("return",s);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Me(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Pe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Me(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Me(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function je(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Fe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?je(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):je(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var qe=function e(t,r,n){switch(r.type){case"LoadChatMembers":return[];case"UserOpenedConvoProfile":var a=r.peerId,o=r.isLinkWithHistory,i=t.convos.get(a),c=t.ownerId;return i?e(t,{type:"UserOpenedConvoProfile_ConvoRequestCompleted",peerId:a,hasFailed:!1,isLinkWithHistory:o},n):[function(){var e=(0,u.default)(d().mark((function e(t){var r,n;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,e.prev=1,e.next=4,r.fetch("messages.getConversationsById",{peer_ids:a.toString(),group_id:(0,p.getOwnerGroupId)(c)},{retries:3});case 4:return n=e.sent,e.abrupt("return",{type:"UserOpenedConvoProfile_ConvoRequestCompleted",peerId:a,hasFailed:!1,profiles:n.profiles,groups:n.groups,conversations:n.items,contacts:n.contacts,isLinkWithHistory:o});case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",{type:"UserOpenedConvoProfile_ConvoRequestCompleted",peerId:a,hasFailed:!0,isLinkWithHistory:o});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()];case"UserOpenedConvoProfile_ConvoRequestCompleted":var l=r.peerId,f=r.conversations,h=r.profiles,v=r.groups,m=r.contacts,b=r.hasFailed,C=r.isLinkWithHistory,_=t.ownerId;if(b){if(s.isDev)throw new Error("Не удалось загрузить диалог");return[(0,u.default)(d().mark((function e(){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{type:"Noop"});case 1:case"end":return e.stop()}}),e)})))]}(0,p.insertConvos)(t,f||[]),(0,p.insertPeers)(t,{apiUsers:h||[],apiGroups:v||[],apiContacts:m||[]});var k=t.convos.get(l);if(!k){if(s.isDev)throw new Error("Диалог не был найден");return[function(){var e=(0,u.default)(d().mark((function e(t){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.router.replace({kind:"MainRoute"}),e.abrupt("return",{type:"Noop"});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()]}var w="ChatConvo"===k.kind&&void 0===k.members&&y.canReadMembers(k)&&!t.locks.getConversationMembers.has(l);w&&t.locks.getConversationMembers.add(l);var I="ChatConvo"===k.kind&&k.acl.canSeeInviteLink;return[w&&g.isChatPeerId(l)&&function(){var e=(0,u.default)(d().mark((function e(){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{type:"LoadChatMembers",peerId:l});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),I&&g.isChatPeerId(l)&&function(){var e=(0,u.default)(d().mark((function e(t){var r;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,e.prev=1,e.t0=l,e.t1=C,e.next=6,r.fetch("messages.getInviteLink",{peer_id:l,visible_messages_count:C?250:0,reset:0,group_id:(0,p.getOwnerGroupId)(_)},{retries:1});case 6:return e.t2=e.sent,e.abrupt("return",{type:"UserOpenedConvoProfile_InviteLinksCompleted",peerId:e.t0,isLinkWithHistory:e.t1,response:e.t2});case 10:e.prev=10,e.t3=e.catch(1);case 12:return e.abrupt("return",{type:"Noop"});case 13:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t){return e.apply(this,arguments)}}()];case"UserOpenedConvoProfile_InviteLinksCompleted":var S=r.peerId,O=r.response.link,R=r.isLinkWithHistory,A=t.convos.get(S);return A&&"ChatConvo"===A.kind&&O?(y.replaceInviteLinks(A,Fe(Fe({},A.inviteLinks),R?{withHistory:O}:{noHistory:O})),[]):[];default:(0,s.exhaustivenessCheck)(r)}},Ne=function(e,t,r){switch(t.type){case"UserUpdatedFolder":var n=t.folderId,a=t.name,o=t.addPeerIds,u=t.removePeerIds;if(e.locks.updateFolder.has(n))return[];if(function(e,t){if(new Set((0,i.default)(e).filter((function(e){return t.has(e)}))).size)return!0;return!1}(o,u))throw new Error("Peer id не может одновременно находиться в списке на добавление и на удаление");e.locks.updateFolder.add(n);var c=e.organisers.folders.find((function(e){return e.id===n}));if(!c)return[];var d=(0,p.getConvosByIds)(e,Array.from(u)),l=(0,p.getConvosByIds)(e,Array.from(o));return a&&v.setName(c,a),(0,p.removeConvosFromFolder)(e,c.id,d),(0,p.addConvosToFolder)(e,c.id,l),[Te(n,a,o,u)];case"UserUpdatedFolder_UpdateRequestCompleted":var f=t.hasFailed,h=t.folderId;if(e.locks.updateFolder.delete(h),f&&s.isDev)throw new Error("Не удалось изменить папку");return[];default:(0,s.exhaustivenessCheck)(t)}};function Te(e,t,r,n){return function(){var a=(0,u.default)(d().mark((function a(s){var o,u,c,l;return d().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return o=s.api,u=!1,c={folder_id:e},t&&(c.name=t),r.size&&(c.add_included_peer_ids=(0,i.default)(r).join(",")),n.size&&(c.remove_included_peer_ids=(0,i.default)(n).join(",")),a.prev=6,a.next=9,o.fetch("messages.updateFolder",c);case 9:l=a.sent,u=1!==l,a.next=16;break;case 13:a.prev=13,a.t0=a.catch(6),u=!0;case 16:return a.abrupt("return",{type:"UserUpdatedFolder_UpdateRequestCompleted",hasFailed:u,folderId:e,addPeerIds:r,removePeerIds:n,name:t});case 17:case"end":return a.stop()}}),a,null,[[6,13]])})));return function(e){return a.apply(this,arguments)}}()}function De(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return Le(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Le(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,i=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){i=!0,s=e},f:function(){try{o||null==r.return||r.return()}finally{if(i)throw s}}}}function Le(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Be=r(6978),He=function(e,t){switch(t.type){case"UserChangedChatMember":var r=t.peerId,n=t.memberId,a=t.userAction;if(!e.convos.get(r))return[];var o=function(e,t){var r=t.userAction,n=t.peerId,a=t.memberId;switch(r){case"promote":return function(e){return e.api.fetch("messages.setMemberRole",{member_id:a,peer_id:n,role:"admin"})};case"demote":return function(e){return e.api.fetch("messages.setMemberRole",{member_id:a,peer_id:n,role:"member"})};case"cancel_invitation":case"remove":return function(t){return t.api.fetch("messages.removeChatUser",{chat_id:g.toRealId(n),member_id:a,group_id:(0,p.getOwnerGroupId)(e)})};default:return(0,s.exhaustivenessCheck)(r)}}(e.ownerId,t);return[function(){var e=(0,u.default)(d().mark((function e(t){var s;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,o(t);case 3:return s=e.sent,e.abrupt("return",{type:"UserChangedChatMember_RequestCompleted",hasFailed:1!==s,peerId:r,memberId:n,userAction:a});case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",{type:"UserChangedChatMember_RequestCompleted",hasFailed:!0,peerId:r,memberId:n,userAction:a});case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}()];case"UserChangedChatMember_RequestCompleted":var i=t.peerId,c=t.memberId,l=t.userAction,f=t.hasFailed,h=e.convos.get(i);return f||"ChatConvo"!==(null==h?void 0:h.kind)?[]:("cancel_invitation"===l&&y.removeMember(h,c),g.isContactPeerId(c)||("promote"===l&&y.addAdmin(h,c),"demote"===l&&y.removeAdmin(h,c),"remove"===l&&y.removeMember(h,c)),[]);default:return(0,s.exhaustivenessCheck)(t)}};var Ge=function(e,t){switch(t.type){case"LoadChatMembers":var r=t.peerId,n=(0,p.getOwnerGroupId)(e.ownerId);return[function(){var e=(0,u.default)(d().mark((function e(t){var a;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.api,e.prev=1,e.t0=r,e.next=5,a.fetch("messages.getConversationMembers",{peer_id:r,group_id:n},{retries:1});case 5:return e.t1=e.sent,e.abrupt("return",{type:"LoadChatMembers_RequestComplete",peerId:e.t0,response:e.t1,hasFailed:!1});case 9:return e.prev=9,e.t2=e.catch(1),e.abrupt("return",{type:"LoadChatMembers_RequestComplete",peerId:r,hasFailed:!0});case 12:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t){return e.apply(this,arguments)}}()];case"LoadChatMembers_RequestComplete":var a=t.peerId,o=t.response,i=t.hasFailed;e.locks.getConversationMembers.delete(a);var c=e.convos.get(a);if("ChatConvo"!==(null==c?void 0:c.kind)||i||!o)return[];var l=o.items.reduce((function(e,t){var r=g.resolveId(t.member_id);if(!g.isUserPeerId(r)&&!g.isGroupPeerId(r)&&!g.isContactPeerId(r))return e;var n={isAdmin:Boolean(t.is_admin),canKick:Boolean(t.can_kick),isMessageRequest:Boolean(t.is_message_request),peerId:r};return t.is_message_request&&t.request_date&&(n.requestDate=1e3*t.request_date),e.members.push(n),g.isContactPeerId(r)||(t.is_admin&&e.adminIds.push(r),t.is_owner&&(e.ownerId=r)),e}),{members:[],adminIds:[]}),f=l.members,h=l.adminIds,v=l.ownerId;return y.addMembers(c,f),h.forEach((function(e){y.addAdmin(c,e)})),v&&y.setOwner(c,v),(0,p.insertPeers)(e,{apiUsers:o.profiles||[],apiGroups:o.groups||[],apiContacts:o.contacts||[]}),[];default:(0,s.exhaustivenessCheck)(t)}},ze={archive:"archive",unarchive:"unarchive",join:"join",leave:"join",mute:"mute",unmute:"unmute"},We={archive:"unarchive",unarchive:"archive",join:"leave",leave:"join",mute:"unmute",unmute:"mute"},Ve=function e(t,r,n){var a=r.type;switch(a){case"UserChangedChannel":var o=r.channelId,i=r.userAction,c=Ke(r.userAction,o);if(t.locks.channelActions.has(c))return[];t.locks.channelActions.add(c);var l,p=t.channels.get(o);if(!p)return[];switch(i){case"archive":_.setArchived(p,!0),f.refreshChannels(t.organisers,p),l=function(e){return e.fetch("channels.archive",{channel_ids:String(o)}).then((function(e){return Boolean(e)}))};break;case"unarchive":_.setArchived(p,!1),f.refreshChannels(t.organisers,p),l=function(e){return e.fetch("channels.unarchive",{channel_ids:String(o)}).then((function(e){return Boolean(e)}))};break;case"join":_.setMembership(p,!0),f.refreshChannels(t.organisers,p),l=function(e){return e.fetch("channels.join",{channel_id:o})};break;case"leave":_.setMembership(p,!1),f.refreshChannels(t.organisers,p),l=function(e){return e.fetch("channels.leave",{channel_id:o})};break;case"mute":_.setMuted(p,!0),l=function(e){return e.fetch("channels.setNotificationMode",{channel_id:o,mode:"disabled"}).then((function(e){return Boolean(e)}))};break;case"unmute":_.setMuted(p,!1),l=function(e){return e.fetch("channels.setNotificationMode",{channel_id:o,mode:"enabled"}).then((function(e){return Boolean(e)}))};break;default:(0,s.exhaustivenessCheck)(i)}return[function(){var e=(0,u.default)(d().mark((function e(t){var r,n;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.api,e.prev=1,n=!1,!l){e.next=7;break}return e.next=6,l(r);case 6:n=!e.sent;case 7:return e.abrupt("return",{type:"UserChangedChannel_RequestCompleted",channelId:o,hasFailed:n,userAction:i});case 10:return e.prev=10,e.t0=e.catch(1),e.abrupt("return",{type:"UserChangedChannel_RequestCompleted",channelId:o,hasFailed:!0,userAction:i});case 13:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t){return e.apply(this,arguments)}}()];case"UserChangedChannel_RequestCompleted":var h=r.channelId,v=r.userAction,m=r.hasFailed,y=Ke(v,h);t.locks.channelActions.delete(y);var g=We[v];return m&&g&&(e(t,{type:"UserChangedChannel",userAction:g,channelId:h},n),t.locks.channelActions.delete(y)),[];default:(0,s.exhaustivenessCheck)(a)}},Ke=function(e,t){return"".concat(ze[e],"-").concat(t.toString())};function $e(e){return function(){var t=(0,u.default)(d().mark((function t(){return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,s.sleep)(300);case 2:return t.abrupt("return",{type:"UserSeenPost_ThrottleTimedOut",channelId:e});case 3:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()}var Qe=r(53752),Je=r(60082);function Xe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Ye(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Xe(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Xe(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Ze=r(51766),et=r(94170);function tt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function rt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?tt(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):tt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var nt={UserChangedLike:"UserChangedLike",UserChangedLike_RequestCompleted:"UserChangedLike",UserLoadedLikes:"UserLoadedLikes",UserLoadedLikes_RequestCompleted:"UserLoadedLikes"},at=function e(t,r,n){var a,o,i;switch(r.kind){case"comment":var c=r.channelId,l=r.postCmid,f=r.commentCmid,h=r.replyCmid,v=t.channels.get(c),m=v&&_.findPostByCmid(v,l),y="Normal"===(null==m?void 0:m.kind)&&k.findCommentByCmid(m,f);if(!y||"Normal"!==y.kind)break;if(a=y.channelId,h){var b=Ze.findReplyByCmid(y,h);if(!b||"Normal"!==b.kind)break;i=b,o=b.cmid;break}i=y,o=y.cmid;break;case"post":var C=r.channelId,w=r.postCmid,I=t.channels.get(C),O=I&&_.findPostByCmid(I,w);if(!O||"Normal"!==O.kind)break;a=O.channelId,o=O.cmid,i=O;break;default:(0,s.exhaustivenessCheck)(r)}if(!i||!a||!o)return[];var R=st(nt[r.type],r.kind,a,o);switch(r.type){case"UserLoadedLikes":if(t.locks.getLikesList.has(R))return[];var A;switch(t.locks.getLikesList.add(R),r.kind){case"comment":case"post":A=i.likes.peerIds.size;break;default:(0,s.exhaustivenessCheck)(r)}var x=0===i.likes.peerIds.size?S.LIKE_PEERS_FIRST_LOAD:S.LIKE_PEERS_PER_PAGE;return[function(){var e=(0,u.default)(d().mark((function e(t){var n,s;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.api,e.prev=1,e.next=4,n.fetch("likes.getList",{type:r.kind,owner_id:a,item_id:o,extended:1,skip_own:1,count:x,offset:A});case 4:return s=e.sent,e.abrupt("return",rt(rt({},r),{},{type:"UserLoadedLikes_RequestCompleted",response:s,hasFailed:!1}));case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",rt(rt({},r),{},{type:"UserLoadedLikes_RequestCompleted",hasFailed:!0}));case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()];case"UserLoadedLikes_RequestCompleted":var E=r.hasFailed,U=r.response;if(t.locks.getLikesList.delete(R),E||!U)return[];var M=U.items.filter((function(e){return"profile"===e.type})),P=U.items.filter((function(e){return"group"===e.type})),j=U.items.map((function(e){return g.resolveId(e.id)}));switch((0,p.insertPeers)(t,{apiUsers:M,apiGroups:P,apiContacts:[]}),r.kind){case"comment":case"post":j.forEach((function(e){var t;return null===(t=i)||void 0===t?void 0:t.likes.peerIds.add(e)}));break;default:(0,s.exhaustivenessCheck)(r)}return[];case"UserChangedLike":var F=r.userAction,q=r.reactionId;if(t.locks.getLikesList.has(R))return[];t.locks.getLikesList.add(R);var N=void 0;switch(F){case"like":void 0===i.likes.reactionId&&(i.likes.count+=1),i.likes.reactionId=q||et.resolveId(0);break;case"dislike":i.likes.count-=1,N=i.likes.reactionId,i.likes.reactionId=void 0;break;default:(0,s.exhaustivenessCheck)(F)}return[function(){var e=(0,u.default)(d().mark((function e(t){var n,s;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.api,e.prev=1,e.next=4,n.fetch("like"===F?"likes.add":"likes.delete",{type:r.kind,owner_id:a,item_id:o||0,reaction_id:q});case 4:return s=e.sent,e.abrupt("return",rt(rt({},r),{},{type:"UserChangedLike_RequestCompleted",response:s,hasFailed:!1}));case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",rt(rt({},r),{},{type:"UserChangedLike_RequestCompleted",hasFailed:!0,prevReactionId:N}));case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()];case"UserChangedLike_RequestCompleted":var T=r.hasFailed,D=r.response,L=r.prevReactionId,B=r.userAction;return t.locks.getLikesList.delete(R),T||!D?(e(t,rt(rt({},r),{},{type:"UserChangedLike",reactionId:"dislike"===B?L:void 0,userAction:"like"===B?"dislike":"like"}),n),t.locks.getLikesList.delete(R),[]):(i.likes.count=D.likes,[]);default:(0,s.exhaustivenessCheck)(r)}},st=function(e,t,r,n){return"".concat(e,"-").concat(t,"-").concat(r,"-").concat(n)};function ot(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function it(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ot(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ot(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var ut={delete:"delete",restore:"delete"},ct=function e(t,r,n){var a,o=r.type,i=r.channelId,c=r.postCmid,l=r.commentCmid,p=r.replyCmid,f=r.userAction,h=dt(f,i,c,p||l),v=t.channels.get(i),m=v&&_.findPostByCmid(v,c),y="Normal"===(null==m?void 0:m.kind)&&k.findCommentByCmid(m,l);if(!y)return[];if(p){var g=Ze.findReplyByCmid(y,p);if(!g||"Deleted"===g.kind)return[];a=g}else a=y;if(!y)return[];switch(o){case"UserDeleteComment":if(t.locks.commentActions.has(h)||"Normal"!==a.kind)return[];t.locks.commentActions.add(h);var b=Ze.markDeleted(a);return p?Ze.replaceReply(y,b):k.replaceComment(m,b),[function(){var e=(0,u.default)(d().mark((function e(t){var n,a;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.api,e.prev=1,e.next=4,n.fetch("wall.deleteComment",{owner_id:i,comment_id:b.cmid});case 4:return a=e.sent,e.abrupt("return",it(it({},r),{},{type:"UserDeleteComment_RequestCompleted",hasFailed:!Boolean(a),deletedComment:b}));case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",it(it({},r),{},{type:"UserDeleteComment_RequestCompleted",hasFailed:!0,deletedComment:b}));case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()];case"UserRestoreComment":if(t.locks.commentActions.has(h)||"MarkedDeleted"!==a.kind)return[];t.locks.commentActions.add(h);var C=Ze.restoreDeleted(a);return p?Ze.replaceReply(y,C):k.replaceComment(m,C),[function(){var e=(0,u.default)(d().mark((function e(t){var n,a;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.api,e.prev=1,e.next=4,n.fetch("wall.restoreComment",{owner_id:i,comment_id:C.cmid});case 4:return a=e.sent,e.abrupt("return",it(it({},r),{},{type:"UserRestoreComment_RequestCompleted",hasFailed:!Boolean(a)}));case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",it(it({},r),{},{type:"UserRestoreComment_RequestCompleted",hasFailed:!0}));case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()];case"UserDeleteComment_RequestCompleted":case"UserRestoreComment_RequestCompleted":var w=r.hasFailed;return t.locks.commentActions.delete(h),w&&e(t,it(it({},r),"delete"===f?{type:"UserRestoreComment",userAction:"restore"}:{type:"UserDeleteComment",userAction:"delete"}),n),t.locks.commentActions.delete(h),[];default:(0,s.exhaustivenessCheck)(r)}},dt=function(e,t,r,n){return"".concat(ut[e],"-").concat(t,"-").concat(r,"-").concat(n)};function lt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function pt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?lt(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):lt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var ft=function(e,t,r){var n=g.resolveId(e),a=t?g.resolveId(t):void 0;if(!g.isUserPeerId(n))throw Error("Viewer может быть только пользователем");if(void 0!==a&&!g.isUserPeerId(a)&&!g.isGroupPeerId(a))throw Error("Owner может быть только пользователем или группой");return[{convoConn:{status:"loading",pts:0},channelConn:{status:"running",ts:0},viewer:{id:n,profileType:(0,O.fromApiProfileType)(r),settings:{ctrSubmit:!1,soundNotifications:!0,browserNotifications:!1,showRecommendations:!0,countOnlyNotMuted:!1,autoUnarchive:!0,transcriptAutoShow:!0,theme:"system",verticalFoldersView:!1},profileInfo:{id:n},accounts:[]},ownerId:g.resolveId(),organisers:f.empty(),channels:new Map([[_.resolveId(0),{kind:"Channel",id:_.resolveId(0),name:"",activity:"",isAdmin:!1,isVerified:!1,photos:{},inReadCmid:k.resolveCmid(0),unreadCount:0,isArchived:!1,isMuted:!1,notificationsDisabledUntil:0,majorSortId:0,minorSortId:0,membersCount:0,isMember:!1,pending:{},locks:{loading:!1,cleanUp:0},history:[]}]]),convos:new Map([[g.resolveId(),{kind:"UserConvo",peerId:g.resolveId(),unreadCount:0,majorSortId:0,minorSortId:0,inReadBy:b.resolveCmid(0),outReadBy:b.resolveCmid(0),isNew:!1,folderIds:new Set,isMarkedUnread:!1,isArchived:!1,canWrite:{allowed:!1,reason:"unknown"},push:{mode:"everything",disabledUntil:0},persistedCmid:b.resolveCmid(),persisted:new Map,queuedId:b.resolveRandomId(),queued:new Map,afterGapCmid:b.resolveCmid(),unreadExpireables:new Set,hasMore:!1,entrypoint:null}]]),composerDrafts:{},readQueues:new Map,channelReadQueues:new Map,peers:new Map([[g.resolveId(),{kind:"User",id:g.resolveId(),firstName:"...",firstNameGen:"...",firstNameAcc:"...",lastName:"...",lastNameGen:"...",lastNameAcc:"...",sex:"unknown",lastSeen:{isVisible:!1,platform:"other"},isVerified:!1,canCall:!0,followersCount:0,canChangeFriendship:!1,canMessage:!1,friendship:"unfamiliar",isBlacklisted:!1,isBlacklistedByMe:!1,isDeactivated:!1,canInviteToChats:!1}]]),onlines:new Set,typings:new Map,convosSearchIndex:w.create(),locks:{getConversations:{all:!1,unread:!1,archive:!1,messageRequest:!1},getChannels:{all:!1,unread:!1},hideFilter:{all:!1,unread:!1,chats:!1,archive:!1,messageRequest:!1,businessNotify:!1},getHistory:new Set,getConversationMembers:new Set,sendQueue:new Map,edit:new Set,convosCleanup:new Map,channelsCleanup:new Map,updateFriendshipOrMembership:new Set,convoActions:new Set,messageActions:new Set,channelActions:new Set,settings:new Set,contactList:!1,newFolder:!1,deleteFolder:new Set,updateFolder:new Set,reorderFolders:!1,getChannelHistory:new Set,changeMessageRequest:new Set,getStickerPacks:!1,getImportantUsers:!1,getPostCommentsHistory:new Set,getLikesList:new Set,commentActions:new Set},hiddenPinnedMessages:new Map,helpHints:null,stickerPacks:new Map,stickers:new Map,favoriteStickers:[],recentStickers:[],stickersKeywords:{},contacts:{items:new Map,contacts:new Map,hasMore:!0},importantMessages:{messages:new Map,hasMore:!0},hiddenBotKeyboards:new Set,reactions:new Map,importantUsers:null},[function(){return Promise.resolve({type:"InitialData",ownerId:a})}]]};function ht(e,t,r){if("TemporaryHackForResync"===t.type)return ft(e.viewer.id,e.ownerId,"edu"===e.viewer.profileType?2:0);var a,c=(0,l.createDraft)(e);switch(t.type){case"Noop":a=[];break;case"InitialData":case"InitialData_RequestCompleted":a=vt(c,t,r);break;case"EngineBatchReceived":case"EngineBatchReceived_TypingsTimedOut":a=$(c,t,r);break;case"ChannelEngineBatchReceived":a=ie(c,t);break;case"QueueBatchReceived":a=function(e,t){var r=t.next;if("Reconnecting"===r.kind)return[function(){var e=(0,u.default)(d().mark((function e(t){var r;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.queue,e.next=3,r.poll();case 3:return e.t0=e.sent,e.abrupt("return",{type:"QueueBatchReceived",next:e.t0});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()];if("Disconnected"===r.kind){if("manual"===r.reason)return[];var n=e.viewer.id;return[function(){var e=(0,u.default)(d().mark((function e(t){var r,a,s;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.queue,a=t.api,e.next=3,a.fetch("queue.subscribe",{queue_ids:"onlfriends_".concat(n)},{retries:1/0});case 3:return s=e.sent,r.connect(ge({user_id:n},s)),e.next=7,r.poll();case 7:return e.t0=e.sent,e.abrupt("return",{type:"QueueBatchReceived",next:e.t0});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()]}var a,s=ve(r.events);try{for(s.s();!(a=s.n()).done;){var o=a.value;switch(o.entity_type){case"online":var i=g.resolveId(o.data.user_id);if(!g.isUserPeerId(i))break;o.data.online?e.onlines.add(i):e.onlines.delete(i);var c=e.peers.get(i);if(!c||"User"!==c.kind)break;g.updateLastSeen(c,1e3*o.data.last_seen,(0,I.convertPlatform)(o.data.platform,o.data.app_id));break;default:o.entity_type}}}catch(e){s.e(e)}finally{s.f()}return[function(){var e=(0,u.default)(d().mark((function e(t){var r;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.queue,e.next=3,r.poll();case 3:return e.t0=e.sent,e.abrupt("return",{type:"QueueBatchReceived",next:e.t0});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()]}(c,t);break;case"MoreConvosNeeded":case"MoreConvosNeeded_RequestCompleted":a=function(e,t,r){switch(t.type){case"MoreConvosNeeded":var n,a=t.organiser,o=e.ownerId,i="";switch(a.kind){case"filters":var c=a.filter;if(i=h.getLockId(c),e.locks.getConversations[i]||!e.organisers.filters[c].hasMore)return[];n={start_message_id:h.isLoaded(e.organisers.filters[c])?e.organisers.filters[c].boundary.minorSortId:void 0,filter:h.snakeCaseId(c),group_id:(0,p.getOwnerGroupId)(o)};break;case"folders":var l=a.id,f=a.filter;i=v.getLockId(l,f);var m=e.organisers.folders.find((function(e){return e.id===l}));if(!m)throw new Error("Не найдена папка");if(e.locks.getConversations[i]||v.isLoaded(m,f)&&!m[f].hasMore)return[];n={start_message_id:v.isLoaded(m,f)?m[f].boundaryMinorId:void 0,folder_id:m.id,filter:f,group_id:(0,p.getOwnerGroupId)(o)};break;default:(0,s.exhaustivenessCheck)(a)}return e.locks.getConversations[i]=!0,[function(){var e=(0,u.default)(d().mark((function e(r){var a,s,o;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=r.api,e.prev=1,n){e.next=4;break}throw new Error("Нет параметров запроса");case 4:return s=S.CONVOS_PER_PAGE,e.next=7,a.fetch("messages.getConversations",pe(pe({},n),{},{count:s}),{retries:3});case 7:return o=e.sent,e.abrupt("return",pe(pe({},t),{},{type:"MoreConvosNeeded_RequestCompleted",hasFailed:!1,requestedCount:s,hasMore:o.items.length>=s,response:o}));case 11:return e.prev=11,e.t0=e.catch(1),e.abrupt("return",pe(pe({},t),{},{type:"MoreConvosNeeded_RequestCompleted",hasMore:!1,hasFailed:!0}));case 14:case"end":return e.stop()}}),e,null,[[1,11]])})));return function(t){return e.apply(this,arguments)}}()];case"MoreConvosNeeded_RequestCompleted":var y=t.hasFailed,g=t.organiser,b=t.hasMore,C="";switch(g.kind){case"filters":C=h.getLockId(g.filter);break;case"folders":C=v.getLockId(g.id,g.filter);break;default:(0,s.exhaustivenessCheck)(g)}if(e.locks.getConversations[C]=!1,y)return[];var _=t.response;if(_){var k=(0,p.insertConvos)(e,_.items,{dangerouslyMerge:!0});switch((0,p.insertPeers)(e,{apiUsers:_.profiles||[],apiGroups:_.groups||[],apiContacts:_.contacts||[]}),g.kind){case"filters":h.push(e.organisers.filters,g.filter,k,b);break;case"folders":var w=e.organisers.folders.find((function(e){return e.id===g.id}));if(!w)return[];v.push(e.organisers.folders,g.id,g.filter,k,b);break;default:(0,s.exhaustivenessCheck)(g)}}return[];default:(0,s.exhaustivenessCheck)(t)}}(c,t);break;case"MoreChannelsNeeded":case"MoreChannelsNeeded_RequestCompleted":a=function(e,t){switch(t.type){case"MoreChannelsNeeded":var r=t.organiser,n=r.filter,a=m.getLockId(n);if(e.locks.getChannels[a]||!e.organisers.channelFilters[n].hasMore)return[];var o=e.organisers.channelFilters[n].boundary,i=o.minorSortId,c=o.channelId;e.locks.getChannels[a]=!0;var l=S.CHANNELS_PER_PAGE+1,f=m.isLoaded(e.organisers.channelFilters[n])?i:void 0;return[function(){var e=(0,u.default)(d().mark((function e(n){var a,s,o;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.api,e.prev=1,e.next=4,a.fetch("channels.get",{count:l,offset_minor_sort_id:f,offset_channel_id:c,filter:m.snakeCaseId(r.filter)},{retries:3});case 4:return o=e.sent,e.abrupt("return",he(he({},t),{},{type:"MoreChannelsNeeded_RequestCompleted",hasFailed:!1,response:o,hasMore:((null===(s=o.items)||void 0===s?void 0:s.length)||0)>=l}));case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",he(he({},t),{},{type:"MoreChannelsNeeded_RequestCompleted",hasFailed:!0,hasMore:!1}));case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()];case"MoreChannelsNeeded_RequestCompleted":var h=t.hasFailed,v=t.organiser,y=t.hasMore,g="";if("channelFilters"===v.kind?g=m.getLockId(v.filter):(0,s.exhaustivenessCheck)(v.kind),e.locks.getChannels[g]=!1,h)return[];var b=t.response;if(b){var C=(0,p.insertChannels)(e,{apiChannels:b.items||[],apiGroups:b.groups||[]});(0,p.insertPeers)(e,{apiUsers:b.profiles||[],apiGroups:b.groups||[],apiContacts:[]}),"channelFilters"===v.kind?m.push(e.organisers.channelFilters,v.filter,C,y):(0,s.exhaustivenessCheck)(v.kind)}return[];default:(0,s.exhaustivenessCheck)(t)}}(c,t);break;case"CacheUpdateReceived":a=function(e,t,r){var n=t.profiles,a=t.groups,s=t.conversations,o=t.mutualFriends,i=t.contacts;if((0,p.insertConvos)(e,s||[]),(0,p.insertPeers)(e,{apiUsers:n||[],apiGroups:a||[],apiContacts:i||[]}),o){var u=e.peers.get(g.resolveId(o.peerId));u&&g.updateMutualFriends(u,o.hint.map(g.resolveId),o.count)}return[]}(c,t);break;case"UserScrolledConvoHistory":case"UserScrolledConvoHistoryToMessage":case"UserScrolledConvoHistory_RequestSucceed":case"UserScrolledConvoHistory_RequestFailed":a=function(e,t){switch(t.type){case"UserScrolledConvoHistory":var r=t.peerId,n=t.direction,a=e.ownerId,o=e.convos.get(r);if(!o)return[];if("end"===n)return y.cleanup(o),[];if(e.locks.getHistory.has(r))return[];if("forward"===n&&!y.hasGap(o))return[];if("backward"===n&&!o.hasMore)return[];e.locks.getHistory.add(t.peerId);var c=S.MESSAGES_PER_PAGE;switch(n){case"forward":var l=o.afterGapCmid,f=-c;return[function(){var e=(0,u.default)(d().mark((function e(t){var n;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.api,e.prev=1,e.t0=r,e.next=5,n.fetch("messages.getHistory",{peer_id:r,start_cmid:l,count:c,offset:f,group_id:(0,p.getOwnerGroupId)(a)},{retries:5});case 5:return e.t1=e.sent,e.abrupt("return",{type:"UserScrolledConvoHistory_RequestSucceed",peerId:e.t0,response:e.t1});case 9:return e.prev=9,e.t2=e.catch(1),e.abrupt("return",{type:"UserScrolledConvoHistory_RequestFailed",peerId:r});case 12:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t){return e.apply(this,arguments)}}()];case"backward":var h=Math.min.apply(Math,(0,i.default)(o.persisted.keys()));return[function(){var e=(0,u.default)(d().mark((function e(t){var n,s;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.api,e.prev=1,e.next=4,n.fetch("messages.getHistory",{peer_id:r,start_cmid:h,count:c,offset:0,group_id:(0,p.getOwnerGroupId)(a)},{retries:5});case 4:return s=e.sent,e.abrupt("return",{type:"UserScrolledConvoHistory_RequestSucceed",peerId:r,hasMore:s.items.length>=c+0,response:s});case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",{type:"UserScrolledConvoHistory_RequestFailed",peerId:r});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()];default:return(0,s.exhaustivenessCheck)(n)}case"UserScrolledConvoHistoryToMessage":var v=t.peerId,m=t.cmid,g=e.convos.get(v),b=e.ownerId;return g?y.isCmidInIterator(g,m)?[]:(y.clearAfterGap(g),e.locks.getHistory.add(t.peerId),[function(){var e=(0,u.default)(d().mark((function e(t){var r,n;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,e.prev=1,e.next=4,r.fetch("messages.getHistory",{peer_id:v,start_cmid:m,count:S.MESSAGES_PER_PAGE,offset:-(Math.floor(S.MESSAGES_PER_PAGE/2)-1),group_id:(0,p.getOwnerGroupId)(b)},{retries:5});case 4:return n=e.sent,e.abrupt("return",{type:"UserScrolledConvoHistory_RequestSucceed",peerId:v,hasMore:!0,response:n});case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",{type:"UserScrolledConvoHistory_RequestFailed",peerId:v});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()]):[];case"UserScrolledConvoHistory_RequestSucceed":var C=t.peerId,_=t.response,k=t.hasMore;e.locks.getHistory.delete(C);var w=e.convos.get(C);if(!w)return[];var I=_.items.map((function(e){return(0,j.fromApiMessage)(e).message}));return y.insertMessages(w,I,k),(0,p.insertPeers)(e,{apiUsers:_.profiles||[],apiGroups:_.groups||[],apiContacts:[]}),[];case"UserScrolledConvoHistory_RequestFailed":return e.locks.getHistory.delete(t.peerId),[];default:return(0,s.exhaustivenessCheck)(t)}}(c,t);break;case"UserSeenMessage":case"UserSeenMessage_ThrottleTimedOut":case"UserSeenMessage_RequestCompleted":a=function(e,t,r){switch(t.type){case"UserSeenMessage":var n=t.cmid,a=t.peerId,o=e.convos.get(a);if(!o)return[];if(n<=o.inReadBy)return[];y.readInUntil(o,n),f.refresh(e.organisers,o);var i=e.readQueues.has(a);return e.readQueues.set(a,o.inReadBy),i?[]:[P(a)];case"UserSeenMessage_ThrottleTimedOut":var c=t.peerId,l=e.readQueues.get(c),h=e.ownerId;return l?[function(){var e=(0,u.default)(d().mark((function e(t){var r;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,e.prev=1,e.next=4,r.fetch("messages.markAsRead",{peer_id:c,start_cmid:l,mark_conversation_as_read:1,group_id:(0,p.getOwnerGroupId)(h)});case 4:e.next=8;break;case 6:e.prev=6,e.t0=e.catch(1);case 8:return e.abrupt("return",{type:"UserSeenMessage_RequestCompleted",peerId:c,readUntilCmid:l});case 9:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(t){return e.apply(this,arguments)}}()]:[];case"UserSeenMessage_RequestCompleted":var v=t.peerId,m=t.readUntilCmid,g=e.readQueues.get(v);return g?m>=g?(e.readQueues.delete(v),[]):[P(v)]:[];default:return(0,s.exhaustivenessCheck)(t)}}(c,t);break;case"UserHitSend":case"UserHitSend_RequestCompleted":case"UserHitResendAllFailedMessages":case"ResendAllFailedMessages":case"UserHitResendFailedMessage":a=U(c,t,r);break;case"UserHitEdit":case"UserHitEdit_RequestCompleted":a=function(e,t){switch(t.type){case"UserHitEdit":var r=t.mid,n=t.text,a=t.attaches,o=t.peerId,i=t.keepForwarded,c=t.keepSnippets,l=e.convos.get(o),f=e.ownerId;if(!l)return[];e.locks.edit.add(o);var h=R.ids(a).join(",");return[function(){var e=(0,u.default)(d().mark((function e(t){var s,u,l,v;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.api,u=!1,e.prev=2,e.next=5,s.fetch("messages.edit",{message_id:r,peer_id:o,message:n,attachment:0===h.length?void 0:h,group_id:(0,p.getOwnerGroupId)(f),keep_forward_messages:i?1:0,keep_snippets:c?1:0,lat:null===(l=a.geo)||void 0===l?void 0:l.coordinates.latitude,long:null===(v=a.geo)||void 0===v?void 0:v.coordinates.longitude});case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),u=!0;case 10:return e.abrupt("return",{type:"UserHitEdit_RequestCompleted",peerId:o,hasFailed:u});case 11:case"end":return e.stop()}}),e,null,[[2,7]])})));return function(t){return e.apply(this,arguments)}}()];case"UserHitEdit_RequestCompleted":var v=t.peerId;return t.hasFailed,e.locks.edit.delete(v),e.convos.get(v),[];default:return(0,s.exhaustivenessCheck)(t)}}(c,t);break;case"UserOpenedConvo":case"UserClosedConvo":case"UserOpenedConvo_ConvoRequestCompleted":case"UserOpenedConvo_HistoryRequestSucceed":case"UserOpenedConvo_HistoryRequestFailed":case"UserOpenedConvo_StickersLoadRequestSucceed":case"UserOpenedConvo_StickersLoadRequestFailed":case"UserOpenedConvo_StickersRefreshThrottleTimedOut":a=q(c,t,r);break;case"UserChangedFriendship":case"UserChangedFriendship_RequestCompleted":a=function(e,t){switch(t.type){case"UserChangedFriendship":var r=e.peers.get(t.userId);if("User"!==(null==r?void 0:r.kind)||e.locks.updateFriendshipOrMembership.has(r.id))return[];var n=r.friendship;return g.updateFriendship(r,t.change),n===r.friendship?[]:(e.locks.updateFriendshipOrMembership.add(r.id),[function(){var e=(0,u.default)(d().mark((function e(r){var n,a;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.api,a=!1,e.prev=2,e.next=5,n.fetch("friends.".concat(t.change),{user_id:t.userId});case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),a=!0;case 10:return e.abrupt("return",{type:"UserChangedFriendship_RequestCompleted",userId:t.userId,change:t.change,hasFailed:a});case 11:case"end":return e.stop()}}),e,null,[[2,7]])})));return function(t){return e.apply(this,arguments)}}()]);case"UserChangedFriendship_RequestCompleted":e.locks.updateFriendshipOrMembership.delete(t.userId);var a=e.peers.get(t.userId);return"User"!==(null==a?void 0:a.kind)||t.hasFailed&&g.updateFriendship(a,{add:"delete",delete:"add"}[t.change]),[];default:return(0,s.exhaustivenessCheck)(t)}}(c,t);break;case"UserChangedGroupMembership":case"UserChangedGroupMembership_RequestCompleted":a=function(e,t){switch(t.type){case"UserChangedGroupMembership":var r=e.peers.get(t.groupId);if("Group"!==(null==r?void 0:r.kind)||e.locks.updateFriendshipOrMembership.has(r.id))return[];var n=r.membership;return g.updateMembership(r,t.change),n===r.membership?[]:(e.locks.updateFriendshipOrMembership.add(r.id),[function(){var e=(0,u.default)(d().mark((function e(r){var n,a,s;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.api,a="groups.".concat(t.change),s=!1,e.prev=3,e.next=6,n.fetch(a,{group_id:-t.groupId});case 6:e.next=11;break;case 8:e.prev=8,e.t0=e.catch(3),s=!0;case 11:return e.abrupt("return",{type:"UserChangedGroupMembership_RequestCompleted",groupId:t.groupId,change:t.change,hasFailed:s});case 12:case"end":return e.stop()}}),e,null,[[3,8]])})));return function(t){return e.apply(this,arguments)}}()]);case"UserChangedGroupMembership_RequestCompleted":e.locks.updateFriendshipOrMembership.delete(t.groupId);var a=e.peers.get(t.groupId);return"Group"!==(null==a?void 0:a.kind)||t.hasFailed&&g.updateMembership(a,{join:"leave",leave:"join"}[t.change]),[];default:return(0,s.exhaustivenessCheck)(t)}}(c,t);break;case"UserChangedSetting":case"UserChangedSetting_RequestCompleted":a=function(e,t){var r=t.type;switch(r){case"UserChangedSetting":var n=t.setting;e.locks.settings.add(n);var a=e.viewer.settings[t.setting];return e.viewer.settings[t.setting]=t.value,[function(){var e=(0,u.default)(d().mark((function e(r){var n;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,de(r,t.setting,t.value);case 3:return n=e.sent,"transcriptAutoShow"===t.setting&&1===n&&r.stats.logEvent("type_action",{type:"type_settings_changes_item",type_settings_changes_item:{type:"general",name:"voice_transcription_autoshow",value_old:String(Number(a)),value_new:String(Number(t.value)),screen:"im_web_settings"}}),e.abrupt("return",{type:"UserChangedSetting_RequestCompleted",hasFailed:1!==n,setting:t.setting,previousValue:a});case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",{type:"UserChangedSetting_RequestCompleted",hasFailed:!0,setting:t.setting,previousValue:a});case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t){return e.apply(this,arguments)}}()];case"UserChangedSetting_RequestCompleted":var o=t.setting;return e.locks.settings.delete(o),t.hasFailed&&(e.viewer.settings[t.setting]=t.previousValue),[];default:(0,s.exhaustivenessCheck)(r)}}(c,t);break;case"SettingThemeUpdated":case"SettingThemeUpdated_RequestCompleted":a=function(e,t){var r=t.type;switch(r){case"SettingThemeUpdated":e.locks.settings.add("theme");var n=e.viewer.settings.theme;return e.viewer.settings.theme=t.value,[function(){var e=(0,u.default)(d().mark((function e(r){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r.storage.set("theme",t.value),e.abrupt("return",{type:"SettingThemeUpdated_RequestCompleted",hasFailed:!1,previousValue:n});case 5:return e.prev=5,e.t0=e.catch(0),e.abrupt("return",{type:"SettingThemeUpdated_RequestCompleted",hasFailed:!0,previousValue:n});case 8:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(t){return e.apply(this,arguments)}}()];case"SettingThemeUpdated_RequestCompleted":return e.locks.settings.delete("theme"),t.hasFailed&&(e.viewer.settings.theme=t.previousValue),[];default:(0,s.exhaustivenessCheck)(r)}}(c,t);break;case"UserListenedVoice":case"UserListenedVoice_RequestCompleted":a=function(e,t){switch(t.type){case"UserListenedVoice":var r=t.cmid,n=t.peerId,a=e.convos.get(n),o=null==a?void 0:a.persisted.get(r),i=e.ownerId;return"Normal"===(null==o?void 0:o.kind)&&b.canChangeVoiceListenedStatus(o)?[function(){var e=(0,u.default)(d().mark((function e(t){var a,s;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.api,e.prev=1,e.next=4,a.fetch("messages.markAsListened",{peer_id:n,cmid:r,group_id:(0,p.getOwnerGroupId)(i)},{retries:1});case 4:return s=e.sent,e.abrupt("return",{type:"UserListenedVoice_RequestCompleted",hasFailed:1!==s,cmid:r,peerId:n});case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",{type:"UserListenedVoice_RequestCompleted",hasFailed:!0,cmid:r,peerId:n});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()]:[];case"UserListenedVoice_RequestCompleted":if(!t.hasFailed){var c=t.cmid,l=t.peerId,f=e.convos.get(l),h=null==f?void 0:f.persisted.get(c);if(!h)return[];b.markVoiceListened(h)}return[];default:(0,s.exhaustivenessCheck)(t)}}(c,t);break;case"UserSeenHelpHint":case"UserSeenHelpHint_RequestCompleted":a=function(e,t){switch(t.type){case"UserSeenHelpHint":return e.helpHints&&delete e.helpHints[t.hintId],[function(){var e=(0,u.default)(d().mark((function e(r){var n,a;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.api,e.prev=1,e.next=4,n.fetch("account.hideHelpHint",{hint_id:t.hintId},{retries:1});case 4:return a=e.sent,e.abrupt("return",{type:"UserSeenHelpHint_RequestCompleted",hasFailed:1!==a});case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",{type:"UserSeenHelpHint_RequestCompleted",hasFailed:!0});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()];case"UserSeenHelpHint_RequestCompleted":return[];default:(0,s.exhaustivenessCheck)(t)}}(c,t);break;case"UserChangedConvo":case"UserChangedConvo_RequestCompleted":case"UserPinMessage":case"UserPinMessage_RequestCompleted":case"UserUnpinMessage":case"UserUnpinMessage_RequestCompleted":case"UserChangedMute":case"UserChangedMute_RequestCompleted":case"UserChangedBusinessNotify":case"UserChangedBusinessNotify_RequestCompleted":a=_e(c,t,r);break;case"UserChangedMessage":case"UserChangedMessage_RequestCompleted":case"UserDeleteMessage":case"UserDeleteMessage_RequestCompleted":case"UserDeleteFailedMessage":case"UserDeleteAllFailedMessage":case"UserRestoreMessage":case"UserRestoreMessage_RequestCompleted":a=Oe(c,t,r);break;case"LoadContactList":case"LoadContactList_RequestCompleted":a=function(e,t){switch(t.type){case"LoadContactList":return e.locks.contactList?[]:(e.locks.contactList=!0,[function(){var e=(0,u.default)(d().mark((function e(r){var n,a;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.api,e.prev=1,e.next=4,n.fetch("account.getContactList",{extended:1,fields:S.API_USER_FIELDS.join(","),offset:t.offset},{retries:1});case 4:return a=e.sent,e.abrupt("return",{type:"LoadContactList_RequestCompleted",hasFailed:1!==a,contacts:a.contacts||[],profiles:a.profiles||[],items:a.items||[]});case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",{type:"LoadContactList_RequestCompleted",hasFailed:!0,contacts:[],profiles:[],items:[]});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()]);case"LoadContactList_RequestCompleted":return e.locks.contactList=!1,(0,p.insertContacts)(e,t.contacts),(0,p.insertContactItems)(e,t.items,t.profiles),e.contacts.hasMore=!1,[];default:(0,s.exhaustivenessCheck)(t)}}(c,t);break;case"UserHideFilter":case"UserHideFilter_Completed":case"UserUndoHideFilter":case"ActualizeArchiveMentions":case"LoadArchiveConvos_RequestCompleted":case"UserActualizeHideFilter":a=function(e,t){switch(t.type){case"UserHideFilter":if("archive"===t.kind){var r=(0,l.current)(e),a=r.organisers,c=r.ownerId;return a.filters.archive.hasMore&&(e.locks.hideFilter.archive=!0),[function(){var e=(0,u.default)(d().mark((function e(t){var r,n;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.api,a.filters.archive.hasMore){e.next=3;break}return e.abrupt("return",{type:"UserHideFilter_Completed",kind:"archive"});case 3:return e.next=5,Ee(a.filters.archive,r,c);case 5:return n=e.sent,e.abrupt("return",{type:"LoadArchiveConvos_RequestCompleted",convos:n,nextAction:{type:"UserHideFilter_Completed",kind:"archive"}});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()]}return"businessNotify"===t.kind?e.organisers.filters.businessNotify.unreadCount>0?[]:[function(){var e=(0,u.default)(d().mark((function e(t){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.storage.set("business-notify-manually-hidden",!0),e.abrupt("return",{type:"UserHideFilter_Completed",kind:"businessNotify"});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()]:"all"===t.kind||"unread"===t.kind||"chats"===t.kind||"messageRequest"===t.kind?[]:(0,s.exhaustivenessCheck)(t.kind);case"LoadArchiveConvos_RequestCompleted":var f=t.convos,v=t.nextAction,m=(0,p.insertConvos)(e,f,{dangerouslyMerge:!0});return h.push(e.organisers.filters,"archive",m,!1),[(0,u.default)(d().mark((function e(){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",v);case 1:case"end":return e.stop()}}),e)})))];case"UserHideFilter_Completed":return"archive"===t.kind?(e.locks.hideFilter.archive=!1,h.toggleArchiveVisibility(e.organisers.filters,!1),[function(){var e=(0,u.default)(d().mark((function e(t){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.storage.set("archive-manually-hidden",!0),e.abrupt("return",{type:"ActualizeArchiveMentions",undoHideOnNewMention:!1});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()]):"businessNotify"===t.kind?(h.toggleBusinessNotifyVisibility(e.organisers.filters,!1),[]):"all"===t.kind||"unread"===t.kind||"chats"===t.kind||"messageRequest"===t.kind?[]:(0,s.exhaustivenessCheck)(t.kind);case"UserUndoHideFilter":return"archive"===t.kind?(h.toggleArchiveVisibility(e.organisers.filters,!0),[function(){var e=(0,u.default)(d().mark((function e(t){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.storage.set("archive-manually-hidden",!1),e.abrupt("return",{type:"Noop"});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()]):"businessNotify"===t.kind?(h.toggleBusinessNotifyVisibility(e.organisers.filters,!0),[function(){var e=(0,u.default)(d().mark((function e(t){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.storage.set("business-notify-manually-hidden",!1),e.abrupt("return",{type:"Noop"});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()]):"all"===t.kind||"unread"===t.kind||"chats"===t.kind||"messageRequest"===t.kind?[]:(0,s.exhaustivenessCheck)(t.kind);case"UserActualizeHideFilter":if("archive"===t.kind){var C=(0,l.current)(e.organisers.filters.archive).isHidden;return[function(){var e=(0,u.default)(d().mark((function e(t){var r,n;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.storage,!(n=r.get("archive-manually-hidden"))||C){e.next=4;break}return e.abrupt("return",{type:"UserHideFilter",kind:"archive"});case 4:if(n||!C){e.next=6;break}return e.abrupt("return",{type:"UserUndoHideFilter",kind:"archive"});case 6:return e.abrupt("return",{type:"Noop"});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),(0,u.default)(d().mark((function e(){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{type:"ActualizeArchiveMentions",undoHideOnNewMention:!0});case 1:case"end":return e.stop()}}),e)})))]}if("businessNotify"===t.kind){var _=e.organisers.filters.businessNotify.unreadCount,k=e.organisers.filters.businessNotify.isHidden;return[function(){var e=(0,u.default)(d().mark((function e(t){var r,n;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.storage,!(n=r.get("business-notify-manually-hidden"))||k){e.next=4;break}return e.abrupt("return",{type:"UserHideFilter",kind:"businessNotify"});case 4:if(n||!k){e.next=6;break}return e.abrupt("return",{type:"UserUndoHideFilter",kind:"businessNotify"});case 6:if(0!==_){e.next=8;break}return e.abrupt("return",{type:"Noop"});case 8:return e.abrupt("return",{type:"UserUndoHideFilter",kind:"businessNotify"});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()]}return"all"===t.kind||"unread"===t.kind||"chats"===t.kind||"messageRequest"===t.kind?[]:(0,s.exhaustivenessCheck)(t.kind);case"ActualizeArchiveMentions":if(e.organisers.filters.archive.hasMore){var w=(0,l.current)(e),I=w.organisers,S=w.ownerId;return[function(){var e=(0,u.default)(d().mark((function e(r){var n,a;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.api,e.next=3,Ee(I.filters.archive,n,S);case 3:return a=e.sent,e.abrupt("return",{type:"LoadArchiveConvos_RequestCompleted",convos:a,nextAction:{type:"ActualizeArchiveMentions",undoHideOnNewMention:t.undoHideOnNewMention}});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()]}var O=e.organisers.filters.archive.peerIds,R=(0,i.default)(O).map((function(t){return y.safeGet(e.convos,t)})).reduce((function(e,t){if("ChatConvo"!==t.kind||!t.unreadMentions.size)return e;var r=b.resolveCmid(Math.max.apply(Math,(0,i.default)(t.unreadMentions)));return xe(xe({},e),{},(0,o.default)({},t.peerId,r))}),{});return[function(){var e=(0,u.default)(d().mark((function e(r){var a,s;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=r.storage,s=a.get("archive-mentions-map")||{},a.set("archive-mentions-map",R),!Object.entries(R).some((function(e){var t=(0,n.default)(e,2),r=t[0];return t[1]!==s[g.resolveId(Number(r))]}))||!t.undoHideOnNewMention){e.next=6;break}return e.abrupt("return",{type:"UserUndoHideFilter",kind:"archive"});case 6:return e.abrupt("return",{type:"Noop"});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()];default:(0,s.exhaustivenessCheck)(t)}}(c,t);break;case"UserAcceptedChatMessageRequest":case"UserRejectedMessageRequest":case"UserAcceptedChatMessageRequest_RequestCompleted":case"UserRejectedChatMessageRequest_RequestCompleted":case"UpdateMessageRequestsCounter":case"UpdateMessageRequestsCounter_RequestCompleted":a=function(e,t){var r=t.type,n=e.viewer.id;switch(r){case"UserAcceptedChatMessageRequest":var a=t.peerId;return e.locks.changeMessageRequest.has(a)?[]:(e.locks.changeMessageRequest.add(a),[function(){var e=(0,u.default)(d().mark((function e(t){var r;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,e.prev=1,e.next=4,r.fetch("messages.acceptMessageRequest",{peer_id:a,user_id:n});case 4:return e.abrupt("return",{type:"UserAcceptedChatMessageRequest_RequestCompleted",peerId:a});case 7:return e.prev=7,e.t0=e.catch(1),e.abrupt("return",{type:"UserAcceptedChatMessageRequest_RequestCompleted",peerId:a});case 10:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t){return e.apply(this,arguments)}}()]);case"UserRejectedMessageRequest":var o=t.peerId,i=t.isSpam;if(e.locks.changeMessageRequest.has(o))return[];e.locks.changeMessageRequest.add(o);var c=e.convos.get(o),p=(0,l.current)(c);if(void 0!==c&&("MessageRequestChatConvo"===c.kind||"MessageRequestUserConvo"===c.kind||"UserConvo"===c.kind)){var v=y.fromRejectedMessageRequest(c);e.convos.set(o,v),f.refresh(e.organisers,v)}return[function(){var e=(0,u.default)(d().mark((function e(t){var r,a;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,e.prev=1,e.next=4,r.fetch("messages.rejectMessageRequest",{peer_id:o,user_id:n,spam:i?1:0});case 4:return a=e.sent,e.abrupt("return",{type:"UserRejectedChatMessageRequest_RequestCompleted",hasFailed:1!==a,peerId:o,prevConvo:p});case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",{type:"UserRejectedChatMessageRequest_RequestCompleted",hasFailed:!0,peerId:o,prevConvo:p});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()];case"UserAcceptedChatMessageRequest_RequestCompleted":var m=t.peerId;return e.locks.changeMessageRequest.delete(m),[];case"UserRejectedChatMessageRequest_RequestCompleted":var g=t.prevConvo,b=t.hasFailed,C=t.peerId;return e.locks.changeMessageRequest.delete(C),b&&void 0!==g&&(e.convos.set(C,g),f.refresh(e.organisers,g)),[];case"UpdateMessageRequestsCounter":return[function(){var e=(0,u.default)(d().mark((function e(t){var r,n,a,s;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,e.prev=1,n=ce.IApi.resolveTrackId("account.getCounters","message_requests"),r.dangerouslyAbort(n),e.next=6,r.fetch("account.getCounters",{filter:"message_requests"},{trackId:n});case 6:return a=e.sent,s=a.message_requests,e.abrupt("return",{type:"UpdateMessageRequestsCounter_RequestCompleted",count:null!=s?s:0});case 11:return e.prev=11,e.t0=e.catch(1),e.abrupt("return",{type:"Noop"});case 14:case"end":return e.stop()}}),e,null,[[1,11]])})));return function(t){return e.apply(this,arguments)}}()];case"UpdateMessageRequestsCounter_RequestCompleted":return h.updateCounters(e.organisers.filters,{messageRequests:t.count}),[];default:(0,s.exhaustivenessCheck)(r)}}(c,t);break;case"UserChangedChatTitle":case"UserChangedChatTitle_RequestCompleted":case"UserRemovedChatPhoto":case"UserSetChatPhoto":case"UserRemovedChatPhoto_RequestCompleted":case"UserChangedChatSettings":case"UserChangedChatSettings_RequestCompleted":a=function(e,t){var r=t.type;switch(r){case"UserChangedChatTitle":var n=t.peerId,a=t.title,o=g.toRealId(n),i=e.peers.get(n),c=e.ownerId;if(!i||"Chat"!==i.kind)return[];var l=i.title;return g.updateChatInfo(i,{title:a}),[function(){var e=(0,u.default)(d().mark((function e(t){var r,s;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,e.prev=1,e.next=4,r.fetch("messages.editChat",{chat_id:o,title:a,group_id:(0,p.getOwnerGroupId)(c)},{retries:1});case 4:return s=e.sent,e.abrupt("return",{type:"UserChangedChatTitle_RequestCompleted",hasFailed:1!==s,peerId:n,title:1!==s?l:a});case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",{type:"UserChangedChatTitle_RequestCompleted",hasFailed:!0,peerId:n,title:l});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()];case"UserChangedChatTitle_RequestCompleted":var f=t.peerId,h=t.title,v=t.hasFailed,m=e.peers.get(f);return m&&"Chat"===m.kind&&v?(g.updateChatInfo(m,{title:h}),[]):[];case"UserSetChatPhoto":var b,C,_,k=t.peerId,w=t.photo,I=e.peers.get(k);return I&&"Chat"===I.kind?(g.updateChatInfo(I,{photo50:null===(b=R.preview(w,50,50))||void 0===b?void 0:b.url,photo100:null===(C=R.preview(w,100,100))||void 0===C?void 0:C.url,photo200:null===(_=R.preview(w,200,200))||void 0===_?void 0:_.url}),[]):[];case"UserRemovedChatPhoto":var S=t.peerId,O=e.ownerId,A=g.toRealId(S),x=e.peers.get(S);return x&&"Chat"===x.kind?(g.updateChatInfo(x,{photo50:void 0,photo100:void 0,photo200:void 0}),[function(){var e=(0,u.default)(d().mark((function e(t){var r,n;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,e.prev=1,e.next=4,r.fetch("messages.deleteChatPhoto",{chat_id:A,group_id:(0,p.getOwnerGroupId)(O)},{retries:1});case 4:return n=e.sent,e.abrupt("return",{type:"UserRemovedChatPhoto_RequestCompleted",hasFailed:1!==n,peerId:S});case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",{type:"UserRemovedChatPhoto_RequestCompleted",hasFailed:!0,peerId:S});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()]):[];case"UserRemovedChatPhoto_RequestCompleted":return[];case"UserChangedChatSettings":var E=t.peerId,U=t.isService,M=t.permissions,P=g.toRealId(E),j=e.ownerId;return[function(){var e=(0,u.default)(d().mark((function e(t){var r,n;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,e.prev=1,e.next=4,r.fetch("messages.editChat",{chat_id:P,is_service:U?1:0,permissions:JSON.stringify(M),group_id:(0,p.getOwnerGroupId)(j)},{retries:1});case 4:return n=e.sent,e.abrupt("return",{type:"UserChangedChatSettings_RequestCompleted",hasFailed:1!==n,permissions:M,peerId:E,isService:U});case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",{type:"UserChangedChatSettings_RequestCompleted",hasFailed:!0,permissions:M,peerId:E,isService:U});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()];case"UserChangedChatSettings_RequestCompleted":var F=t.peerId,q=t.isService,N=t.permissions;if(t.hasFailed)return[];var T=e.convos.get(F);return T&&"ChatConvo"===T.kind?(y.setChatPermissions(T,N,q),[]):[];default:(0,s.exhaustivenessCheck)(r)}}(c,t);break;case"UserOpenedConvoProfile":case"UserOpenedConvoProfile_ConvoRequestCompleted":case"UserOpenedConvoProfile_InviteLinksCompleted":a=qe(c,t,r);break;case"LoadImportantMessages":case"LoadImportantMessages_RequestCompleted":case"UserClosedImportantMessages":a=function(e,t,r){switch(t.type){case"LoadImportantMessages":var n=20*Math.floor(e.importantMessages.messages.size/20),a=e.ownerId;return[function(){var e=(0,u.default)(d().mark((function e(t){var r,s;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,e.prev=1,e.next=4,r.fetch("messages.getImportantMessages",{count:20,offset:n,group_id:(0,p.getOwnerGroupId)(a)});case 4:return s=e.sent,e.abrupt("return",{type:"LoadImportantMessages_RequestCompleted",hasFailed:!1,response:s});case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",{type:"Noop"});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()];case"LoadImportantMessages_RequestCompleted":var o,i,c=t.response,l=c.messages,f=c.profiles,h=c.groups,v=c.conversations;return((null===(o=l.items)||void 0===o?void 0:o.length)||0)<20&&(e.importantMessages.hasMore=!1),(0,p.insertConvos)(e,v||[],{dangerouslyMerge:!0}),(0,p.insertPeers)(e,{apiUsers:f||[],apiGroups:h||[],apiContacts:[]}),null===(i=l.items)||void 0===i||i.forEach((function(t){var r=(0,j.fromApiMessage)(t).message;"Normal"===r.kind&&e.importantMessages.messages.set(we(r.peerId,r.cmid),r)})),[];case"UserClosedImportantMessages":return e.importantMessages.messages.clear(),e.importantMessages.hasMore=!0,[];default:return(0,s.exhaustivenessCheck)(t)}}(c,t);break;case"UserCreatedFolder":case"UserCreatedFolder_CreateRequestCompleted":a=function(e,t,r){switch(t.type){case"UserCreatedFolder":var n=t.name,a=t.peerIds;return e.locks.newFolder?[]:(e.locks.newFolder=!0,[function(){var e=(0,u.default)(d().mark((function e(t){var r,s,o;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,e.prev=1,e.next=4,r.fetch("messages.createFolder",{name:n,included_peer_ids:a.join(",")});case 4:return s=e.sent,e.abrupt("return",{type:"UserCreatedFolder_CreateRequestCompleted",hasFailed:!1,peerIds:a,name:n,folderId:v.resolveId(s.folder_id)});case 8:return e.prev=8,e.t0=e.catch(1),e.t0 instanceof ce.IApi.RequestError&&(o=e.t0.code),e.abrupt("return",{type:"UserCreatedFolder_CreateRequestCompleted",hasFailed:!0,name:n,error:o});case 12:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()]);case"UserCreatedFolder_CreateRequestCompleted":var o=t.hasFailed;if(e.locks.newFolder=!1,o){if(t.error);else if(s.isDev)throw new Error("Не удалось создать папку");return[]}var i=(0,p.insertFolders)(e,[{id:t.folderId,name:t.name}]),c=(0,p.getConvosByIds)(e,t.peerIds);return(0,p.addConvosToFolder)(e,t.folderId,c),i[0]&&v.setHasMore(i[0],"all",!1),[];default:(0,s.exhaustivenessCheck)(t)}}(c,t);break;case"UserUpdatedFolder":case"UserUpdatedFolder_UpdateRequestCompleted":a=Ne(c,t);break;case"UserDeletedFolder":case"UserDeletedFolder_DeleteRequestCompleted":a=function(e,t,r){switch(t.type){case"UserDeletedFolder":var n=t.folderId;if(e.locks.deleteFolder.has(n))return[];e.locks.deleteFolder.add(n),v.deleteFolder(e.organisers.folders,n);var a,o=De(e.convos.values());try{for(o.s();!(a=o.n()).done;){var i=a.value;y.removeFolder(i,n)}}catch(e){o.e(e)}finally{o.f()}return[function(){var e=(0,u.default)(d().mark((function e(t){var r,a;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,e.prev=1,e.next=4,r.fetch("messages.deleteFolder",{folder_id:n});case 4:return a=e.sent,e.abrupt("return",{type:"UserDeletedFolder_DeleteRequestCompleted",hasFailed:1!==a,folderId:n});case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",{type:"UserDeletedFolder_DeleteRequestCompleted",hasFailed:!0,folderId:n});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()];case"UserDeletedFolder_DeleteRequestCompleted":var c=t.hasFailed,l=t.folderId;if(e.locks.deleteFolder.delete(l),c&&s.isDev)throw new Error("Не удалось удалить папку");return[];default:(0,s.exhaustivenessCheck)(t)}}(c,t);break;case"UserReorderedFolders":case"UserReorderedFolders_ReorderRequestCompleted":a=function(e,t,r){switch(t.type){case"UserReorderedFolders":var n=t.order;return e.locks.reorderFolders?[]:(e.locks.reorderFolders=!0,v.reorderFolders(e.organisers.folders,n),[function(){var e=(0,u.default)(d().mark((function e(t){var r,a,s;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,e.prev=1,e.next=4,r.fetch("messages.reorderFolders",{folder_ids:n.join(",")});case 4:return a=e.sent,e.abrupt("return",{type:"UserReorderedFolders_ReorderRequestCompleted",hasFailed:1!==a,order:n});case 8:return e.prev=8,e.t0=e.catch(1),e.t0 instanceof ce.IApi.RequestError&&(s=e.t0.code),e.abrupt("return",{type:"UserReorderedFolders_ReorderRequestCompleted",hasFailed:!0,error:s,order:n});case 12:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()]);case"UserReorderedFolders_ReorderRequestCompleted":var a=t.hasFailed;if(e.locks.reorderFolders=!1,a){if(t.error);else if(s.isDev)throw new Error("Не удалось изменить порядок папок");return[]}return[];default:(0,s.exhaustivenessCheck)(t)}}(c,t);break;case"StickersAddToFavorite":case"StickersAddToFavorite__RequestCompleted":case"StickersRemoveFromFavorite":case"StickersRemoveFromFavorite__RequestCompleted":case"StickerAddToRecent":a=A(c,t,r);break;case"UserScrolledChannelHistory":case"UserScrolledChannelHistory_RequestSucceed":case"UserScrolledChannelHistory_RequestFailed":a=function(e,t){switch(t.type){case"UserScrolledChannelHistory":var r=t.channelId,n=t.direction,a=t.startCmid,o=t.possibleSkipped,i=e.channels.get(r);if(!i)return[];if(e.locks.getChannelHistory.has(r))return[];e.locks.getChannelHistory.add(r);var c,l=Math.min(S.POSTS_PER_PAGE,o||S.POSTS_PER_PAGE)+2;switch(n){case"backward":c=0;break;case"forward":c=1-l;break;case"around":l=S.POSTS_PER_PAGE,c=-Math.floor(l/2),i.inReadCmid===a&&(c=Math.max(-i.unreadCount,c));break;default:(0,s.exhaustivenessCheck)(n)}return[function(){var e=(0,u.default)(d().mark((function e(t){var o,i,u;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.api,e.prev=1,e.next=4,o.fetch("channels.getHistory",{channel_id:r,start_cmid:Math.max(a,1),count:l,offset:c},{retries:5});case 4:i=e.sent,e.t0=n,e.next="backward"===e.t0||"around"===e.t0?8:"forward"===e.t0?10:12;break;case 8:return u=l===i.items.length,e.abrupt("break",13);case 10:return u=!0,e.abrupt("break",13);case 12:(0,s.exhaustivenessCheck)(n);case 13:return e.abrupt("return",{type:"UserScrolledChannelHistory_RequestSucceed",channelId:r,response:i,hasMore:u});case 16:return e.prev=16,e.t1=e.catch(1),e.abrupt("return",{type:"UserScrolledChannelHistory_RequestFailed",channelId:r});case 19:case"end":return e.stop()}}),e,null,[[1,16]])})));return function(t){return e.apply(this,arguments)}}()];case"UserScrolledChannelHistory_RequestSucceed":var f=t.channelId,h=t.response,v=t.hasMore;e.locks.getChannelHistory.delete(f);var m=e.channels.get(f);if(!m)return[];var y=[];return h.items.reverse().forEach((function(t,r,n){var a=(0,re.fromApiPost)(t),s=a.post;a.reactions.forEach((function(t){e.reactions.set(t.id,t)})),0===r&&s.cmid>1&&v&&y.push({kind:"GapItem",fromCmid:k.resolveCmid(1),toCmid:k.resolveCmid(s.cmid-1)}),y.push({kind:"PostItem",post:s});var o=m.history[m.history.length-1];if(r===n.length-1&&o){var i="GapItem"===o.kind?o.toCmid:o.post.cmid;s.cmid<i&&y.push({kind:"GapItem",fromCmid:k.resolveCmid(s.cmid+1),toCmid:k.resolveCmid(i-("GapItem"===o.kind?0:1))})}})),_.insertPosts(m,y),(0,p.insertPeers)(e,{apiUsers:h.profiles||[],apiGroups:h.groups||[],apiContacts:[]}),[];case"UserScrolledChannelHistory_RequestFailed":var g=t.channelId;return e.locks.getChannelHistory.delete(g),[];default:return(0,s.exhaustivenessCheck)(t)}}(c,t);break;case"UserOpenedChannel":case"UserClosedChannel":case"UserOpenedChannel_ChannelRequestCompleted":a=function(e,t,r){switch(t.type){case"UserOpenedChannel":var n=t.channelId,a=e.locks.channelsCleanup.get(n)||0;return e.locks.channelsCleanup.set(n,a+1),e.channels.get(n)?[]:[function(){var e=(0,u.default)(d().mark((function e(t){var r,a;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,e.prev=1,e.next=4,r.fetch("channels.getById",{channel_ids:n.toString()},{retries:2});case 4:return a=e.sent,e.abrupt("return",{type:"UserOpenedChannel_ChannelRequestCompleted",channelId:n,response:a,hasFailed:!1});case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",{type:"UserOpenedChannel_ChannelRequestCompleted",channelId:n,hasFailed:!0,errCode:e.t0 instanceof ce.IApi.RequestError?e.t0.code:void 0});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()];case"UserOpenedChannel_ChannelRequestCompleted":var o=t.hasFailed,i=t.channelId,c=t.response,l=t.errCode;if(o&&l===Be.API_ERROR_ACCESS)return[function(){var e=(0,u.default)(d().mark((function e(t){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.router.replace({kind:"ChannelRoute",channelId:i,accessDenied:!0}),e.abrupt("return",{type:"Noop"});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()];if(!c)return[];(0,p.insertChannels)(e,{apiChannels:c.items||[],apiGroups:c.groups||[]});var h=e.channels.get(i);if(!h){if(s.isDev)throw new Error("Диалог не был найден");return[function(){var e=(0,u.default)(d().mark((function e(t){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.router.replace({kind:"ChannelsListRoute"}),e.abrupt("return",{type:"Noop"});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()]}return h.isMember&&f.refreshChannels(e.organisers,h),[];case"UserClosedChannel":var v=t.channelId,m=e.locks.channelsCleanup.get(v);if(m&&m>1)return e.locks.channelsCleanup.set(v,m-1),[];var y=e.channels.get(v);return y?(_.cleanup(y),[]):[];default:return(0,s.exhaustivenessCheck)(t)}}(c,t);break;case"UserChangedChatMember":case"UserChangedChatMember_RequestCompleted":a=He(c,t);break;case"UserRequestChatInvitationLink":case"UserRequestChatInvitationLink_RequestCompleted":case"UserResetChatInvitationLink":case"UserResetChatInvitationLink_RequestCompleted":a=function(e,t){switch(t.type){case"UserRequestChatInvitationLink":var r=t.peerId,n=t.isLinkWithHistory,a=e.ownerId;return[function(){var e=(0,u.default)(d().mark((function e(t){var s,o;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.api,e.prev=1,e.next=4,s.fetch("messages.getInviteLink",{peer_id:r,reset:0,visible_messages_count:n?250:0,group_id:(0,p.getOwnerGroupId)(a)},{retries:1});case 4:return o=e.sent,e.abrupt("return",{type:"UserRequestChatInvitationLink_RequestCompleted",hasFailed:!o.link,link:o.link,isLinkWithHistory:n,peerId:r});case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",{type:"UserRequestChatInvitationLink_RequestCompleted",hasFailed:!0,isLinkWithHistory:n,peerId:r});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()];case"UserRequestChatInvitationLink_RequestCompleted":var o=t.peerId,i=t.link,c=t.isLinkWithHistory,l=t.hasFailed,f=e.convos.get(o);return!l&&f&&"ChatConvo"===f.kind&&i?(y.replaceInviteLinks(f,Pe(Pe({},f.inviteLinks),c?{withHistory:i}:{noHistory:i})),[]):[];case"UserResetChatInvitationLink":var h=t.peerId,v=e.ownerId;return[function(){var e=(0,u.default)(d().mark((function e(t){var r,n,a;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,e.prev=1,e.next=4,r.fetch("messages.getInviteLink",{peer_id:h,reset:1,visible_messages_count:250,group_id:(0,p.getOwnerGroupId)(v)},{retries:1});case 4:return n=e.sent,e.next=7,r.fetch("messages.getInviteLink",{peer_id:h,reset:1,visible_messages_count:0,group_id:(0,p.getOwnerGroupId)(v)},{retries:1});case 7:return a=e.sent,e.abrupt("return",{type:"UserResetChatInvitationLink_RequestCompleted",hasFailed:!n.link||!a.link,links:{withHistory:n.link,noHistory:a.link},peerId:h});case 11:return e.prev=11,e.t0=e.catch(1),e.abrupt("return",{type:"UserResetChatInvitationLink_RequestCompleted",hasFailed:!0,peerId:h,links:{}});case 14:case"end":return e.stop()}}),e,null,[[1,11]])})));return function(t){return e.apply(this,arguments)}}()];case"UserResetChatInvitationLink_RequestCompleted":var m=t.peerId,g=t.links,b=t.hasFailed,C=e.convos.get(m);return b||"ChatConvo"!==(null==C?void 0:C.kind)?[]:g.noHistory&&g.withHistory?(y.replaceInviteLinks(C,g),[]):[];default:return(0,s.exhaustivenessCheck)(t)}}(c,t);break;case"LoadChatMembers":case"LoadChatMembers_RequestComplete":a=Ge(c,t);break;case"UserChangedChannel":case"UserChangedChannel_RequestCompleted":a=Ve(c,t,r);break;case"UserSeenPost":case"UserSeenPost_ThrottleTimedOut":case"UserSeenPost_RequestCompleted":a=function(e,t,r){switch(t.type){case"UserSeenPost":var n=t.cmid,a=t.channelId,o=e.channels.get(a);if(!o)return[];if(n<=o.inReadCmid)return[];_.readUntil(o,n),f.refreshChannels(e.organisers,o);var i=e.channelReadQueues.has(a);return e.channelReadQueues.set(a,o.inReadCmid),i?[]:[$e(a)];case"UserSeenPost_ThrottleTimedOut":var c=t.channelId,l=e.channelReadQueues.get(c);return l?[function(){var e=(0,u.default)(d().mark((function e(t){var r;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,e.prev=1,e.next=4,r.fetch("channels.markAsRead",{channel_id:c,last_read_cmid:l});case 4:e.next=8;break;case 6:e.prev=6,e.t0=e.catch(1);case 8:return e.abrupt("return",{type:"UserSeenPost_RequestCompleted",channelId:c,readUntilCmid:l});case 9:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(t){return e.apply(this,arguments)}}()]:[];case"UserSeenPost_RequestCompleted":var p=t.channelId,h=t.readUntilCmid,v=e.channelReadQueues.get(p);return v?h>=v?(e.channelReadQueues.delete(p),[]):[$e(p)]:[];default:return(0,s.exhaustivenessCheck)(t)}}(c,t);break;case"LoadImportantUsers":case"LoadImportantUsers_RequestCompleted":a=Qe.handler(c,t,r);break;case"UserLoadedCommentsHistory":case"UserLoadedCommentsHistory_RequestSucceed":case"UserLoadedCommentsHistory_RequestFailed":a=Je.handler(c,t,r);break;case"ChannelsOnboardingDone":case"ChannelsOnboardingDone_RequestSucceeded":case"ChannelsOnboardingDone_RequestFailed":a=function(e,t){switch(t.type){case"ChannelsOnboardingDone":return 0===t.pickedChannelsIds.length?(m.push(e.organisers.channelFilters,"all",[],!1),[function(){var e=(0,u.default)(d().mark((function e(t){var r;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,e.next=3,r.fetch("account.hideHelpHint",{hint_id:"im:channels_onboarding"},{retries:1/0});case 3:return e.abrupt("return",{type:"Noop"});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()]):[function(){var e=(0,u.default)(d().mark((function e(r){var n,a;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.api,e.prev=1,e.next=4,n.fetch("channels.unarchive",{channel_ids:t.pickedChannelsIds.join(",")||""});case 4:return a=e.sent,e.abrupt("return",{type:"ChannelsOnboardingDone_RequestSucceeded",responseChannels:a});case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",{type:"ChannelsOnboardingDone_RequestFailed"});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()];case"ChannelsOnboardingDone_RequestSucceeded":var r=(0,p.insertChannels)(e,{apiChannels:t.responseChannels.succeeded,apiGroups:t.responseChannels.groups});return m.push(e.organisers.channelFilters,"all",r,!1),[function(){var e=(0,u.default)(d().mark((function e(t){var r;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,e.next=3,r.fetch("account.hideHelpHint",{hint_id:"im:channels_onboarding"},{retries:1/0});case 3:return e.abrupt("return",{type:"Noop"});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()];case"ChannelsOnboardingDone_RequestFailed":return[];default:(0,s.exhaustivenessCheck)(t)}}(c,t);break;case"UserChangedComposerDraft":case"UserClearedComposerDraft":case"UpdateComposerDraftOnMessageDelete":a=function(e,t){var r,n=t.peerId,a=null!==(r=e.composerDrafts[n])&&void 0!==r?r:C.DEFAULT_DRAFT,o=C.DEFAULT_DRAFT;switch(t.type){case"UserChangedComposerDraft":switch(t.kind){case"default":var i=t.attaches,c=t.text;o=Ye(Ye({},a),{},{text:null!=c?c:a.text,attaches:i||a.attaches});break;case"editing":var p=t.editing;o={editing:p,text:b.toPlainText(p,{multiline:!0}),attaches:p.attaches,forward:p.forwardedMessages&&{kind:"message",items:p.forwardedMessages},reply:p.replyMessage};break;case"forward":var f=t.forward;o=Ye(Ye({},f&&a.editing?C.DEFAULT_DRAFT:a),{},{reply:void 0,forward:f});break;case"reply":var h=t.reply;o=Ye(Ye({},h&&a.editing?C.DEFAULT_DRAFT:a),{},{forward:void 0,reply:h});break;default:(0,s.exhaustivenessCheck)(t)}break;case"UserClearedComposerDraft":break;case"UpdateComposerDraftOnMessageDelete":var v=a.editing;void 0===v||t.deletedMessagesCmid.includes(v.cmid)||(o=a);break;default:(0,s.exhaustivenessCheck)(t)}o.text||o.forward||o.reply||o.editing||0!==Object.keys(o.attaches).length?e.composerDrafts[n]=o:delete e.composerDrafts[n];var m=(0,l.current)(e).composerDrafts;return[function(){var e=(0,u.default)(d().mark((function e(t){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.storage.set("drafts",m),e.abrupt("return",{type:"Noop"});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()]}(c,t);break;case"ResetUpdatesCounter":case"ResetUpdatesCounter_RequestCompleted":a=function(e,t){switch(t.type){case"ResetUpdatesCounter":var r=e.ownerId;return[function(){var e=(0,u.default)(d().mark((function e(t){var n,a;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.api,e.prev=1,e.next=4,n.fetch("messages.resetUpdatesCounter",{group_id:(0,p.getOwnerGroupId)(r)});case 4:return a=e.sent,e.abrupt("return",{type:"ResetUpdatesCounter_RequestCompleted",hasFailed:!a});case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",{type:"ResetUpdatesCounter_RequestCompleted",hasFailed:!0});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()];case"ResetUpdatesCounter_RequestCompleted":return t.hasFailed?[]:(h.updateCounters(e.organisers.filters,{headerNotMutedUnread:0}),[function(){var e=(0,u.default)(d().mark((function e(t){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.notification.setCounters({unreadIdle:0}),e.abrupt("return",{type:"Noop"});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()]);default:(0,s.exhaustivenessCheck)(t)}}(c,t);break;case"UserProfileInfo_Update":a=function(e,t){if("UserProfileInfo_Update"===t.type){var r=t.user,n=t.profileInfo;return n&&(e.viewer.profileInfo=n),r&&e.peers.set(r.id,r),[]}(0,s.exhaustivenessCheck)(t.type)}(c,t);break;case"UserChangedMessageAttachment":case"UserChangedMessageAttachment_RequestCompleted":a=function(e,t){switch(t.type){case"UserChangedMessageAttachment":return[function(){var e=(0,u.default)(d().mark((function e(r){var n,a,s;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.api,e.prev=1,e.next=4,n.fetch("messages.getByConversationMessageId",{peer_id:t.peerId,conversation_message_ids:t.cmid.toString(),group_id:t.groupId||0},{retries:3});case 4:if(a=e.sent,s=a.items[0]){e.next=8;break}return e.abrupt("return",{type:"UserChangedMessageAttachment_RequestCompleted",hasFailed:!0});case 8:return e.abrupt("return",{type:"UserChangedMessageAttachment_RequestCompleted",hasFailed:!1,peerId:t.peerId,apiMessage:s});case 11:return e.prev=11,e.t0=e.catch(1),e.abrupt("return",{type:"UserChangedMessageAttachment_RequestCompleted",hasFailed:!0});case 14:case"end":return e.stop()}}),e,null,[[1,11]])})));return function(t){return e.apply(this,arguments)}}()];case"UserChangedMessageAttachment_RequestCompleted":if(t.hasFailed)return[];var r=(0,j.fromApiMessage)(t.apiMessage),n=r.message,a=r.mentions,o=e.convos.get(t.peerId);return o?(y.replaceMessage(o,n,a.hasDirect||a.hasMass),[]):[];default:(0,s.exhaustivenessCheck)(t)}}(c,t);break;case"UserDeleteComment":case"UserDeleteComment_RequestCompleted":case"UserRestoreComment":case"UserRestoreComment_RequestCompleted":a=ct(c,t,r);break;case"UserLoadedLikes":case"UserLoadedLikes_RequestCompleted":case"UserChangedLike":case"UserChangedLike_RequestCompleted":a=at(c,t,r);break;case"UserChangedBrowserNotifications":case"UserChangedBrowserNotifications_RequestCompleted":a=function(e,t){var r=t.type;switch(r){case"UserChangedBrowserNotifications":e.locks.settings.add("browserNotifications");var n=e.viewer.settings.browserNotifications;return e.viewer.settings.browserNotifications=t.value,[function(){var e=(0,u.default)(d().mark((function e(r){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r.storage.set("settings-browser-notifications-on",t.value),e.abrupt("return",{type:"UserChangedBrowserNotifications_RequestCompleted",hasFailed:!1,previousValue:n});case 5:return e.prev=5,e.t0=e.catch(0),e.abrupt("return",{type:"UserChangedBrowserNotifications_RequestCompleted",hasFailed:!0,previousValue:n});case 8:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(t){return e.apply(this,arguments)}}()];case"UserChangedBrowserNotifications_RequestCompleted":return e.locks.settings.delete("browserNotifications"),t.hasFailed&&(e.viewer.settings.browserNotifications=t.previousValue),[];default:(0,s.exhaustivenessCheck)(r)}}(c,t);break;default:(0,s.exhaustivenessCheck)(t)}c.convos.set(g.resolveId(),y.safeGet(e.convos,g.resolveId())),c.peers.set(g.resolveId(),g.safeGet(e.peers,g.resolveId())),c.channels.set(_.resolveId(0),_.safeGet(e.channels,_.resolveId(0)));var w=(0,l.finishDraft)(c);if(e.hiddenPinnedMessages!==w.hiddenPinnedMessages&&a.push(function(){var e=(0,u.default)(d().mark((function e(t){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.storage.set("hidden-pinned-messages",Array.from(w.hiddenPinnedMessages.entries()).reduce((function(e,t){var r=(0,n.default)(t,2),a=r[0],s=r[1];return e[a]=s,e}),{})),e.abrupt("return",{type:"Noop"});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.hiddenBotKeyboards!==w.hiddenBotKeyboards&&a.push(function(){var e=(0,u.default)(d().mark((function e(t){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.storage.set("hidden-bot-keyboards",w.hiddenBotKeyboards),e.abrupt("return",{type:"Noop"});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),w.organisers.filters.archive.isHidden&&"Noop"!==t.type&&"UserUndoHideFilter"!==t.type&&"visible"===document.visibilityState){var O={};w.convos.forEach((function(e){"ChatConvo"===e.kind&&e.unreadMentions.size>0&&(O[e.peerId]=b.resolveCmid(Math.max.apply(Math,(0,i.default)(e.unreadMentions))))})),a.push(function(){var e=(0,u.default)(d().mark((function e(t){var r,n;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.storage,Object.keys(O).length){e.next=3;break}return e.abrupt("return",{type:"Noop"});case 3:if(n=r.get("archive-mentions-map")||{},!Object.keys(O).every((function(e){return O[g.resolveId(Number(e))]===n[g.resolveId(Number(e))]}))){e.next=6;break}return e.abrupt("return",{type:"Noop"});case 6:return r.set("archive-mentions-map",pt(pt({},n),O)),e.abrupt("return",{type:"UserUndoHideFilter",kind:"archive"});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}if(w.organisers.filters.businessNotify.isHidden&&"Noop"!==t.type&&"UserUndoHideFilter"!==t.type&&"visible"===document.visibilityState){var x=w.organisers.filters.businessNotify.unreadCount;a.push((0,u.default)(d().mark((function e(){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==x){e.next=2;break}return e.abrupt("return",{type:"Noop"});case 2:return e.abrupt("return",{type:"UserUndoHideFilter",kind:"businessNotify"});case 3:case"end":return e.stop()}}),e)}))))}return[w,a]}var vt=function(e,t,r){switch(t.type){case"InitialData":var a=t.ownerId,s=a?(0,p.getOwnerGroupId)(a):0,o=e.viewer.id;return 0===o?[]:[function(){var e=(0,u.default)(d().mark((function e(t){var r,n,a;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=t.storage).identify(o),a=null!==(r=n.get("theme"))&&void 0!==r?r:"system",e.abrupt("return",{type:"SettingThemeUpdated",value:a});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),function(){var e=(0,u.default)(d().mark((function e(t){var a,i,u,c,l,p,f,h,v,m,y,g,b,_,k,w,I,O,R,A,x,E,U,M,P,j,F,q,N,T;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return h=t.engine,v=t.channelEngine,m=t.api,y=t.storage,g=t.player,e.next=3,m.fetch("messages.getLongPollServer",{need_pts:1,lp_version:h.version,group_id:s},{retries:1/0});case 3:if((b=e.sent).pts){e.next=6;break}throw new Error("Отсутствует pts");case 6:if(h.connect(pt(pt({},b),{},{pts:b.pts})),!v||!r.me_channels){e.next=12;break}return e.next=10,m.fetch("channels.getLongPollServer",{},{retries:1/0});case 10:_=e.sent,v.connect(_);case 12:return e.next=14,m.fetchMany([{method:"messages.getConversations",params:{count:S.CONVOS_PER_PAGE,group_id:s}},{method:"messages.getConversationsById",params:{peer_ids:o.toString(),group_id:s}},{method:"messages.getFolders",params:{}},{method:"users.get",params:{}},0!==s&&{method:"groups.getById",params:{group_ids:String(s)}},{method:"account.getCounters",params:{filter:"all"}},{method:"account.getInfo",params:{fields:["messages_recommendation_list_hidden","show_only_not_muted_messages","messages_multiline_input","messages_auto_unarchive","messages_transcript_auto_show"].join(",")}},{method:"account.getHelpHints",params:{}},{method:"account.getMulti",params:{fields:"profile_type,photo_100"}},v&&r.me_channels&&{method:"channels.get",params:{count:S.CHANNELS_PER_PAGE,filter:"all"}},{method:"account.getProfileInfo",params:{}}],{retries:1/0});case 14:if(k=e.sent,w=(0,n.default)(k,11),I=w[0],O=w[1],R=w[2],A=w[3],x=w[4],E=w[5],U=w[6],M=w[7],P=w[8],j=w[9],F=w[10],q=null==x||null===(a=x.groups)||void 0===a?void 0:a[0],N=A[0]){e.next=31;break}throw new Error("Не удалось получить текущего пользователя");case 31:return y.identify(o),g.init(o),T={type:"InitialData_RequestCompleted",responseViewer:N,responseMultiAccount:P,responseGroup:q,responseConvos:I,responseProfileInfo:F,responseViewerConvo:O,hasMoreConvos:I.items.length>=S.CONVOS_PER_PAGE,folders:R,responseChannels:j,hasMoreChannels:((null==j||null===(i=j.items)||void 0===i?void 0:i.length)||0)>=S.CHANNELS_PER_PAGE,unreadCount:{messages:E.messages||0,messagesUnmuted:E.messages_unread_unmuted||0,archive:E.messages_archive_unread||0,archiveMentions:E.messages_archive_mentions_count||0,archiveTotal:E.messages_archive||0,messageRequest:E.message_requests||0,businessNotify:E.business_notify||0,businessNotifyTotal:E.business_notify_all||0,channelsTotal:(null===(u=E.channels)||void 0===u?void 0:u.total_count)||0,folders:E.messages_folders||[]},convoLp:{pts:b.pts},channelLp:_&&{ts:_.ts},hiddenPinnedMessages:y.get("hidden-pinned-messages"),hiddenBotKeyboards:y.get("hidden-bot-keyboards"),archiveManuallyHidden:!!y.get("archive-manually-hidden"),composerDrafts:C.deleteDraftsWithKind(y.get("drafts")||{}),businessNotifyManuallyHidden:!!y.get("business-notify-manually-hidden"),userSettings:{ctrSubmit:Boolean(U.messages_multiline_input),soundNotifications:null===(c=y.get("settings-sound-notifications-on"))||void 0===c||c,browserNotifications:null!==(l=y.get("settings-browser-notifications-on"))&&void 0!==l&&l,showRecommendations:!Boolean(U.messages_recommendation_list_hidden),countOnlyNotMuted:Boolean(U.show_only_not_muted_messages),autoUnarchive:Boolean(U.messages_auto_unarchive),transcriptAutoShow:Boolean(U.messages_transcript_auto_show),theme:null!==(p=y.get("theme"))&&void 0!==p?p:"system",verticalFoldersView:null!==(f=y.get("folders-view-vertical"))&&void 0!==f&&f},helpHints:mt(M)},e.abrupt("return",T);case 35:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()];case"InitialData_RequestCompleted":var c,l,f;e.convoConn={status:"running",pts:t.convoLp.pts},t.channelLp&&(e.channelConn={status:"running",ts:t.channelLp.ts}),e.hiddenPinnedMessages=new Map(Object.entries(t.hiddenPinnedMessages||{}).map((function(e){var t=(0,n.default)(e,2),r=t[0],a=t[1];return[g.resolveId(parseInt(r)),b.resolveCmid(a)]}))),e.hiddenBotKeyboards=t.hiddenBotKeyboards||new Set,e.composerDrafts=t.composerDrafts;var y=(0,p.insertConvos)(e,t.responseConvos.items);if((0,p.insertConvos)(e,t.responseViewerConvo.items),e.organisers.filters.archive.isHidden=!!t.archiveManuallyHidden,e.organisers.filters.businessNotify.isHidden=!!t.businessNotifyManuallyHidden,h.push(e.organisers.filters,"all",y,t.hasMoreConvos),0===t.unreadCount.archiveTotal&&h.push(e.organisers.filters,"archive",[],!1),0===t.unreadCount.messageRequest&&h.push(e.organisers.filters,"messageRequest",[],!1),h.updateCounters(e.organisers.filters,{unread:t.unreadCount.messages,unreadUnmuted:t.unreadCount.messagesUnmuted,headerNotMutedUnread:0,archive:t.unreadCount.archive,archiveMentions:t.unreadCount.archiveMentions,archiveTotal:t.unreadCount.archiveTotal,messageRequests:t.unreadCount.messageRequest,businessNotify:t.unreadCount.businessNotify,businessNotifyTotal:t.unreadCount.businessNotifyTotal}),(0,p.insertFolders)(e,t.folders.items),null===(c=t.unreadCount.folders)||void 0===c||c.forEach((function(t){v.setUnreadCounters(e.organisers.folders,v.resolveId(t.folder_id),t.total_count,t.unmuted_count)})),t.responseChannels){var _=(0,p.insertChannels)(e,{apiChannels:t.responseChannels.items||[],apiGroups:t.responseChannels.groups||[]});m.push(e.organisers.channelFilters,"all",_,t.hasMoreChannels),m.updateCounters(e.organisers.channelFilters,{unread:t.unreadCount.channelsTotal,archiveTotal:0})}(0,p.insertPeers)(e,{apiUsers:[].concat((0,i.default)(t.responseConvos.profiles||[]),(0,i.default)((null===(l=t.responseChannels)||void 0===l?void 0:l.profiles)||[])),apiGroups:[].concat((0,i.default)(t.responseConvos.groups||[]),(0,i.default)((null===(f=t.responseChannels)||void 0===f?void 0:f.groups)||[])),apiContacts:(0,i.default)(t.responseConvos.contacts||[])}),e.viewer.profileInfo=(0,O.fromApiViewerProfileInfo)(t.responseProfileInfo);var k=(0,I.fromApiUser)(t.responseViewer).user;e.peers.set(k.id,k),e.viewer.id=k.id,e.viewer.accounts=t.responseMultiAccount.items.map(O.fromApiViewerAccount);var w=t.responseGroup?(0,I.fromApiGroup)(t.responseGroup):void 0;return w&&e.peers.set(w.id,w),e.ownerId=w?w.id:k.id,t.userSettings&&(e.viewer.settings=t.userSettings),e.helpHints=t.helpHints,e.convoConn.status="running",[function(){var e=(0,u.default)(d().mark((function e(t){var r;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.engine,e.next=3,r.poll();case 3:return e.t0=e.sent,e.t1={kind:"FromEngine",next:e.t0},e.abrupt("return",{type:"EngineBatchReceived",variant:e.t1});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),function(){var e=(0,u.default)(d().mark((function e(t){var n;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=t.channelEngine)&&r.me_channels){e.next=3;break}return e.abrupt("return",{type:"Noop"});case 3:return e.next=5,n.poll();case 5:return e.t0=e.sent,e.t1={kind:"FromChannelEngine",next:e.t0},e.abrupt("return",{type:"ChannelEngineBatchReceived",variant:e.t1});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),function(){var e=(0,u.default)(d().mark((function e(t){var r,n,a;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,n=t.queue,e.next=3,r.fetch("queue.subscribe",{queue_ids:"onlfriends_".concat(k.id)},{retries:1/0});case 3:return a=e.sent,n.connect(pt({user_id:k.id},a)),e.next=7,n.poll();case 7:return e.t0=e.sent,e.abrupt("return",{type:"QueueBatchReceived",next:e.t0});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),function(){var e=(0,u.default)(d().mark((function e(){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{type:"LoadImportantUsers"});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()];default:return[]}};function mt(e){if(0===e.count)return null;var t=e.items.reduce((function(e,t){var r=t.id;switch(r){case"im:transcript_autoshow_setting":e["im:transcript_autoshow_setting"]={id:r};break;case"im:channels_onboarding":e["im:channels_onboarding"]={id:r};break;default:}return e}),{});return 0===Object.keys(t).length?null:t}function yt(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return gt(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return gt(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,i=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){i=!0,s=e},f:function(){try{o||null==r.return||r.return()}finally{if(i)throw s}}}}function gt(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function bt(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ft,o=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,u=arguments.length>5?arguments[5]:void 0,c=!1,d=s.isDev&&a(),l=[],p=r(o,i,u),f=(0,n.default)(p,2),h=f[0],v=f[1];d&&d.init(h);var m=function(e){return l.push(e),function(){l=l.filter((function(t){return t!==e}))}},y=function r(a){if(!c)throw new Error("Стор еще не был активирован. Нужно вызвать store.start().");var s=ht(h,a,t),o=(0,n.default)(s,2),i=o[0],u=o[1];d&&d.send(a,i);var p=h!==i;if(h=i,Ct(r,u,e),p){var f,v=yt(l);try{for(v.s();!(f=v.n()).done;){(0,f.value)(i)}}catch(e){v.e(e)}finally{v.f()}}};return{start:function(){c||(c=!0,Ct(y,v,e))},dispatch:y,subscribe:m,featureFlags:t,getState:function(){return h}}}function Ct(e,t,r){0!==t.length&&setTimeout((function(){var n,a=yt(t);try{for(a.s();!(n=a.n()).done;){var s=n.value;"function"==typeof s&&s(r).then(e).catch((function(e){r.logger.error("Необработанная ошибка редьюсера",e)}))}}catch(e){a.e(e)}finally{a.f()}}))}},7388:(e,t,r)=>{"use strict";r.d(t,{initConfig:()=>a});var n=r(10746);function a(){(0,n.enableMapSet)(),(0,n.setAutoFreeze)(!1);var e=r(90330),t=r(59005);e.shim(),t.shim()}},79324:(e,t,r)=>{"use strict";function n(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}r.d(t,{default:()=>n})},81944:(e,t,r)=>{"use strict";function n(e){return n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},n(e)}r.d(t,{default:()=>n})},92993:(e,t,r)=>{"use strict";r.d(t,{default:()=>a});var n=r(97433);function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&(0,n.default)(e,t)}},4604:(e,t,r)=>{"use strict";r.d(t,{default:()=>s});var n=r(31989),a=r(79324);function s(e,t){if(t&&("object"===(0,n.default)(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return(0,a.default)(e)}},97433:(e,t,r)=>{"use strict";function n(e,t){return n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(e,t)}r.d(t,{default:()=>n})},6978:(e,t,r)=>{"use strict";r.d(t,{API_ERROR_UNKNOWN:()=>n,API_ERROR_AUTH:()=>a,API_ERROR_CAPTCHA:()=>s,API_ERROR_ACCESS:()=>o,API_ERROR_AUTH_VALIDATION:()=>i,API_ERROR_PARAM:()=>u,API_ERROR_LIMITS:()=>c,API_ERROR_MESSAGES_CHAT_USER_NO_ACCESS:()=>d,API_ERROR_MESSAGES_CHAT_NOT_ADMIN:()=>l,API_ERROR_MESSAGES_GROUP_PEER_ACCESS:()=>p,API_ERROR_MESSAGES_CONTACT_NOT_FOUND:()=>f,API_ERROR_MESSAGES_MESSAGE_REQUEST_ALREADY_SENT:()=>h,API_ERROR_MESSAGES_CHAT_DISABLED:()=>v,API_ERROR_MESSAGES_CHAT_UNSUPPORTED:()=>m,API_ERROR_MESSAGES_MEMBER_ACCESS_TO_GROUP_DENIED:()=>y,API_ERROR_MESSAGES_CHAT_MEMBER_NOT_STAFF:()=>g});const n=1,a=5,s=14,o=15,i=17,u=100,c=103,d=917,l=925,p=932,f=936,h=939,v=945,m=946,y=947,g=967},87496:(e,t,r)=>{"use strict";var n=r(4840),a=r(60561),s=r(86378),o=r(21924)("String.prototype.slice");e.exports=function(e){var t,r=s(this),i=a(r),u=n(i.length);arguments.length>1&&(t=arguments[1]);var c=void 0===t?"":a(t);""===c&&(c=" ");var d=n(e);if(d<=u)return i;for(var l=d-u;c.length<l;){var p=c.length,f=l-p;c+=p>f?o(c,0,f):c}var h=c.length>l?o(c,0,l):c;return h+i}},59005:(e,t,r)=>{"use strict";var n=r(4289),a=r(86378),s=r(55559),o=r(87496),i=r(33842),u=r(14563),c=s.apply(i()),d=function(e,t){a(e);var r=arguments.length>2?[t,arguments[2]]:[t];return c(e,r)};n(d,{getPolyfill:i,implementation:o,shim:u}),e.exports=d},33842:(e,t,r)=>{"use strict";var n=r(87496);e.exports=function(){return"function"==typeof String.prototype.padStart?String.prototype.padStart:n}},14563:(e,t,r)=>{"use strict";var n=r(33842),a=r(4289);e.exports=function(){var e=n();return a(String.prototype,{padStart:e},{padStart:function(){return String.prototype.padStart!==e}}),e}},72006:()=>{}}]);try{stManager.done("dist/3bad6e117063d3681bf4f60574b483cc.d587703ca810e3d205e2.js")}catch(e){}